(function(){const se=document.createElement("link").relList;if(se&&se.supports&&se.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&e(i)}).observe(document,{childList:!0,subtree:!0});function n(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(t){if(t.ep)return;t.ep=!0;const r=n(t);fetch(t.href,r)}})();var rt={exports:{}};(function(q,se){var n={REVISION:"77"};q.exports=n,Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52)),Math.sign===void 0&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),Function.prototype.name===void 0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),Object.assign===void 0&&function(){Object.assign=function(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(i!=null)for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t}}(),Object.assign(n,{MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2},CullFaceNone:0,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,FrontFaceDirectionCW:0,FrontFaceDirectionCCW:1,BasicShadowMap:0,PCFShadowMap:1,PCFSoftShadowMap:2,FrontSide:0,BackSide:1,DoubleSide:2,FlatShading:1,SmoothShading:2,NoColors:0,FaceColors:1,VertexColors:2,NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5,AddEquation:100,SubtractEquation:101,ReverseSubtractEquation:102,MinEquation:103,MaxEquation:104,ZeroFactor:200,OneFactor:201,SrcColorFactor:202,OneMinusSrcColorFactor:203,SrcAlphaFactor:204,OneMinusSrcAlphaFactor:205,DstAlphaFactor:206,OneMinusDstAlphaFactor:207,DstColorFactor:208,OneMinusDstColorFactor:209,SrcAlphaSaturateFactor:210,NeverDepth:0,AlwaysDepth:1,LessDepth:2,LessEqualDepth:3,EqualDepth:4,GreaterEqualDepth:5,GreaterDepth:6,NotEqualDepth:7,MultiplyOperation:0,MixOperation:1,AddOperation:2,NoToneMapping:0,LinearToneMapping:1,ReinhardToneMapping:2,Uncharted2ToneMapping:3,CineonToneMapping:4,UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307,RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002,NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008,UnsignedByteType:1009,ByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1025,UnsignedShort4444Type:1016,UnsignedShort5551Type:1017,UnsignedShort565Type:1018,AlphaFormat:1019,RGBFormat:1020,RGBAFormat:1021,LuminanceFormat:1022,LuminanceAlphaFormat:1023,RGBEFormat:n.RGBAFormat,DepthFormat:1026,RGB_S3TC_DXT1_Format:2001,RGBA_S3TC_DXT1_Format:2002,RGBA_S3TC_DXT3_Format:2003,RGBA_S3TC_DXT5_Format:2004,RGB_PVRTC_4BPPV1_Format:2100,RGB_PVRTC_2BPPV1_Format:2101,RGBA_PVRTC_4BPPV1_Format:2102,RGBA_PVRTC_2BPPV1_Format:2103,RGB_ETC1_Format:2151,LoopOnce:2200,LoopRepeat:2201,LoopPingPong:2202,InterpolateDiscrete:2300,InterpolateLinear:2301,InterpolateSmooth:2302,ZeroCurvatureEnding:2400,ZeroSlopeEnding:2401,WrapAroundEnding:2402,TrianglesDrawMode:0,TriangleStripDrawMode:1,TriangleFanDrawMode:2,LinearEncoding:3e3,sRGBEncoding:3001,GammaEncoding:3007,RGBEEncoding:3002,LogLuvEncoding:3003,RGBM7Encoding:3004,RGBM16Encoding:3005,RGBDEncoding:3006,BasicDepthPacking:3200,RGBADepthPacking:3201}),n.Color=function(e,t,r){return t===void 0&&r===void 0?this.set(e):this.setRGB(e,t,r)},n.Color.prototype={constructor:n.Color,r:1,g:1,b:1,set:function(e){return e instanceof n.Color?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this},setScalar:function(e){this.r=e,this.g=e,this.b=e},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function e(t,r,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(r-t)*6*i:i<1/2?r:i<2/3?t+(r-t)*6*(2/3-i):t}return function(t,r,i){if(t=n.Math.euclideanModulo(t,1),r=n.Math.clamp(r,0,1),i=n.Math.clamp(i,0,1),r===0)this.r=this.g=this.b=i;else{var a=i<=.5?i*(1+r):i+r-i*r,o=2*i-a;this.r=e(o,a,t+1/3),this.g=e(o,a,t),this.b=e(o,a,t-1/3)}return this}}(),setStyle:function(e){function t(f){f!==void 0&&parseFloat(f)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,a=r[1],o=r[2];switch(a){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var s=parseFloat(i[1])/360,c=parseInt(i[2],10)/100,u=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(s,c,u)}break}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var h=r[1],l=h.length;if(l===3)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,this;if(l===6)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,this}if(e&&e.length>0){var h=n.ColorKeywords[e];h!==void 0?this.setHex(h):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return t===void 0&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){t===void 0&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0},r=this.r,i=this.g,a=this.b,o=Math.max(r,i,a),s=Math.min(r,i,a),c,u,h=(s+o)/2;if(s===o)c=0,u=0;else{var l=o-s;switch(u=h<=.5?l/(o+s):l/(2-o-s),o){case r:c=(i-a)/l+(i<a?6:0);break;case i:c=(a-r)/l+2;break;case a:c=(r-i)/l+4;break}c/=6}return t.h=c,t.s=u,t.l=h,t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=r,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return t===void 0&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},n.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},n.Quaternion=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=i!==void 0?i:1},n.Quaternion.prototype={constructor:n.Quaternion,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!(e instanceof n.Euler))throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=Math.cos(e._x/2),i=Math.cos(e._y/2),a=Math.cos(e._z/2),o=Math.sin(e._x/2),s=Math.sin(e._y/2),c=Math.sin(e._z/2),u=e.order;return u==="XYZ"?(this._x=o*i*a+r*s*c,this._y=r*s*a-o*i*c,this._z=r*i*c+o*s*a,this._w=r*i*a-o*s*c):u==="YXZ"?(this._x=o*i*a+r*s*c,this._y=r*s*a-o*i*c,this._z=r*i*c-o*s*a,this._w=r*i*a+o*s*c):u==="ZXY"?(this._x=o*i*a-r*s*c,this._y=r*s*a+o*i*c,this._z=r*i*c+o*s*a,this._w=r*i*a-o*s*c):u==="ZYX"?(this._x=o*i*a-r*s*c,this._y=r*s*a+o*i*c,this._z=r*i*c-o*s*a,this._w=r*i*a+o*s*c):u==="YZX"?(this._x=o*i*a+r*s*c,this._y=r*s*a+o*i*c,this._z=r*i*c-o*s*a,this._w=r*i*a-o*s*c):u==="XZY"&&(this._x=o*i*a-r*s*c,this._y=r*s*a-o*i*c,this._z=r*i*c+o*s*a,this._w=r*i*a+o*s*c),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0],i=t[4],a=t[8],o=t[1],s=t[5],c=t[9],u=t[2],h=t[6],l=t[10],f=r+s+l,d;return f>0?(d=.5/Math.sqrt(f+1),this._w=.25/d,this._x=(h-c)*d,this._y=(a-u)*d,this._z=(o-i)*d):r>s&&r>l?(d=2*Math.sqrt(1+r-s-l),this._w=(h-c)/d,this._x=.25*d,this._y=(i+o)/d,this._z=(a+u)/d):s>l?(d=2*Math.sqrt(1+s-r-l),this._w=(a-u)/d,this._x=(i+o)/d,this._y=.25*d,this._z=(c+h)/d):(d=2*Math.sqrt(1+l-r-s),this._w=(o-i)/d,this._x=(a+u)/d,this._y=(c+h)/d,this._z=.25*d),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t,r=1e-6;return function(i,a){return e===void 0&&(e=new n.Vector3),t=i.dot(a)+1,t<r?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,a),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,a=e._z,o=e._w,s=t._x,c=t._y,u=t._z,h=t._w;return this._x=r*h+o*s+i*u-a*c,this._y=i*h+o*c+a*s-r*u,this._z=a*h+o*u+r*c-i*s,this._w=o*h-r*s-i*c-a*u,this.onChangeCallback(),this},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var r=this._x,i=this._y,a=this._z,o=this._w,s=o*e._w+r*e._x+i*e._y+a*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=r,this._y=i,this._z=a,this;var c=Math.sqrt(1-s*s);if(Math.abs(c)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(i+this._y),this._z=.5*(a+this._z),this;var u=Math.atan2(c,s),h=Math.sin((1-t)*u)/c,l=Math.sin(t*u)/c;return this._w=o*h+this._w*l,this._x=r*h+this._x*l,this._y=i*h+this._y*l,this._z=a*h+this._z*l,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return t===void 0&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},Object.assign(n.Quaternion,{slerp:function(e,t,r,i){return r.copy(e).slerp(t,i)},slerpFlat:function(e,t,r,i,a,o,s){var c=r[i+0],u=r[i+1],h=r[i+2],l=r[i+3],f=a[o+0],d=a[o+1],p=a[o+2],m=a[o+3];if(l!==m||c!==f||u!==d||h!==p){var y=1-s,g=c*f+u*d+h*p+l*m,x=g>=0?1:-1,M=1-g*g;if(M>Number.EPSILON){var w=Math.sqrt(M),E=Math.atan2(w,g*x);y=Math.sin(y*E)/w,s=Math.sin(s*E)/w}var S=s*x;if(c=c*y+f*S,u=u*y+d*S,h=h*y+p*S,l=l*y+m*S,y===1-s){var U=1/Math.sqrt(c*c+u*u+h*h+l*l);c*=U,u*=U,h*=U,l*=U}}e[t]=c,e[t+1]=u,e[t+2]=h,e[t+3]=l}}),n.Vector2=function(e,t){this.x=e||0,this.y=t||0},n.Vector2.prototype={constructor:n.Vector2,get width(){return this.x},set width(e){this.x=e},get height(){return this.y},set height(e){this.y=e},set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e):(this.x=0,this.y=0),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e,t;return function(i,a){return e===void 0&&(e=new n.Vector2,t=new n.Vector2),e.set(i,i),t.set(a,a),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,r))/r)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,r){return r===void 0&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this},rotateAround:function(e,t){var r=Math.cos(t),i=Math.sin(t),a=this.x-e.x,o=this.y-e.y;return this.x=a*r-o*i+e.x,this.y=a*i+o*r+e.y,this}},n.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},n.Vector3.prototype={constructor:n.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(r){return r instanceof n.Euler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),e===void 0&&(e=new n.Quaternion),this.applyQuaternion(e.setFromEuler(r))}}(),applyAxisAngle:function(){var e;return function(r,i){return e===void 0&&(e=new n.Quaternion),this.applyQuaternion(e.setFromAxisAngle(r,i))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,a=e.elements;return this.x=a[0]*t+a[3]*r+a[6]*i,this.y=a[1]*t+a[4]*r+a[7]*i,this.z=a[2]*t+a[5]*r+a[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12],this.y=a[1]*t+a[5]*r+a[9]*i+a[13],this.z=a[2]*t+a[6]*r+a[10]*i+a[14],this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z,a=e.elements,o=1/(a[3]*t+a[7]*r+a[11]*i+a[15]);return this.x=(a[0]*t+a[4]*r+a[8]*i+a[12])*o,this.y=(a[1]*t+a[5]*r+a[9]*i+a[13])*o,this.z=(a[2]*t+a[6]*r+a[10]*i+a[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,a=e.x,o=e.y,s=e.z,c=e.w,u=c*t+o*i-s*r,h=c*r+s*t-a*i,l=c*i+a*r-o*t,f=-a*t-o*r-s*i;return this.x=u*c+f*-a+h*-s-l*-o,this.y=h*c+f*-o+l*-a-u*-s,this.z=l*c+f*-s+u*-o-h*-a,this},project:function(){var e;return function(r){return e===void 0&&(e=new n.Matrix4),e.multiplyMatrices(r.projectionMatrix,e.getInverse(r.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(r){return e===void 0&&(e=new n.Matrix4),e.multiplyMatrices(r.matrixWorld,e.getInverse(r.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,i=this.z,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i,this.y=a[1]*t+a[5]*r+a[9]*i,this.z=a[2]*t+a[6]*r+a[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e,t;return function(i,a){return e===void 0&&(e=new n.Vector3,t=new n.Vector3),e.set(i,i,i),t.set(a,a,a),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,r))/r)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){if(t!==void 0)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,i=this.y,a=this.z;return this.x=i*e.z-a*e.y,this.y=a*e.x-r*e.z,this.z=r*e.y-i*e.x,this},crossVectors:function(e,t){var r=e.x,i=e.y,a=e.z,o=t.x,s=t.y,c=t.z;return this.x=i*c-a*s,this.y=a*o-r*c,this.z=r*s-i*o,this},projectOnVector:function(){var e,t;return function(i){return e===void 0&&(e=new n.Vector3),e.copy(i).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(r){return e===void 0&&(e=new n.Vector3),e.copy(this).projectOnVector(r),this.sub(e)}}(),reflect:function(){var e;return function(r){return e===void 0&&(e=new n.Vector3),this.sub(e.copy(r).multiplyScalar(2*this.dot(r)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(n.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromMatrixPosition:function(e){return this.setFromMatrixColumn(e,3)},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){if(typeof e=="number"){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var r=e;e=t,t=r}return this.fromArray(e.elements,t*4)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,r){return r===void 0&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}},n.Vector4=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=i!==void 0?i:1},n.Vector4.prototype={constructor:n.Vector4,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,a=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*a,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*a,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*a,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*a,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,a,o=.01,s=.1,c=e.elements,u=c[0],h=c[4],l=c[8],f=c[1],d=c[5],p=c[9],m=c[2],y=c[6],g=c[10];if(Math.abs(h-f)<o&&Math.abs(l-m)<o&&Math.abs(p-y)<o){if(Math.abs(h+f)<s&&Math.abs(l+m)<s&&Math.abs(p+y)<s&&Math.abs(u+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;var x=(u+1)/2,M=(d+1)/2,w=(g+1)/2,E=(h+f)/4,S=(l+m)/4,U=(p+y)/4;return x>M&&x>w?x<o?(r=0,i=.707106781,a=.707106781):(r=Math.sqrt(x),i=E/r,a=S/r):M>w?M<o?(r=.707106781,i=0,a=.707106781):(i=Math.sqrt(M),r=E/i,a=U/i):w<o?(r=.707106781,i=.707106781,a=0):(a=Math.sqrt(w),r=S/a,i=U/a),this.set(r,i,a,t),this}var C=Math.sqrt((y-p)*(y-p)+(l-m)*(l-m)+(f-h)*(f-h));return Math.abs(C)<.001&&(C=1),this.x=(y-p)/C,this.y=(l-m)/C,this.z=(f-h)/C,this.w=Math.acos((u+d+g-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(i,a){return e===void 0&&(e=new n.Vector4,t=new n.Vector4),e.set(i,i,i,i),t.set(a,a,a,a),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,r){return r===void 0&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this}},n.Euler=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||n.Euler.DefaultOrder},n.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],n.Euler.DefaultOrder="XYZ",n.Euler.prototype={constructor:n.Euler,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var i=n.Math.clamp,a=e.elements,o=a[0],s=a[4],c=a[8],u=a[1],h=a[5],l=a[9],f=a[2],d=a[6],p=a[10];return t=t||this._order,t==="XYZ"?(this._y=Math.asin(i(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,h),this._z=0)):t==="YXZ"?(this._x=Math.asin(-i(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(c,p),this._z=Math.atan2(u,h)):(this._y=Math.atan2(-f,o),this._z=0)):t==="ZXY"?(this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-f,p),this._z=Math.atan2(-s,h)):(this._y=0,this._z=Math.atan2(u,o))):t==="ZYX"?(this._y=Math.asin(-i(f,-1,1)),Math.abs(f)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-s,h))):t==="YZX"?(this._z=Math.asin(i(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(c,p))):t==="XZY"?(this._z=Math.asin(-i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,h),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-l,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,r!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,r,i){return e===void 0&&(e=new n.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,i)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new n.Quaternion;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new n.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},n.Line3=function(e,t){this.start=e!==void 0?e:new n.Vector3,this.end=t!==void 0?t:new n.Vector3},n.Line3.prototype={constructor:n.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new n.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new n.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new n.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new n.Vector3,t=new n.Vector3;return function(r,i){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var a=t.dot(t),o=t.dot(e),s=o/a;return i&&(s=n.Math.clamp(s,0,1)),s}}(),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t),a=r||new n.Vector3;return this.delta(a).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},n.Box2=function(e,t){this.min=e!==void 0?e:new n.Vector2(1/0,1/0),this.max=t!==void 0?t:new n.Vector2(-1/0,-1/0)},n.Box2.prototype={constructor:n.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new n.Vector2;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new n.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new n.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){var r=t||new n.Vector2;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){var r=t||new n.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},n.Box3=function(e,t){this.min=e!==void 0?e:new n.Vector3(1/0,1/0,1/0),this.max=t!==void 0?t:new n.Vector3(-1/0,-1/0,-1/0)},n.Box3.prototype={constructor:n.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,i=1/0,a=-1/0,o=-1/0,s=-1/0,c=0,u=e.length;c<u;c+=3){var h=e[c],l=e[c+1],f=e[c+2];h<t&&(t=h),l<r&&(r=l),f<i&&(i=f),h>a&&(a=h),l>o&&(o=l),f>s&&(s=f)}this.min.set(t,r,i),this.max.set(a,o,s)},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new n.Vector3;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(){var e=new n.Vector3;return function(t){var r=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(i){var a=i.geometry;if(a!==void 0){if(a instanceof n.Geometry)for(var o=a.vertices,s=0,c=o.length;s<c;s++)e.copy(o[s]),e.applyMatrix4(i.matrixWorld),r.expandByPoint(e);else if(a instanceof n.BufferGeometry&&a.attributes.position!==void 0)for(var u=a.attributes.position.array,s=0,c=u.length;s<c;s+=3)e.fromArray(u,s),e.applyMatrix4(i.matrixWorld),r.expandByPoint(e)}}),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new n.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new n.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){var r=t||new n.Vector3;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e;return function(r){return e===void 0&&(e=new n.Vector3),this.clampPoint(r.center,e),e.distanceToSquared(r.center)<=r.radius*r.radius}}(),intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=e.constant&&r>=e.constant},clampPoint:function(e,t){var r=t||new n.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new n.Vector3;return function(t){var r=t||new n.Sphere;return r.center=this.center(),r.radius=this.size(e).length()*.5,r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},n.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},n.Matrix3.prototype={constructor:n.Matrix3,set:function(e,t,r,i,a,o,s,c,u){var h=this.elements;return h[0]=e,h[1]=i,h[2]=s,h[3]=t,h[4]=a,h[5]=c,h[6]=r,h[7]=o,h[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToVector3Array:function(){var e;return function(t,r,i){e===void 0&&(e=new n.Vector3),r===void 0&&(r=0),i===void 0&&(i=t.length);for(var a=0,o=r;a<i;a+=3,o+=3)e.fromArray(t,o),e.applyMatrix3(this),e.toArray(t,o);return t}}(),applyToBuffer:function(){var e;return function(r,i,a){e===void 0&&(e=new n.Vector3),i===void 0&&(i=0),a===void 0&&(a=r.length/r.itemSize);for(var o=0,s=i;o<a;o++,s++)e.x=r.getX(s),e.y=r.getY(s),e.z=r.getZ(s),e.applyMatrix3(this),r.setXYZ(e.x,e.y,e.z);return r}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],u=e[7],h=e[8];return t*o*h-t*s*u-r*a*h+r*s*c+i*a*u-i*o*c},getInverse:function(e,t){e instanceof n.Matrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var r=e.elements,i=this.elements,a=r[0],o=r[1],s=r[2],c=r[3],u=r[4],h=r[5],l=r[6],f=r[7],d=r[8],p=d*u-h*f,m=h*l-d*c,y=f*c-u*l,g=a*p+o*m+s*y;if(g===0){var x="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(x);return console.warn(x),this.identity()}var M=1/g;return i[0]=p*M,i[1]=(s*f-d*o)*M,i[2]=(h*o-s*u)*M,i[3]=m*M,i[4]=(d*a-s*l)*M,i[5]=(s*c-h*a)*M,i[6]=y*M,i[7]=(o*l-f*a)*M,i[8]=(u*a-o*c)*M,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead."),this.toArray(e,t)},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}},n.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},n.Matrix4.prototype={constructor:n.Matrix4,set:function(e,t,r,i,a,o,s,c,u,h,l,f,d,p,m,y){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=a,g[5]=o,g[9]=s,g[13]=c,g[2]=u,g[6]=h,g[10]=l,g[14]=f,g[3]=d,g[7]=p,g[11]=m,g[15]=y,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new n.Matrix4().fromArray(this.elements)},copy:function(e){return this.elements.set(e.elements),this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e;return function(t){e===void 0&&(e=new n.Vector3);var r=this.elements,i=t.elements,a=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),s=1/e.setFromMatrixColumn(t,2).length();return r[0]=i[0]*a,r[1]=i[1]*a,r[2]=i[2]*a,r[4]=i[4]*o,r[5]=i[5]*o,r[6]=i[6]*o,r[8]=i[8]*s,r[9]=i[9]*s,r[10]=i[10]*s,this}}(),makeRotationFromEuler:function(e){e instanceof n.Euler||console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,i=e.y,a=e.z,o=Math.cos(r),s=Math.sin(r),c=Math.cos(i),u=Math.sin(i),h=Math.cos(a),l=Math.sin(a);if(e.order==="XYZ"){var f=o*h,d=o*l,p=s*h,m=s*l;t[0]=c*h,t[4]=-c*l,t[8]=u,t[1]=d+p*u,t[5]=f-m*u,t[9]=-s*c,t[2]=m-f*u,t[6]=p+d*u,t[10]=o*c}else if(e.order==="YXZ"){var y=c*h,g=c*l,x=u*h,M=u*l;t[0]=y+M*s,t[4]=x*s-g,t[8]=o*u,t[1]=o*l,t[5]=o*h,t[9]=-s,t[2]=g*s-x,t[6]=M+y*s,t[10]=o*c}else if(e.order==="ZXY"){var y=c*h,g=c*l,x=u*h,M=u*l;t[0]=y-M*s,t[4]=-o*l,t[8]=x+g*s,t[1]=g+x*s,t[5]=o*h,t[9]=M-y*s,t[2]=-o*u,t[6]=s,t[10]=o*c}else if(e.order==="ZYX"){var f=o*h,d=o*l,p=s*h,m=s*l;t[0]=c*h,t[4]=p*u-d,t[8]=f*u+m,t[1]=c*l,t[5]=m*u+f,t[9]=d*u-p,t[2]=-u,t[6]=s*c,t[10]=o*c}else if(e.order==="YZX"){var w=o*c,E=o*u,S=s*c,U=s*u;t[0]=c*h,t[4]=U-w*l,t[8]=S*l+E,t[1]=l,t[5]=o*h,t[9]=-s*h,t[2]=-u*h,t[6]=E*l+S,t[10]=w-U*l}else if(e.order==="XZY"){var w=o*c,E=o*u,S=s*c,U=s*u;t[0]=c*h,t[4]=-l,t[8]=u*h,t[1]=w*l+U,t[5]=o*h,t[9]=E*l-S,t[2]=S*l-E,t[6]=s*h,t[10]=U*l+w}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,a=e.z,o=e.w,s=r+r,c=i+i,u=a+a,h=r*s,l=r*c,f=r*u,d=i*c,p=i*u,m=a*u,y=o*s,g=o*c,x=o*u;return t[0]=1-(d+m),t[4]=l-x,t[8]=f+g,t[1]=l+x,t[5]=1-(h+m),t[9]=p-y,t[2]=f-g,t[6]=p+y,t[10]=1-(h+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e,t,r;return function(i,a,o){e===void 0&&(e=new n.Vector3,t=new n.Vector3,r=new n.Vector3);var s=this.elements;return r.subVectors(i,a).normalize(),r.lengthSq()===0&&(r.z=1),e.crossVectors(o,r).normalize(),e.lengthSq()===0&&(r.z+=1e-4,e.crossVectors(o,r).normalize()),t.crossVectors(r,e),s[0]=e.x,s[4]=t.x,s[8]=r.x,s[1]=e.y,s[5]=t.y,s[9]=r.y,s[2]=e.z,s[6]=t.z,s[10]=r.z,this}}(),multiply:function(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,a=this.elements,o=r[0],s=r[4],c=r[8],u=r[12],h=r[1],l=r[5],f=r[9],d=r[13],p=r[2],m=r[6],y=r[10],g=r[14],x=r[3],M=r[7],w=r[11],E=r[15],S=i[0],U=i[4],C=i[8],P=i[12],B=i[1],F=i[5],N=i[9],W=i[13],I=i[2],k=i[6],T=i[10],O=i[14],G=i[3],j=i[7],Z=i[11],Q=i[15];return a[0]=o*S+s*B+c*I+u*G,a[4]=o*U+s*F+c*k+u*j,a[8]=o*C+s*N+c*T+u*Z,a[12]=o*P+s*W+c*O+u*Q,a[1]=h*S+l*B+f*I+d*G,a[5]=h*U+l*F+f*k+d*j,a[9]=h*C+l*N+f*T+d*Z,a[13]=h*P+l*W+f*O+d*Q,a[2]=p*S+m*B+y*I+g*G,a[6]=p*U+m*F+y*k+g*j,a[10]=p*C+m*N+y*T+g*Z,a[14]=p*P+m*W+y*O+g*Q,a[3]=x*S+M*B+w*I+E*G,a[7]=x*U+M*F+w*k+E*j,a[11]=x*C+M*N+w*T+E*Z,a[15]=x*P+M*W+w*O+E*Q,this},multiplyToArray:function(e,t,r){var i=this.elements;return this.multiplyMatrices(e,t),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToVector3Array:function(){var e;return function(t,r,i){e===void 0&&(e=new n.Vector3),r===void 0&&(r=0),i===void 0&&(i=t.length);for(var a=0,o=r;a<i;a+=3,o+=3)e.fromArray(t,o),e.applyMatrix4(this),e.toArray(t,o);return t}}(),applyToBuffer:function(){var e;return function(r,i,a){e===void 0&&(e=new n.Vector3),i===void 0&&(i=0),a===void 0&&(a=r.length/r.itemSize);for(var o=0,s=i;o<a;o++,s++)e.x=r.getX(s),e.y=r.getY(s),e.z=r.getZ(s),e.applyMatrix4(this),r.setXYZ(e.x,e.y,e.z);return r}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],a=e[12],o=e[1],s=e[5],c=e[9],u=e[13],h=e[2],l=e[6],f=e[10],d=e[14],p=e[3],m=e[7],y=e[11],g=e[15];return p*(+a*c*l-i*u*l-a*s*f+r*u*f+i*s*d-r*c*d)+m*(+t*c*d-t*u*f+a*o*f-i*o*d+i*u*h-a*c*h)+y*(+t*u*l-t*s*d-a*o*l+r*o*d+a*s*h-r*u*h)+g*(-i*s*h-t*c*l+t*s*f+i*o*l-r*o*f+r*c*h)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return e===void 0&&(e=new n.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,a=i[0],o=i[1],s=i[2],c=i[3],u=i[4],h=i[5],l=i[6],f=i[7],d=i[8],p=i[9],m=i[10],y=i[11],g=i[12],x=i[13],M=i[14],w=i[15],E=p*M*f-x*m*f+x*l*y-h*M*y-p*l*w+h*m*w,S=g*m*f-d*M*f-g*l*y+u*M*y+d*l*w-u*m*w,U=d*x*f-g*p*f+g*h*y-u*x*y-d*h*w+u*p*w,C=g*p*l-d*x*l-g*h*m+u*x*m+d*h*M-u*p*M,P=a*E+o*S+s*U+c*C;if(P===0){var B="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(B);return console.warn(B),this.identity()}var F=1/P;return r[0]=E*F,r[1]=(x*m*c-p*M*c-x*s*y+o*M*y+p*s*w-o*m*w)*F,r[2]=(h*M*c-x*l*c+x*s*f-o*M*f-h*s*w+o*l*w)*F,r[3]=(p*l*c-h*m*c-p*s*f+o*m*f+h*s*y-o*l*y)*F,r[4]=S*F,r[5]=(d*M*c-g*m*c+g*s*y-a*M*y-d*s*w+a*m*w)*F,r[6]=(g*l*c-u*M*c-g*s*f+a*M*f+u*s*w-a*l*w)*F,r[7]=(u*m*c-d*l*c+d*s*f-a*m*f-u*s*y+a*l*y)*F,r[8]=U*F,r[9]=(g*p*c-d*x*c-g*o*y+a*x*y+d*o*w-a*p*w)*F,r[10]=(u*x*c-g*h*c+g*o*f-a*x*f-u*o*w+a*h*w)*F,r[11]=(d*h*c-u*p*c-d*o*f+a*p*f+u*o*y-a*h*y)*F,r[12]=C*F,r[13]=(d*x*s-g*p*s+g*o*m-a*x*m-d*o*M+a*p*M)*F,r[14]=(g*h*s-u*x*s-g*o*l+a*x*l+u*o*M-a*h*M)*F,r[15]=(u*p*s-d*h*s+d*o*l-a*p*l-u*o*m+a*h*m)*F,this},scale:function(e){var t=this.elements,r=e.x,i=e.y,a=e.z;return t[0]*=r,t[4]*=i,t[8]*=a,t[1]*=r,t[5]*=i,t[9]*=a,t[2]*=r,t[6]*=i,t[10]*=a,t[3]*=r,t[7]*=i,t[11]*=a,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),a=1-r,o=e.x,s=e.y,c=e.z,u=a*o,h=a*s;return this.set(u*o+r,u*s-i*c,u*c+i*s,0,u*s+i*c,h*s+r,h*c-i*o,0,u*c-i*s,h*c+i*o,a*c*c+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e,t;return function(r,i,a){e===void 0&&(e=new n.Vector3,t=new n.Matrix4);var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),c=e.set(o[4],o[5],o[6]).length(),u=e.set(o[8],o[9],o[10]).length(),h=this.determinant();h<0&&(s=-s),r.x=o[12],r.y=o[13],r.z=o[14],t.elements.set(this.elements);var l=1/s,f=1/c,d=1/u;return t.elements[0]*=l,t.elements[1]*=l,t.elements[2]*=l,t.elements[4]*=f,t.elements[5]*=f,t.elements[6]*=f,t.elements[8]*=d,t.elements[9]*=d,t.elements[10]*=d,i.setFromRotationMatrix(t),a.x=s,a.y=c,a.z=u,this}}(),makeFrustum:function(e,t,r,i,a,o){var s=this.elements,c=2*a/(t-e),u=2*a/(i-r),h=(t+e)/(t-e),l=(i+r)/(i-r),f=-(o+a)/(o-a),d=-2*o*a/(o-a);return s[0]=c,s[4]=0,s[8]=h,s[12]=0,s[1]=0,s[5]=u,s[9]=l,s[13]=0,s[2]=0,s[6]=0,s[10]=f,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makePerspective:function(e,t,r,i){var a=r*Math.tan(n.Math.DEG2RAD*e*.5),o=-a,s=o*t,c=a*t;return this.makeFrustum(s,c,o,a,r,i)},makeOrthographic:function(e,t,r,i,a,o){var s=this.elements,c=1/(t-e),u=1/(r-i),h=1/(o-a),l=(t+e)*c,f=(r+i)*u,d=(o+a)*h;return s[0]=2*c,s[4]=0,s[8]=0,s[12]=-l,s[1]=0,s[5]=2*u,s[9]=0,s[13]=-f,s[2]=0,s[6]=0,s[10]=-2*h,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}},n.Ray=function(e,t){this.origin=e!==void 0?e:new n.Vector3,this.direction=t!==void 0?t:new n.Vector3},n.Ray.prototype={constructor:n.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var r=t||new n.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new n.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new n.Vector3;r.subVectors(e,this.origin);var i=r.dot(this.direction);return i<0?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new n.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Vector3;return function(i,a,o,s){e.copy(i).add(a).multiplyScalar(.5),t.copy(a).sub(i).normalize(),r.copy(this.origin).sub(e);var c=i.distanceTo(a)*.5,u=-this.direction.dot(t),h=r.dot(this.direction),l=-r.dot(t),f=r.lengthSq(),d=Math.abs(1-u*u),p,m,y,g;if(d>0)if(p=u*l-h,m=u*h-l,g=c*d,p>=0)if(m>=-g)if(m<=g){var x=1/d;p*=x,m*=x,y=p*(p+u*m+2*h)+m*(u*p+m+2*l)+f}else m=c,p=Math.max(0,-(u*m+h)),y=-p*p+m*(m+2*l)+f;else m=-c,p=Math.max(0,-(u*m+h)),y=-p*p+m*(m+2*l)+f;else m<=-g?(p=Math.max(0,-(-u*c+h)),m=p>0?-c:Math.min(Math.max(-c,-l),c),y=-p*p+m*(m+2*l)+f):m<=g?(p=0,m=Math.min(Math.max(-c,-l),c),y=m*(m+2*l)+f):(p=Math.max(0,-(u*c+h)),m=p>0?c:Math.min(Math.max(-c,-l),c),y=-p*p+m*(m+2*l)+f);else m=u>0?-c:c,p=Math.max(0,-(u*m+h)),y=-p*p+m*(m+2*l)+f;return o&&o.copy(this.direction).multiplyScalar(p).add(this.origin),s&&s.copy(t).multiplyScalar(m).add(e),y}}(),intersectSphere:function(){var e=new n.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),a=e.dot(e)-i*i,o=t.radius*t.radius;if(a>o)return null;var s=Math.sqrt(o-a),c=i-s,u=i+s;return c<0&&u<0?null:c<0?this.at(u,r):this.at(c,r)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return r===null?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0)return!0;var r=e.normal.dot(this.direction);return r*t<0},intersectBox:function(e,t){var r,i,a,o,s,c,u=1/this.direction.x,h=1/this.direction.y,l=1/this.direction.z,f=this.origin;return u>=0?(r=(e.min.x-f.x)*u,i=(e.max.x-f.x)*u):(r=(e.max.x-f.x)*u,i=(e.min.x-f.x)*u),h>=0?(a=(e.min.y-f.y)*h,o=(e.max.y-f.y)*h):(a=(e.max.y-f.y)*h,o=(e.min.y-f.y)*h),r>o||a>i||((a>r||r!==r)&&(r=a),(o<i||i!==i)&&(i=o),l>=0?(s=(e.min.z-f.z)*l,c=(e.max.z-f.z)*l):(s=(e.max.z-f.z)*l,c=(e.min.z-f.z)*l),r>c||s>i)||((s>r||r!==r)&&(r=s),(c<i||i!==i)&&(i=c),i<0)?null:this.at(r>=0?r:i,t)},intersectsBox:function(){var e=new n.Vector3;return function(t){return this.intersectBox(t,e)!==null}}(),intersectTriangle:function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Vector3,i=new n.Vector3;return function(a,o,s,c,u){t.subVectors(o,a),r.subVectors(s,a),i.crossVectors(t,r);var h=this.direction.dot(i),l;if(h>0){if(c)return null;l=1}else if(h<0)l=-1,h=-h;else return null;e.subVectors(this.origin,a);var f=l*this.direction.dot(r.crossVectors(e,r));if(f<0)return null;var d=l*this.direction.dot(t.cross(e));if(d<0||f+d>h)return null;var p=-l*e.dot(i);return p<0?null:this.at(p/h,u)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},n.Sphere=function(e,t){this.center=e!==void 0?e:new n.Vector3,this.radius=t!==void 0?t:0},n.Sphere.prototype={constructor:n.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new n.Box3;return function(t,r){var i=this.center;r!==void 0?i.copy(r):e.setFromPoints(t).center(i);for(var a=0,o=0,s=t.length;o<s;o++)a=Math.max(a,i.distanceToSquared(t[o]));return this.radius=Math.sqrt(a),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(this.center.dot(e.normal)-e.constant)<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),i=t||new n.Vector3;return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new n.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},n.Frustum=function(e,t,r,i,a,o){this.planes=[e!==void 0?e:new n.Plane,t!==void 0?t:new n.Plane,r!==void 0?r:new n.Plane,i!==void 0?i:new n.Plane,a!==void 0?a:new n.Plane,o!==void 0?o:new n.Plane]},n.Frustum.prototype={constructor:n.Frustum,set:function(e,t,r,i,a,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(i),s[4].copy(a),s[5].copy(o),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],a=r[1],o=r[2],s=r[3],c=r[4],u=r[5],h=r[6],l=r[7],f=r[8],d=r[9],p=r[10],m=r[11],y=r[12],g=r[13],x=r[14],M=r[15];return t[0].setComponents(s-i,l-c,m-f,M-y).normalize(),t[1].setComponents(s+i,l+c,m+f,M+y).normalize(),t[2].setComponents(s+a,l+u,m+d,M+g).normalize(),t[3].setComponents(s-a,l-u,m-d,M-g).normalize(),t[4].setComponents(s-o,l-h,m-p,M-x).normalize(),t[5].setComponents(s+o,l+h,m+p,M+x).normalize(),this},intersectsObject:function(){var e=new n.Sphere;return function(t){var r=t.geometry;return r.boundingSphere===null&&r.computeBoundingSphere(),e.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new n.Sphere;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,a=0;a<6;a++){var o=t[a].distanceToPoint(r);if(o<i)return!1}return!0},intersectsBox:function(){var e=new n.Vector3,t=new n.Vector3;return function(r){for(var i=this.planes,a=0;a<6;a++){var o=i[a];e.x=o.normal.x>0?r.min.x:r.max.x,t.x=o.normal.x>0?r.max.x:r.min.x,e.y=o.normal.y>0?r.min.y:r.max.y,t.y=o.normal.y>0?r.max.y:r.min.y,e.z=o.normal.z>0?r.min.z:r.max.z,t.z=o.normal.z>0?r.max.z:r.min.z;var s=o.distanceToPoint(e),c=o.distanceToPoint(t);if(s<0&&c<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}},n.Plane=function(e,t){this.normal=e!==void 0?e:new n.Vector3(1,0,0),this.constant=t!==void 0?t:0},n.Plane.prototype={constructor:n.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new n.Vector3,t=new n.Vector3;return function(r,i,a){var o=e.subVectors(a,i).cross(t.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e),i=t||new n.Vector3;return i.copy(this.normal).multiplyScalar(r)},intersectLine:function(){var e=new n.Vector3;return function(t,r){var i=r||new n.Vector3,a=t.delta(e),o=this.normal.dot(a);if(o===0)return this.distanceToPoint(t.start)===0?i.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/o;if(!(s<0||s>1))return i.copy(a).multiplyScalar(s).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){var t=e||new n.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new n.Vector3,t=new n.Matrix3;return function(r,i){var a=this.coplanarPoint(e).applyMatrix4(r),o=i||t.getNormalMatrix(r),s=this.normal.applyMatrix3(o).normalize();return this.constant=-a.dot(s),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},n.Spherical=function(e,t,r){return this.radius=e!==void 0?e:1,this.phi=t!==void 0?t:0,this.theta=r!==void 0?r:0,this},n.Spherical.prototype={constructor:n.Spherical,set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius.copy(e.radius),this.phi.copy(e.phi),this.theta.copy(e.theta),this},makeSafe:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(n.Math.clamp(e.y/this.radius,-1,1))),this}},n.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=new Array(36),r=0,i;return function(){for(var a=0;a<36;a++)a===8||a===13||a===18||a===23?t[a]="-":a===14?t[a]="4":(r<=2&&(r=33554432+Math.random()*16777216|0),i=r&15,r=r>>4,t[a]=e[a===19?i&3|8:i]);return t.join("")}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,i,a){return i+(e-t)*(a-i)/(r-t)},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(e*6-15)+10))},random16:function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*n.Math.DEG2RAD},radToDeg:function(e){return e*n.Math.RAD2DEG},isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}},n.Spline=function(e){this.points=e;var t=[],r={x:0,y:0,z:0},i,a,o,s,c,u,h,l,f;this.initFromArray=function(p){this.points=[];for(var m=0;m<p.length;m++)this.points[m]={x:p[m][0],y:p[m][1],z:p[m][2]}},this.getPoint=function(p){return i=(this.points.length-1)*p,a=Math.floor(i),o=i-a,t[0]=a===0?a:a-1,t[1]=a,t[2]=a>this.points.length-2?this.points.length-1:a+1,t[3]=a>this.points.length-3?this.points.length-1:a+2,u=this.points[t[0]],h=this.points[t[1]],l=this.points[t[2]],f=this.points[t[3]],s=o*o,c=o*s,r.x=d(u.x,h.x,l.x,f.x,o,s,c),r.y=d(u.y,h.y,l.y,f.y,o,s,c),r.z=d(u.z,h.z,l.z,f.z,o,s,c),r},this.getControlPointsArray=function(){var p,m,y=this.points.length,g=[];for(p=0;p<y;p++)m=this.points[p],g[p]=[m.x,m.y,m.z];return g},this.getLength=function(p){var m,y,g,x,M=0,w=0,E=0,S=new n.Vector3,U=new n.Vector3,C=[],P=0;for(C[0]=0,p||(p=100),g=this.points.length*p,S.copy(this.points[0]),m=1;m<g;m++)y=m/g,x=this.getPoint(y),U.copy(x),P+=U.distanceTo(S),S.copy(x),M=(this.points.length-1)*y,w=Math.floor(M),w!==E&&(C[w]=P,E=w);return C[C.length]=P,{chunks:C,total:P}},this.reparametrizeByArcLength=function(p){var m,y,g,x,M,w,E,S,U=[],C=new n.Vector3,P=this.getLength();for(U.push(C.copy(this.points[0]).clone()),m=1;m<this.points.length;m++){for(w=P.chunks[m]-P.chunks[m-1],E=Math.ceil(p*w/P.total),x=(m-1)/(this.points.length-1),M=m/(this.points.length-1),y=1;y<E-1;y++)g=x+y*(1/E)*(M-x),S=this.getPoint(g),U.push(C.copy(S).clone());U.push(C.copy(this.points[m]).clone())}this.points=U};function d(p,m,y,g,x,M,w){var E=(y-p)*.5,S=(g-m)*.5;return(2*(m-y)+E+S)*w+(-3*(m-y)-2*E-S)*M+E*x+m}},n.Triangle=function(e,t,r){this.a=e!==void 0?e:new n.Vector3,this.b=t!==void 0?t:new n.Vector3,this.c=r!==void 0?r:new n.Vector3},n.Triangle.normal=function(){var e=new n.Vector3;return function(t,r,i,a){var o=a||new n.Vector3;o.subVectors(i,r),e.subVectors(t,r),o.cross(e);var s=o.lengthSq();return s>0?o.multiplyScalar(1/Math.sqrt(s)):o.set(0,0,0)}}(),n.Triangle.barycoordFromPoint=function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Vector3;return function(i,a,o,s,c){e.subVectors(s,a),t.subVectors(o,a),r.subVectors(i,a);var u=e.dot(e),h=e.dot(t),l=e.dot(r),f=t.dot(t),d=t.dot(r),p=u*f-h*h,m=c||new n.Vector3;if(p===0)return m.set(-2,-1,-1);var y=1/p,g=(f*l-h*d)*y,x=(u*d-h*l)*y;return m.set(1-g-x,x,g)}}(),n.Triangle.containsPoint=function(){var e=new n.Vector3;return function(t,r,i,a){var o=n.Triangle.barycoordFromPoint(t,r,i,a,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),n.Triangle.prototype={constructor:n.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new n.Vector3,t=new n.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),e.cross(t).length()*.5}}(),midpoint:function(e){var t=e||new n.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return n.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new n.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return n.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return n.Triangle.containsPoint(e,this.a,this.b,this.c)},closestPointToPoint:function(){var e,t,r,i;return function(o,s){e===void 0&&(e=new n.Plane,t=[new n.Line3,new n.Line3,new n.Line3],r=new n.Vector3,i=new n.Vector3);var c=s||new n.Vector3,u=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(o,r),this.containsPoint(r)===!0)c.copy(r);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var h=0;h<t.length;h++){t[h].closestPointToPoint(r,!0,i);var l=r.distanceToSquared(i);l<u&&(u=l,c.copy(i))}}return c}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},n.Interpolant=function(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r},n.Interpolant.prototype={constructor:n.Interpolant,evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,i=t[r],a=t[r-1];e:{t:{var o;n:{r:if(!(e<i)){for(var s=r+2;;){if(i===void 0){if(e<a)break r;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,a)}if(r===s)break;if(a=i,i=t[++r],e<i)break t}o=t.length;break n}if(!(e>=a)){var c=t[1];e<c&&(r=2,a=c);for(var s=r-2;;){if(a===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(r===s)break;if(i=a,a=t[--r-1],e>=a)break t}o=r,r=0;break n}break e}for(;r<o;){var u=r+o>>>1;e<t[u]?o=u:r=u+1}if(i=t[r],a=t[r-1],a===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(i===void 0)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,a,e)}this._cachedIndex=r,this.intervalChanged_(r,a,i)}return this.interpolate_(r,a,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,a=e*i,o=0;o!==i;++o)t[o]=r[a+o];return t},interpolate_:function(e,t,r,i){throw new Error("call to abstract method")},intervalChanged_:function(e,t,r){}},Object.assign(n.Interpolant.prototype,{beforeStart_:n.Interpolant.prototype.copySampleValue_,afterEnd_:n.Interpolant.prototype.copySampleValue_}),n.CubicInterpolant=function(e,t,r,i){n.Interpolant.call(this,e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0},n.CubicInterpolant.prototype=Object.assign(Object.create(n.Interpolant.prototype),{constructor:n.CubicInterpolant,DefaultSettings_:{endingStart:n.ZeroCurvatureEnding,endingEnd:n.ZeroCurvatureEnding},intervalChanged_:function(e,t,r){var i=this.parameterPositions,a=e-2,o=e+1,s=i[a],c=i[o];if(s===void 0)switch(this.getSettings_().endingStart){case n.ZeroSlopeEnding:a=e,s=2*t-r;break;case n.WrapAroundEnding:a=i.length-2,s=t+i[a]-i[a+1];break;default:a=e,s=r}if(c===void 0)switch(this.getSettings_().endingEnd){case n.ZeroSlopeEnding:o=e,c=2*r-t;break;case n.WrapAroundEnding:o=1,c=r+i[1]-i[0];break;default:o=e-1,c=t}var u=(r-t)*.5,h=this.valueSize;this._weightPrev=u/(t-s),this._weightNext=u/(c-r),this._offsetPrev=a*h,this._offsetNext=o*h},interpolate_:function(e,t,r,i){for(var a=this.resultBuffer,o=this.sampleValues,s=this.valueSize,c=e*s,u=c-s,h=this._offsetPrev,l=this._offsetNext,f=this._weightPrev,d=this._weightNext,p=(r-t)/(i-t),m=p*p,y=m*p,g=-f*y+2*f*m-f*p,x=(1+f)*y+(-1.5-2*f)*m+(-.5+f)*p+1,M=(-1-d)*y+(1.5+d)*m+.5*p,w=d*y-d*m,E=0;E!==s;++E)a[E]=g*o[h+E]+x*o[u+E]+M*o[c+E]+w*o[l+E];return a}}),n.DiscreteInterpolant=function(e,t,r,i){n.Interpolant.call(this,e,t,r,i)},n.DiscreteInterpolant.prototype=Object.assign(Object.create(n.Interpolant.prototype),{constructor:n.DiscreteInterpolant,interpolate_:function(e,t,r,i){return this.copySampleValue_(e-1)}}),n.LinearInterpolant=function(e,t,r,i){n.Interpolant.call(this,e,t,r,i)},n.LinearInterpolant.prototype=Object.assign(Object.create(n.Interpolant.prototype),{constructor:n.LinearInterpolant,interpolate_:function(e,t,r,i){for(var a=this.resultBuffer,o=this.sampleValues,s=this.valueSize,c=e*s,u=c-s,h=(r-t)/(i-t),l=1-h,f=0;f!==s;++f)a[f]=o[u+f]*l+o[c+f]*h;return a}}),n.QuaternionLinearInterpolant=function(e,t,r,i){n.Interpolant.call(this,e,t,r,i)},n.QuaternionLinearInterpolant.prototype=Object.assign(Object.create(n.Interpolant.prototype),{constructor:n.QuaternionLinearInterpolant,interpolate_:function(e,t,r,i){for(var a=this.resultBuffer,o=this.sampleValues,s=this.valueSize,c=e*s,u=(r-t)/(i-t),h=c+s;c!==h;c+=4)n.Quaternion.slerpFlat(a,0,o,c-s,o,c,u);return a}}),n.Clock=function(e){this.autoStart=e!==void 0?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},n.Clock.prototype={constructor:n.Clock,start:function(){this.startTime=(performance||Date).now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=(performance||Date).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}},n.EventDispatcher=function(){},Object.assign(n.EventDispatcher.prototype,{addEventListener:function(e,t){this._listeners===void 0&&(this._listeners={});var r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)},hasEventListener:function(e,t){if(this._listeners===void 0)return!1;var r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(this._listeners!==void 0){var r=this._listeners,i=r[e];if(i!==void 0){var a=i.indexOf(t);a!==-1&&i.splice(a,1)}}},dispatchEvent:function(e){if(this._listeners!==void 0){var t=this._listeners,r=t[e.type];if(r!==void 0){e.target=this;var i=[],a=0,o=r.length;for(a=0;a<o;a++)i[a]=r[a];for(a=0;a<o;a++)i[a].call(this,e)}}}}),n.Layers=function(){this.mask=1},n.Layers.prototype={constructor:n.Layers,set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)},test:function(e){return(this.mask&e.mask)!==0}},function(e){e.Raycaster=function(i,a,o,s){this.ray=new e.Ray(i,a),this.near=o||0,this.far=s||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})};function t(i,a){return i.distance-a.distance}function r(i,a,o,s){if(i.visible!==!1&&(i.raycast(a,o),s===!0))for(var c=i.children,u=0,h=c.length;u<h;u++)r(c[u],a,o,!0)}e.Raycaster.prototype={constructor:e.Raycaster,linePrecision:1,set:function(i,a){this.ray.set(i,a)},setFromCamera:function(i,a){a instanceof e.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(a.matrixWorld),this.ray.direction.set(i.x,i.y,.5).unproject(a).sub(this.ray.origin).normalize()):a instanceof e.OrthographicCamera?(this.ray.origin.set(i.x,i.y,-1).unproject(a),this.ray.direction.set(0,0,-1).transformDirection(a.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(i,a){var o=[];return r(i,this,o,a),o.sort(t),o},intersectObjects:function(i,a){var o=[];if(Array.isArray(i)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(var s=0,c=i.length;s<c;s++)r(i[s],this,o,a);return o.sort(t),o}}}(n),n.Object3D=function(){Object.defineProperty(this,"id",{value:n.Object3DIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.Object3D.DefaultUp.clone();var e=new n.Vector3,t=new n.Euler,r=new n.Quaternion,i=new n.Vector3(1,1,1);function a(){r.setFromEuler(t,!1)}function o(){t.setFromQuaternion(r,void 0,!1)}t.onChange(a),r.onChange(o),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:i},modelViewMatrix:{value:new n.Matrix4},normalMatrix:{value:new n.Matrix3}}),this.matrix=new n.Matrix4,this.matrixWorld=new n.Matrix4,this.matrixAutoUpdate=n.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new n.Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},n.Object3D.DefaultUp=new n.Vector3(0,1,0),n.Object3D.DefaultMatrixAutoUpdate=!0,Object.assign(n.Object3D.prototype,n.EventDispatcher.prototype,{applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new n.Quaternion;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new n.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new n.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new n.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new n.Vector3;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new n.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new n.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new n.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new n.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new n.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof n.Object3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var r=this.children.indexOf(e);r!==-1&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1))},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;r<i;r++){var a=this.children[r],o=a.getObjectByProperty(e,t);if(o!==void 0)return o}},getWorldPosition:function(e){var t=e||new n.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new n.Vector3,t=new n.Vector3;return function(r){var i=r||new n.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,i,t),i}}(),getWorldRotation:function(){var e=new n.Quaternion;return function(t){var r=t||new n.Euler;return this.getWorldQuaternion(e),r.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new n.Vector3,t=new n.Quaternion;return function(r){var i=r||new n.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(){var e=new n.Quaternion;return function(t){var r=t||new n.Vector3;return this.getWorldQuaternion(e),r.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(e){var t=e===void 0||e==="",r={};t&&(e={geometries:{},materials:{},textures:{},images:{}},r.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var i={};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),i.matrix=this.matrix.toArray(),this.geometry!==void 0&&(e.geometries[this.geometry.uuid]===void 0&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)),i.geometry=this.geometry.uuid),this.material!==void 0&&(e.materials[this.material.uuid]===void 0&&(e.materials[this.material.uuid]=this.material.toJSON(e)),i.material=this.material.uuid),this.children.length>0){i.children=[];for(var a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(t){var o=h(e.geometries),s=h(e.materials),c=h(e.textures),u=h(e.images);o.length>0&&(r.geometries=o),s.length>0&&(r.materials=s),c.length>0&&(r.textures=c),u.length>0&&(r.images=u)}return r.object=i,r;function h(l){var f=[];for(var d in l){var p=l[d];delete p.metadata,f.push(p)}return f}},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){if(t===void 0&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var r=0;r<e.children.length;r++){var i=e.children[r];this.add(i.clone())}return this}}),n.Object3DIdCount=0,n.Face3=function(e,t,r,i,a,o){this.a=e,this.b=t,this.c=r,this.normal=i instanceof n.Vector3?i:new n.Vector3,this.vertexNormals=Array.isArray(i)?i:[],this.color=a instanceof n.Color?a:new n.Color,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=o!==void 0?o:0},n.Face3.prototype={constructor:n.Face3,clone:function(){return new this.constructor().copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},n.BufferAttribute=function(e,t,r){this.uuid=n.Math.generateUUID(),this.array=e,this.itemSize=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0,this.normalized=r===!0},n.BufferAttribute.prototype={constructor:n.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var i=0,a=this.itemSize;i<a;i++)this.array[e+i]=t.array[r+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,i=0,a=e.length;i<a;i++){var o=e[i];o===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new n.Color),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b}return this},copyIndicesArray:function(e){for(var t=this.array,r=0,i=0,a=e.length;i<a;i++){var o=e[i];t[r++]=o.a,t[r++]=o.b,t[r++]=o.c}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,i=0,a=e.length;i<a;i++){var o=e[i];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new n.Vector2),t[r++]=o.x,t[r++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,i=0,a=e.length;i<a;i++){var o=e[i];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new n.Vector3),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,i=0,a=e.length;i<a;i++){var o=e[i];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new n.Vector4),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w}return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this},setXYZW:function(e,t,r,i,a){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=a,this},clone:function(){return new this.constructor().copy(this)}},n.Int8Attribute=function(e,t){return new n.BufferAttribute(new Int8Array(e),t)},n.Uint8Attribute=function(e,t){return new n.BufferAttribute(new Uint8Array(e),t)},n.Uint8ClampedAttribute=function(e,t){return new n.BufferAttribute(new Uint8ClampedArray(e),t)},n.Int16Attribute=function(e,t){return new n.BufferAttribute(new Int16Array(e),t)},n.Uint16Attribute=function(e,t){return new n.BufferAttribute(new Uint16Array(e),t)},n.Int32Attribute=function(e,t){return new n.BufferAttribute(new Int32Array(e),t)},n.Uint32Attribute=function(e,t){return new n.BufferAttribute(new Uint32Array(e),t)},n.Float32Attribute=function(e,t){return new n.BufferAttribute(new Float32Array(e),t)},n.Float64Attribute=function(e,t){return new n.BufferAttribute(new Float64Array(e),t)},n.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new n.BufferAttribute(e,t).setDynamic(!0)},n.InstancedBufferAttribute=function(e,t,r){n.BufferAttribute.call(this,e,t),this.meshPerAttribute=r||1},n.InstancedBufferAttribute.prototype=Object.create(n.BufferAttribute.prototype),n.InstancedBufferAttribute.prototype.constructor=n.InstancedBufferAttribute,n.InstancedBufferAttribute.prototype.copy=function(e){return n.BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},n.InterleavedBuffer=function(e,t){this.uuid=n.Math.generateUUID(),this.array=e,this.stride=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},n.InterleavedBuffer.prototype={constructor:n.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var i=0,a=this.stride;i<a;i++)this.array[e+i]=t.array[r+i];return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},clone:function(){return new this.constructor().copy(this)}},n.InstancedInterleavedBuffer=function(e,t,r){n.InterleavedBuffer.call(this,e,t),this.meshPerAttribute=r||1},n.InstancedInterleavedBuffer.prototype=Object.create(n.InterleavedBuffer.prototype),n.InstancedInterleavedBuffer.prototype.constructor=n.InstancedInterleavedBuffer,n.InstancedInterleavedBuffer.prototype.copy=function(e){return n.InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},n.InterleavedBufferAttribute=function(e,t,r){this.uuid=n.Math.generateUUID(),this.data=e,this.itemSize=t,this.offset=r},n.InterleavedBufferAttribute.prototype={constructor:n.InterleavedBufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.data.count},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this},setXYZW:function(e,t,r,i,a){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=a,this}},n.Geometry=function(){Object.defineProperty(this,"id",{value:n.GeometryIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},Object.assign(n.Geometry.prototype,n.EventDispatcher.prototype,{applyMatrix:function(e){for(var t=new n.Matrix3().getNormalMatrix(e),r=0,i=this.vertices.length;r<i;r++){var a=this.vertices[r];a.applyMatrix4(e)}for(var r=0,i=this.faces.length;r<i;r++){var o=this.faces[r];o.normal.applyMatrix3(t).normalize();for(var s=0,c=o.vertexNormals.length;s<c;s++)o.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e;return function(r){return e===void 0&&(e=new n.Matrix4),e.makeRotationX(r),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(r){return e===void 0&&(e=new n.Matrix4),e.makeRotationY(r),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(r){return e===void 0&&(e=new n.Matrix4),e.makeRotationZ(r),this.applyMatrix(e),this}}(),translate:function(){var e;return function(r,i,a){return e===void 0&&(e=new n.Matrix4),e.makeTranslation(r,i,a),this.applyMatrix(e),this}}(),scale:function(){var e;return function(r,i,a){return e===void 0&&(e=new n.Matrix4),e.makeScale(r,i,a),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(r){e===void 0&&(e=new n.Object3D),e.lookAt(r),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this,r=e.index!==null?e.index.array:void 0,i=e.attributes,a=i.position.array,o=i.normal!==void 0?i.normal.array:void 0,s=i.color!==void 0?i.color.array:void 0,c=i.uv!==void 0?i.uv.array:void 0,u=i.uv2!==void 0?i.uv2.array:void 0;u!==void 0&&(this.faceVertexUvs[1]=[]);for(var h=[],l=[],f=[],d=0,p=0;d<a.length;d+=3,p+=2)t.vertices.push(new n.Vector3(a[d],a[d+1],a[d+2])),o!==void 0&&h.push(new n.Vector3(o[d],o[d+1],o[d+2])),s!==void 0&&t.colors.push(new n.Color(s[d],s[d+1],s[d+2])),c!==void 0&&l.push(new n.Vector2(c[p],c[p+1])),u!==void 0&&f.push(new n.Vector2(u[p],u[p+1]));function m(E,S,U,C){var P=o!==void 0?[h[E].clone(),h[S].clone(),h[U].clone()]:[],B=s!==void 0?[t.colors[E].clone(),t.colors[S].clone(),t.colors[U].clone()]:[],F=new n.Face3(E,S,U,P,B,C);t.faces.push(F),c!==void 0&&t.faceVertexUvs[0].push([l[E].clone(),l[S].clone(),l[U].clone()]),u!==void 0&&t.faceVertexUvs[1].push([f[E].clone(),f[S].clone(),f[U].clone()])}if(r!==void 0){var y=e.groups;if(y.length>0)for(var d=0;d<y.length;d++)for(var g=y[d],x=g.start,M=g.count,p=x,w=x+M;p<w;p+=3)m(r[p],r[p+1],r[p+2],g.materialIndex);else for(var d=0;d<r.length;d+=3)m(r[d],r[d+1],r[d+2])}else for(var d=0;d<a.length/3;d+=3)m(d,d+1,d+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=t===0?1:1/t,i=new n.Matrix4;return i.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new n.Vector3,t=new n.Vector3,r=0,i=this.faces.length;r<i;r++){var a=this.faces[r],o=this.vertices[a.a],s=this.vertices[a.b],c=this.vertices[a.c];e.subVectors(c,s),t.subVectors(o,s),e.cross(t),e.normalize(),a.normal.copy(e)}},computeVertexNormals:function(e){e===void 0&&(e=!0);var t,r,i,a,o,s;for(s=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)s[t]=new n.Vector3;if(e){var c,u,h,l=new n.Vector3,f=new n.Vector3;for(i=0,a=this.faces.length;i<a;i++)o=this.faces[i],c=this.vertices[o.a],u=this.vertices[o.b],h=this.vertices[o.c],l.subVectors(h,u),f.subVectors(c,u),l.cross(f),s[o.a].add(l),s[o.b].add(l),s[o.c].add(l)}else for(i=0,a=this.faces.length;i<a;i++)o=this.faces[i],s[o.a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,r=this.vertices.length;t<r;t++)s[t].normalize();for(i=0,a=this.faces.length;i<a;i++){o=this.faces[i];var d=o.vertexNormals;d.length===3?(d[0].copy(s[o.a]),d[1].copy(s[o.b]),d[2].copy(s[o.c])):(d[0]=s[o.a].clone(),d[1]=s[o.b].clone(),d[2]=s[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,i,a;for(r=0,i=this.faces.length;r<i;r++)for(a=this.faces[r],a.__originalFaceNormal?a.__originalFaceNormal.copy(a.normal):a.__originalFaceNormal=a.normal.clone(),a.__originalVertexNormals||(a.__originalVertexNormals=[]),e=0,t=a.vertexNormals.length;e<t;e++)a.__originalVertexNormals[e]?a.__originalVertexNormals[e].copy(a.vertexNormals[e]):a.__originalVertexNormals[e]=a.vertexNormals[e].clone();var o=new n.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,c=this.morphNormals[e].vertexNormals,h,l;for(r=0,i=this.faces.length;r<i;r++)h=new n.Vector3,l={a:new n.Vector3,b:new n.Vector3,c:new n.Vector3},s.push(h),c.push(l)}var u=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals();var h,l;for(r=0,i=this.faces.length;r<i;r++)a=this.faces[r],h=u.faceNormals[r],l=u.vertexNormals[r],h.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}for(r=0,i=this.faces.length;r<i;r++)a=this.faces[r],a.normal=a.__originalFaceNormal,a.vertexNormals=a.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,i=t.length;r<i;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new n.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new n.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(!(e instanceof n.Geometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var i,a=this.vertices.length,o=this.vertices,s=e.vertices,c=this.faces,u=e.faces,h=this.faceVertexUvs[0],l=e.faceVertexUvs[0];r===void 0&&(r=0),t!==void 0&&(i=new n.Matrix3().getNormalMatrix(t));for(var f=0,d=s.length;f<d;f++){var p=s[f],m=p.clone();t!==void 0&&m.applyMatrix4(t),o.push(m)}for(f=0,d=u.length;f<d;f++){var y=u[f],g,x,M,w=y.vertexNormals,E=y.vertexColors;g=new n.Face3(y.a+a,y.b+a,y.c+a),g.normal.copy(y.normal),i!==void 0&&g.normal.applyMatrix3(i).normalize();for(var S=0,U=w.length;S<U;S++)x=w[S].clone(),i!==void 0&&x.applyMatrix3(i).normalize(),g.vertexNormals.push(x);g.color.copy(y.color);for(var S=0,U=E.length;S<U;S++)M=E[S],g.vertexColors.push(M.clone());g.materialIndex=y.materialIndex+r,c.push(g)}for(f=0,d=l.length;f<d;f++){var C=l[f],P=[];if(C!==void 0){for(var S=0,U=C.length;S<U;S++)P.push(C[S].clone());h.push(P)}}},mergeMesh:function(e){if(!(e instanceof n.Mesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e={},t=[],r=[],i,a,o=4,s=Math.pow(10,o),c,u,h,l,f,d;for(c=0,u=this.vertices.length;c<u;c++)i=this.vertices[c],a=Math.round(i.x*s)+"_"+Math.round(i.y*s)+"_"+Math.round(i.z*s),e[a]===void 0?(e[a]=c,t.push(this.vertices[c]),r[c]=t.length-1):r[c]=r[e[a]];var p=[];for(c=0,u=this.faces.length;c<u;c++){h=this.faces[c],h.a=r[h.a],h.b=r[h.b],h.c=r[h.c],l=[h.a,h.b,h.c];for(var m=0;m<3;m++)if(l[m]===l[(m+1)%3]){p.push(c);break}}for(c=p.length-1;c>=0;c--){var y=p[c];for(this.faces.splice(y,1),f=0,d=this.faceVertexUvs.length;f<d;f++)this.faceVertexUvs[f].splice(y,1)}var g=this.vertices.length-t.length;return this.vertices=t,g},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;function i(h,l){return h.materialIndex-l.materialIndex}e.sort(i);var a=this.faceVertexUvs[0],o=this.faceVertexUvs[1],s,c;a&&a.length===t&&(s=[]),o&&o.length===t&&(c=[]);for(var r=0;r<t;r++){var u=e[r]._id;s&&s.push(a[u]),c&&c.push(o[u])}s&&(this.faceVertexUvs[0]=s),c&&(this.faceVertexUvs[1]=c)},toJSON:function(){var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){var t=this.parameters;for(var r in t)t[r]!==void 0&&(e[r]=t[r]);return e}for(var i=[],a=0;a<this.vertices.length;a++){var o=this.vertices[a];i.push(o.x,o.y,o.z)}for(var s=[],c=[],u={},h=[],l={},f=[],d={},a=0;a<this.faces.length;a++){var p=this.faces[a],m=!0,y=!1,g=this.faceVertexUvs[0][a]!==void 0,x=p.normal.length()>0,M=p.vertexNormals.length>0,w=p.color.r!==1||p.color.g!==1||p.color.b!==1,E=p.vertexColors.length>0,S=0;if(S=B(S,0,0),S=B(S,1,m),S=B(S,2,y),S=B(S,3,g),S=B(S,4,x),S=B(S,5,M),S=B(S,6,w),S=B(S,7,E),s.push(S),s.push(p.a,p.b,p.c),s.push(p.materialIndex),g){var U=this.faceVertexUvs[0][a];s.push(W(U[0]),W(U[1]),W(U[2]))}if(x&&s.push(F(p.normal)),M){var C=p.vertexNormals;s.push(F(C[0]),F(C[1]),F(C[2]))}if(w&&s.push(N(p.color)),E){var P=p.vertexColors;s.push(N(P[0]),N(P[1]),N(P[2]))}}function B(I,k,T){return T?I|1<<k:I&~(1<<k)}function F(I){var k=I.x.toString()+I.y.toString()+I.z.toString();return u[k]!==void 0||(u[k]=c.length/3,c.push(I.x,I.y,I.z)),u[k]}function N(I){var k=I.r.toString()+I.g.toString()+I.b.toString();return l[k]!==void 0||(l[k]=h.length,h.push(I.getHex())),l[k]}function W(I){var k=I.x.toString()+I.y.toString();return d[k]!==void 0||(d[k]=f.length/2,f.push(I.x,I.y)),d[k]}return e.data={},e.data.vertices=i,e.data.normals=c,h.length>0&&(e.data.colors=h),f.length>0&&(e.data.uvs=[f]),e.data.faces=s,e},clone:function(){return new n.Geometry().copy(this)},copy:function(e){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var t=e.vertices,r=0,i=t.length;r<i;r++)this.vertices.push(t[r].clone());for(var a=e.faces,r=0,i=a.length;r<i;r++)this.faces.push(a[r].clone());for(var r=0,i=e.faceVertexUvs.length;r<i;r++){var o=e.faceVertexUvs[r];this.faceVertexUvs[r]===void 0&&(this.faceVertexUvs[r]=[]);for(var s=0,c=o.length;s<c;s++){for(var u=o[s],h=[],l=0,f=u.length;l<f;l++){var d=u[l];h.push(d.clone())}this.faceVertexUvs[r].push(h)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),n.GeometryIdCount=0,n.DirectGeometry=function(){Object.defineProperty(this,"id",{value:n.GeometryIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},Object.assign(n.DirectGeometry.prototype,n.EventDispatcher.prototype,{computeBoundingBox:n.Geometry.prototype.computeBoundingBox,computeBoundingSphere:n.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(e){for(var t,r=[],i,a=e.faces,o=0;o<a.length;o++){var s=a[o];s.materialIndex!==i&&(i=s.materialIndex,t!==void 0&&(t.count=o*3-t.start,r.push(t)),t={start:o*3,materialIndex:i})}t!==void 0&&(t.count=o*3-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t=e.faces,r=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,c=s.length,u;if(c>0){u=[];for(var h=0;h<c;h++)u[h]=[];this.morphTargets.position=u}var l=e.morphNormals,f=l.length,d;if(f>0){d=[];for(var h=0;h<f;h++)d[h]=[];this.morphTargets.normal=d}for(var p=e.skinIndices,m=e.skinWeights,y=p.length===r.length,g=m.length===r.length,h=0;h<t.length;h++){var x=t[h];this.vertices.push(r[x.a],r[x.b],r[x.c]);var M=x.vertexNormals;if(M.length===3)this.normals.push(M[0],M[1],M[2]);else{var w=x.normal;this.normals.push(w,w,w)}var E=x.vertexColors;if(E.length===3)this.colors.push(E[0],E[1],E[2]);else{var S=x.color;this.colors.push(S,S,S)}if(a===!0){var U=i[0][h];U!==void 0?this.uvs.push(U[0],U[1],U[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",h),this.uvs.push(new n.Vector2,new n.Vector2,new n.Vector2))}if(o===!0){var U=i[1][h];U!==void 0?this.uvs2.push(U[0],U[1],U[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",h),this.uvs2.push(new n.Vector2,new n.Vector2,new n.Vector2))}for(var C=0;C<c;C++){var P=s[C].vertices;u[C].push(P[x.a],P[x.b],P[x.c])}for(var C=0;C<f;C++){var B=l[C].vertexNormals[h];d[C].push(B.a,B.b,B.c)}y&&this.skinIndices.push(p[x.a],p[x.b],p[x.c]),g&&this.skinWeights.push(m[x.a],m[x.b],m[x.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),n.BufferGeometry=function(){Object.defineProperty(this,"id",{value:n.GeometryIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},Object.assign(n.BufferGeometry.prototype,n.EventDispatcher.prototype,{getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t){if(!(t instanceof n.BufferAttribute)&&!(t instanceof n.InterleavedBufferAttribute)){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new n.BufferAttribute(arguments[1],arguments[2]));return}if(e==="index"){console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t);return}return this.attributes[e]=t,this},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:r!==void 0?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;t!==void 0&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var r=this.attributes.normal;if(r!==void 0){var i=new n.Matrix3().getNormalMatrix(e);i.applyToVector3Array(r.array),r.needsUpdate=!0}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(){var e;return function(r){return e===void 0&&(e=new n.Matrix4),e.makeRotationX(r),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(r){return e===void 0&&(e=new n.Matrix4),e.makeRotationY(r),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(r){return e===void 0&&(e=new n.Matrix4),e.makeRotationZ(r),this.applyMatrix(e),this}}(),translate:function(){var e;return function(r,i,a){return e===void 0&&(e=new n.Matrix4),e.makeTranslation(r,i,a),this.applyMatrix(e),this}}(),scale:function(){var e;return function(r,i,a){return e===void 0&&(e=new n.Matrix4),e.makeScale(r,i,a),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(r){e===void 0&&(e=new n.Object3D),e.lookAt(r),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e instanceof n.Points||e instanceof n.Line){var r=new n.Float32Attribute(t.vertices.length*3,3),i=new n.Float32Attribute(t.colors.length*3,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var a=new n.Float32Attribute(t.lineDistances.length,1);this.addAttribute("lineDistance",a.copyArray(t.lineDistances))}t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone())}else e instanceof n.Mesh&&t instanceof n.Geometry&&this.fromGeometry(t);return this},updateFromObject:function(e){var t=e.geometry;if(e instanceof n.Mesh){var r=t.__directGeometry;if(r===void 0)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate,r.normalsNeedUpdate=t.normalsNeedUpdate,r.colorsNeedUpdate=t.colorsNeedUpdate,r.uvsNeedUpdate=t.uvsNeedUpdate,r.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=r}if(t.verticesNeedUpdate===!0){var i=this.attributes.position;i!==void 0&&(i.copyVector3sArray(t.vertices),i.needsUpdate=!0),t.verticesNeedUpdate=!1}if(t.normalsNeedUpdate===!0){var i=this.attributes.normal;i!==void 0&&(i.copyVector3sArray(t.normals),i.needsUpdate=!0),t.normalsNeedUpdate=!1}if(t.colorsNeedUpdate===!0){var i=this.attributes.color;i!==void 0&&(i.copyColorsArray(t.colors),i.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){var i=this.attributes.uv;i!==void 0&&(i.copyVector2sArray(t.uvs),i.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){var i=this.attributes.lineDistance;i!==void 0&&(i.copyArray(t.lineDistances),i.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new n.DirectGeometry().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(e.vertices.length*3);if(this.addAttribute("position",new n.BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(e.normals.length*3);this.addAttribute("normal",new n.BufferAttribute(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(e.colors.length*3);this.addAttribute("color",new n.BufferAttribute(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var a=new Float32Array(e.uvs.length*2);this.addAttribute("uv",new n.BufferAttribute(a,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(e.uvs2.length*2);this.addAttribute("uv2",new n.BufferAttribute(o,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var s=e.vertices.length>65535?Uint32Array:Uint16Array,c=new s(e.indices.length*3);this.setIndex(new n.BufferAttribute(c,1).copyIndicesArray(e.indices))}this.groups=e.groups;for(var u in e.morphTargets){for(var h=[],l=e.morphTargets[u],f=0,d=l.length;f<d;f++){var p=l[f],m=new n.Float32Attribute(p.length*3,3);h.push(m.copyVector3sArray(p))}this.morphAttributes[u]=h}if(e.skinIndices.length>0){var y=new n.Float32Attribute(e.skinIndices.length*4,4);this.addAttribute("skinIndex",y.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var g=new n.Float32Attribute(e.skinWeights.length*4,4);this.addAttribute("skinWeight",g.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new n.Box3);var e=this.attributes.position.array;e!==void 0?this.boundingBox.setFromArray(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new n.Box3,t=new n.Vector3;return function(){this.boundingSphere===null&&(this.boundingSphere=new n.Sphere);var i=this.attributes.position.array;if(i){var a=this.boundingSphere.center;e.setFromArray(i),e.center(a);for(var o=0,s=0,c=i.length;s<c;s+=3)t.fromArray(i,s),o=Math.max(o,a.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,r=this.groups;if(t.position){var i=t.position.array;if(t.normal===void 0)this.addAttribute("normal",new n.BufferAttribute(new Float32Array(i.length),3));else for(var a=t.normal.array,o=0,s=a.length;o<s;o++)a[o]=0;var c=t.normal.array,u,h,l,f=new n.Vector3,d=new n.Vector3,p=new n.Vector3,m=new n.Vector3,y=new n.Vector3;if(e){var g=e.array;r.length===0&&this.addGroup(0,g.length);for(var x=0,M=r.length;x<M;++x)for(var w=r[x],E=w.start,S=w.count,o=E,s=E+S;o<s;o+=3)u=g[o+0]*3,h=g[o+1]*3,l=g[o+2]*3,f.fromArray(i,u),d.fromArray(i,h),p.fromArray(i,l),m.subVectors(p,d),y.subVectors(f,d),m.cross(y),c[u]+=m.x,c[u+1]+=m.y,c[u+2]+=m.z,c[h]+=m.x,c[h+1]+=m.y,c[h+2]+=m.z,c[l]+=m.x,c[l+1]+=m.y,c[l+2]+=m.z}else for(var o=0,s=i.length;o<s;o+=9)f.fromArray(i,o),d.fromArray(i,o+3),p.fromArray(i,o+6),m.subVectors(p,d),y.subVectors(f,d),m.cross(y),c[o]=m.x,c[o+1]=m.y,c[o+2]=m.z,c[o+3]=m.x,c[o+4]=m.y,c[o+5]=m.z,c[o+6]=m.x,c[o+7]=m.y,c[o+8]=m.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(!(e instanceof n.BufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0);var r=this.attributes;for(var i in r)if(e.attributes[i]!==void 0)for(var a=r[i],o=a.array,s=e.attributes[i],c=s.array,u=s.itemSize,h=0,l=u*t;h<c.length;h++,l++)o[l]=c[h];return this},normalizeNormals:function(){for(var e=this.attributes.normal.array,t,r,i,a,o=0,s=e.length;o<s;o+=3)t=e[o],r=e[o+1],i=e[o+2],a=1/Math.sqrt(t*t+r*r+i*i),e[o]*=a,e[o+1]*=a,e[o+2]*=a},toNonIndexed:function(){if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new n.BufferGeometry,t=this.index.array,r=this.attributes;for(var i in r){for(var a=r[i],o=a.array,s=a.itemSize,c=new o.constructor(t.length*s),u=0,h=0,l=0,f=t.length;l<f;l++){u=t[l]*s;for(var d=0;d<s;d++)c[h++]=o[u++]}e.addAttribute(i,new n.BufferAttribute(c,s))}return e},toJSON:function(){var e={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){var t=this.parameters;for(var r in t)t[r]!==void 0&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;if(i!==null){var a=Array.prototype.slice.call(i.array);e.data.index={type:i.array.constructor.name,array:a}}var o=this.attributes;for(var r in o){var s=o[r],a=Array.prototype.slice.call(s.array);e.data.attributes[r]={itemSize:s.itemSize,type:s.array.constructor.name,array:a,normalized:s.normalized}}var c=this.groups;c.length>0&&(e.data.groups=JSON.parse(JSON.stringify(c)));var u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e},clone:function(){return new n.BufferGeometry().copy(this)},copy:function(e){var t=e.index;t!==null&&this.setIndex(t.clone());var r=e.attributes;for(var i in r){var a=r[i];this.addAttribute(i,a.clone())}for(var o=e.groups,s=0,c=o.length;s<c;s++){var u=o[s];this.addGroup(u.start,u.count,u.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),n.BufferGeometry.MaxIndex=65535,n.InstancedBufferGeometry=function(){n.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},n.InstancedBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.InstancedBufferGeometry.prototype.constructor=n.InstancedBufferGeometry,n.InstancedBufferGeometry.prototype.addGroup=function(e,t,r){this.groups.push({start:e,count:t,instances:r})},n.InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;t!==null&&this.setIndex(t.clone());var r=e.attributes;for(var i in r){var a=r[i];this.addAttribute(i,a.clone())}for(var o=e.groups,s=0,c=o.length;s<c;s++){var u=o[s];this.addGroup(u.start,u.count,u.instances)}return this},n.Uniform=function(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e,this.dynamic=!1},n.Uniform.prototype={constructor:n.Uniform,onUpdate:function(e){return this.dynamic=!0,this.onUpdateCallback=e,this}},n.AnimationAction=function(){throw new Error("THREE.AnimationAction: Use mixer.clipAction for construction.")},n.AnimationAction._new=function(t,r,i){this._mixer=t,this._clip=r,this._localRoot=i||null;for(var a=r.tracks,o=a.length,s=new Array(o),c={endingStart:n.ZeroCurvatureEnding,endingEnd:n.ZeroCurvatureEnding},u=0;u!==o;++u){var h=a[u].createInterpolant(null);s[u]=h,h.settings=c}this._interpolantSettings=c,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=n.LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0},n.AnimationAction._new.prototype={constructor:n.AnimationAction._new,play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this._startTime,this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(this._mixer,e.fadeOut(t),this.fadeIn(t),r){var i=this._clip.duration,a=e._clip.duration,o=a/i,s=i/a;e.warp(1,o,t),this.warp(s,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var i=this._mixer,a=i.time,o=this._timeScaleInterpolant,s=this.timeScale;o===null&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var c=o.parameterPositions,u=o.sampleValues;return c[0]=a,c[1]=a+r,u[0]=e/s,u[1]=t/s,this},stopWarping:function(){var e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,i){var a=this._startTime;if(a!==null){var o=(e-a)*r;if(o<0||r===0)return;this._startTime=null,t=r*o}t*=this._updateTimeScale(e);var s=this._updateTime(t),c=this._updateWeight(e);if(c>0)for(var u=this._interpolants,h=this._propertyBindings,l=0,f=u.length;l!==f;++l)u[l].evaluate(s),h[l].accumulate(i,c)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(r!==null){var i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(r!==null){var i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e;if(e===0)return t;var r=this._clip.duration,i=this.loop,a=this._loopCount;if(i===n.LoopOnce){a===-1&&(this.loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else if(t<0)t=0;else break e;this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{var o=i===n.LoopPingPong;if(a===-1&&(e>=0?(a=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),t>=r||t<0){var s=Math.floor(t/r);t-=r*s,a+=Math.abs(s);var c=this.repetitions-a;if(c<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===0){var u=e<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=a,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}if(o&&(a&1)===1)return this.time=t,r-t}return this.time=t,t},_setEndings:function(e,t,r){var i=this._interpolantSettings;r?(i.endingStart=n.ZeroSlopeEnding,i.endingEnd=n.ZeroSlopeEnding):(e?i.endingStart=this.zeroSlopeAtStart?n.ZeroSlopeEnding:n.ZeroCurvatureEnding:i.endingStart=n.WrapAroundEnding,t?i.endingEnd=this.zeroSlopeAtEnd?n.ZeroSlopeEnding:n.ZeroCurvatureEnding:i.endingEnd=n.WrapAroundEnding)},_scheduleFading:function(e,t,r){var i=this._mixer,a=i.time,o=this._weightInterpolant;o===null&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);var s=o.parameterPositions,c=o.sampleValues;return s[0]=a,c[0]=t,s[1]=a+e,c[1]=r,this}},n.AnimationClip=function(e,t,r){this.name=e,this.tracks=r,this.duration=t!==void 0?t:-1,this.uuid=n.Math.generateUUID(),this.duration<0&&this.resetDuration(),this.trim(),this.optimize()},n.AnimationClip.prototype={constructor:n.AnimationClip,resetDuration:function(){for(var e=this.tracks,t=0,r=0,i=e.length;r!==i;++r){var a=this.tracks[r];t=Math.max(t,a.times[a.times.length-1])}this.duration=t},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},Object.assign(n.AnimationClip,{parse:function(e){for(var t=[],r=e.tracks,i=1/(e.fps||1),a=0,o=r.length;a!==o;++a)t.push(n.KeyframeTrack.parse(r[a]).scale(i));return new n.AnimationClip(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t},a=0,o=r.length;a!==o;++a)t.push(n.KeyframeTrack.toJSON(r[a]));return i},CreateFromMorphTargetSequence:function(e,t,r,i){for(var a=t.length,o=[],s=0;s<a;s++){var c=[],u=[];c.push((s+a-1)%a,s,(s+1)%a),u.push(0,1,0);var h=n.AnimationUtils.getKeyframeOrder(c);c=n.AnimationUtils.sortedArray(c,1,h),u=n.AnimationUtils.sortedArray(u,1,h),!i&&c[0]===0&&(c.push(a),u.push(u[0])),o.push(new n.NumberKeyframeTrack(".morphTargetInfluences["+t[s].name+"]",c,u).scale(1/r))}return new n.AnimationClip(e,-1,o)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var i=e;r=i.geometry&&i.geometry.animations||i.animations}for(var a=0;a<r.length;a++)if(r[a].name===t)return r[a];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var i={},a=/^([\w-]*?)([\d]+)$/,o=0,s=e.length;o<s;o++){var c=e[o],u=c.name.match(a);if(u&&u.length>1){var h=u[1],l=i[h];l||(i[h]=l=[]),l.push(c)}}var f=[];for(var h in i)f.push(n.AnimationClip.CreateFromMorphTargetSequence(h,i[h],t,r));return f},parseAnimation:function(e,t,r){if(!e)return console.error("  no animation in JSONLoader data"),null;for(var i=function(E,S,U,C,P){if(U.length!==0){var B=[],F=[];n.AnimationUtils.flattenJSON(U,B,F,C),B.length!==0&&P.push(new E(S,B,F))}},a=[],o=e.name||"default",s=e.length||-1,c=e.fps||30,u=e.hierarchy||[],h=0;h<u.length;h++){var l=u[h].keys;if(!(!l||l.length===0))if(l[0].morphTargets){for(var f={},d=0;d<l.length;d++)if(l[d].morphTargets)for(var p=0;p<l[d].morphTargets.length;p++)f[l[d].morphTargets[p]]=-1;for(var m in f){for(var y=[],g=[],p=0;p!==l[d].morphTargets.length;++p){var x=l[d];y.push(x.time),g.push(x.morphTarget===m?1:0)}a.push(new n.NumberKeyframeTrack(".morphTargetInfluence["+m+"]",y,g))}s=f.length*(c||1)}else{var M=".bones["+t[h].name+"]";i(n.VectorKeyframeTrack,M+".position",l,"pos",a),i(n.QuaternionKeyframeTrack,M+".quaternion",l,"rot",a),i(n.VectorKeyframeTrack,M+".scale",l,"scl",a)}}if(a.length===0)return null;var w=new n.AnimationClip(o,s,a);return w}}),n.AnimationMixer=function(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1},Object.assign(n.AnimationMixer.prototype,n.EventDispatcher.prototype,{clipAction:function(e,t){var r=t||this._root,i=r.uuid,a=typeof e=="string"?n.AnimationClip.findByName(r,e):e,o=a!==null?a.uuid:e,s=this._actionsByClip[o],c=null;if(s!==void 0){var u=s.actionByRoot[i];if(u!==void 0)return u;c=s.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;var h=new n.AnimationMixer._Action(this,a,t);return this._bindAction(h,c),this._addInactiveAction(h,o,i),h},existingAction:function(e,t){var r=t||this._root,i=r.uuid,a=typeof e=="string"?n.AnimationClip.findByName(r,e):e,o=a?a.uuid:e,s=this._actionsByClip[o];return s!==void 0&&s.actionByRoot[i]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var a=0;a!==t;++a)e[a].reset();for(var a=0;a!==i;++a)r[a].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,i=this.time+=e,a=Math.sign(e),o=this._accuIndex^=1,s=0;s!==r;++s){var c=t[s];c.enabled&&c._update(i,e,a,o)}for(var u=this._bindings,h=this._nActiveBindings,s=0;s!==h;++s)u[s].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,i=this._actionsByClip,a=i[r];if(a!==void 0){for(var o=a.knownActions,s=0,c=o.length;s!==c;++s){var u=o[s];this._deactivateAction(u);var h=u._cacheIndex,l=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,l._cacheIndex=h,t[h]=l,t.pop(),this._removeInactiveBindingsForAction(u)}delete i[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var i in r){var a=r[i].actionByRoot,o=a[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}var s=this._bindingsByRootAndName,c=s[t];if(c!==void 0)for(var u in c){var h=c[u];h.restoreOriginalState(),this._removeInactiveBinding(h)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),n.AnimationMixer._Action=n.AnimationAction._new,Object.assign(n.AnimationMixer.prototype,{_bindAction:function(e,t){var r=e._localRoot||this._root,i=e._clip.tracks,a=i.length,o=e._propertyBindings,s=e._interpolants,c=r.uuid,u=this._bindingsByRootAndName,h=u[c];h===void 0&&(h={},u[c]=h);for(var l=0;l!==a;++l){var f=i[l],d=f.name,p=h[d];if(p!==void 0)o[l]=p;else{if(p=o[l],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,c,d));continue}var m=t&&t._propertyBindings[l].binding.parsedPath;p=new n.PropertyMixer(n.PropertyBinding.create(r,d,m),f.ValueTypeName,f.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,c,d),o[l]=p}s[l].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t)}for(var a=e._propertyBindings,o=0,s=a.length;o!==s;++o){var c=a[o];c.useCount++===0&&(this._lendBinding(c),c.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var a=t[r];--a.useCount===0&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return t!==null&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var i=this._actions,a=this._actionsByClip,o=a[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=o;else{var s=o.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;var a=e._clip.uuid,o=this._actionsByClip,s=o[a],c=s.knownActions,u=c[c.length-1],h=e._byClipCacheIndex;u._byClipCacheIndex=h,c[h]=u,c.pop(),e._byClipCacheIndex=null;var l=s.actionByRoot,f=(t._localRoot||this._root).uuid;delete l[f],c.length===0&&delete o[a],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var a=t[r];--a.referenceCount===0&&this._removeInactiveBinding(a)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,a=t[i];e._cacheIndex=i,t[i]=e,a._cacheIndex=r,t[r]=a},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,a=t[i];e._cacheIndex=i,t[i]=e,a._cacheIndex=r,t[r]=a},_addInactiveBinding:function(e,t,r){var i=this._bindingsByRootAndName,a=i[t],o=this._bindings;a===void 0&&(a={},i[t]=a),a[r]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,i=r.rootNode.uuid,a=r.path,o=this._bindingsByRootAndName,s=o[i],c=t[t.length-1],u=e._cacheIndex;c._cacheIndex=u,t[u]=c,t.pop(),delete s[a];e:{for(var h in s)break e;delete o[i]}},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,a=t[i];e._cacheIndex=i,t[i]=e,a._cacheIndex=r,t[r]=a},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,a=t[i];e._cacheIndex=i,t[i]=e,a._cacheIndex=r,t[r]=a},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return r===void 0&&(r=new n.LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,a=t[i];e.__cacheIndex=i,t[i]=e,a.__cacheIndex=r,t[r]=a},_controlInterpolantsResultBuffer:new Float32Array(1)}),n.AnimationObjectGroup=function(e){this.uuid=n.Math.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var r=0,i=arguments.length;r!==i;++r)t[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var a=this;this.stats={objects:{get total(){return a._objects.length},get inUse(){return this.total-a.nCachedObjects_}},get bindingsPerObject(){return a._bindings.length}}},n.AnimationObjectGroup.prototype={constructor:n.AnimationObjectGroup,add:function(e){for(var t=this._objects,r=t.length,i=this.nCachedObjects_,a=this._indicesByUUID,o=this._paths,s=this._parsedPaths,c=this._bindings,u=c.length,h=0,l=arguments.length;h!==l;++h){var f=arguments[h],d=f.uuid,p=a[d];if(p===void 0){p=r++,a[d]=p,t.push(f);for(var m=0,y=u;m!==y;++m)c[m].push(new n.PropertyBinding(f,o[m],s[m]))}else if(p<i){var g=t[p],x=--i,M=t[x];a[M.uuid]=p,t[p]=M,a[d]=x,t[x]=f;for(var m=0,y=u;m!==y;++m){var w=c[m],E=w[x],S=w[p];w[p]=E,S===void 0&&(S=new n.PropertyBinding(f,o[m],s[m])),w[x]=S}}else t[p]!==g&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=i},remove:function(e){var t=this._objects;t.length;for(var r=this.nCachedObjects_,i=this._indicesByUUID,a=this._bindings,o=a.length,s=0,c=arguments.length;s!==c;++s){var u=arguments[s],h=u.uuid,l=i[h];if(l!==void 0&&l>=r){var f=r++,d=t[f];i[d.uuid]=l,t[l]=d,i[h]=f,t[f]=u;for(var p=0,m=o;p!==m;++p){var y=a[p],g=y[f],x=y[l];y[l]=g,y[f]=x}}}this.nCachedObjects_=r},uncache:function(e){for(var t=this._objects,r=t.length,i=this.nCachedObjects_,a=this._indicesByUUID,o=this._bindings,s=o.length,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],l=h.uuid,f=a[l];if(f!==void 0)if(delete a[l],f<i){var d=--i,p=t[d],m=--r,y=t[m];a[p.uuid]=f,t[f]=p,a[y.uuid]=d,t[d]=y,t.pop();for(var g=0,x=s;g!==x;++g){var M=o[g],w=M[d],E=M[m];M[f]=w,M[d]=E,M.pop()}}else{var m=--r,y=t[m];a[y.uuid]=f,t[f]=y,t.pop();for(var g=0,x=s;g!==x;++g){var M=o[g];M[f]=M[m],M.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,i=r[e],a=this._bindings;if(i!==void 0)return a[i];var o=this._paths,s=this._parsedPaths,c=this._objects,u=c.length,h=this.nCachedObjects_,l=new Array(u);i=a.length,r[e]=i,o.push(e),s.push(t),a.push(l);for(var f=h,d=c.length;f!==d;++f){var p=c[f];l[f]=new n.PropertyBinding(p,e,t)}return l},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(r!==void 0){var i=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length-1,c=o[s],u=e[s];t[u]=r,o[r]=c,o.pop(),a[r]=a[s],a.pop(),i[r]=i[s],i.pop()}}},n.AnimationUtils={arraySlice:function(e,t,r){return n.AnimationUtils.isTypedArray(e)?new e.constructor(e.subarray(t,r)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(o,s){return e[o]-e[s]}for(var r=e.length,i=new Array(r),a=0;a!==r;++a)i[a]=a;return i.sort(t),i},sortedArray:function(e,t,r){for(var i=e.length,a=new e.constructor(i),o=0,s=0;s!==i;++o)for(var c=r[o]*t,u=0;u!==t;++u)a[s++]=e[c+u];return a},flattenJSON:function(e,t,r,i){for(var a=1,o=e[0];o!==void 0&&o[i]===void 0;)o=e[a++];if(o!==void 0){var s=o[i];if(s!==void 0)if(Array.isArray(s))do s=o[i],s!==void 0&&(t.push(o.time),r.push.apply(r,s)),o=e[a++];while(o!==void 0);else if(s.toArray!==void 0)do s=o[i],s!==void 0&&(t.push(o.time),s.toArray(r,r.length)),o=e[a++];while(o!==void 0);else do s=o[i],s!==void 0&&(t.push(o.time),r.push(s)),o=e[a++];while(o!==void 0)}}},n.KeyframeTrack=function(e,t,r,i){if(e===void 0)throw new Error("track name is undefined");if(t===void 0||t.length===0)throw new Error("no keyframes in track named "+e);this.name=e,this.times=n.AnimationUtils.convertArray(t,this.TimeBufferType),this.values=n.AnimationUtils.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation),this.validate(),this.optimize()},n.KeyframeTrack.prototype={constructor:n.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:n.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(e){return new n.DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new n.LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new n.CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case n.InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case n.InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case n.InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);console.warn(r);return}this.createInterpolant=t},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return n.InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return n.InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return n.InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(e!==0)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]+=e;return this},scale:function(e){if(e!==1)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,i=r.length,a=0,o=i-1;a!==i&&r[a]<e;)++a;for(;o!==-1&&r[o]>t;)--o;if(++o,a!==0||o!==i){a>=o&&(o=Math.max(o,1),a=o-1);var s=this.getValueSize();this.times=n.AnimationUtils.arraySlice(r,a,o),this.values=n.AnimationUtils.arraySlice(this.values,a*s,o*s)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("invalid value size in track",this),e=!1);var r=this.times,i=this.values,a=r.length;a===0&&(console.error("track is empty",this),e=!1);for(var o=null,s=0;s!==a;s++){var c=r[s];if(typeof c=="number"&&isNaN(c)){console.error("time is not a valid number",this,s,c),e=!1;break}if(o!==null&&o>c){console.error("out of order keys",this,s,c,o),e=!1;break}o=c}if(i!==void 0&&n.AnimationUtils.isTypedArray(i))for(var s=0,u=i.length;s!==u;++s){var h=i[s];if(isNaN(h)){console.error("value is not a valid number",this,s,h),e=!1;break}}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),i=1,a=1,o=e.length-1;a<=o;++a){var s=!1,c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==c[0]))for(var h=a*r,l=h-r,f=h+r,d=0;d!==r;++d){var p=t[h+d];if(p!==t[l+d]||p!==t[f+d]){s=!0;break}}if(s){if(a!==i){e[i]=e[a];for(var m=a*r,y=i*r,d=0;d!==r;++d)t[y+d]=t[m+d]}++i}}return i!==e.length&&(this.times=n.AnimationUtils.arraySlice(e,0,i),this.values=n.AnimationUtils.arraySlice(t,0,i*r)),this}},Object.assign(n.KeyframeTrack,{parse:function(e){if(e.type===void 0)throw new Error("track type undefined, can not parse");var t=n.KeyframeTrack._getTrackTypeForValueTypeName(e.type);if(e.times===void 0){var r=[],i=[];n.AnimationUtils.flattenJSON(e.keys,r,i,"value"),e.times=r,e.values=i}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)},toJSON:function(e){var t=e.constructor,r;if(t.toJSON!==void 0)r=t.toJSON(e);else{r={name:e.name,times:n.AnimationUtils.convertArray(e.times,Array),values:n.AnimationUtils.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return n.NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return n.VectorKeyframeTrack;case"color":return n.ColorKeyframeTrack;case"quaternion":return n.QuaternionKeyframeTrack;case"bool":case"boolean":return n.BooleanKeyframeTrack;case"string":return n.StringKeyframeTrack}throw new Error("Unsupported typeName: "+e)}}),n.PropertyBinding=function(e,t,r){this.path=t,this.parsedPath=r||n.PropertyBinding.parseTrackName(t),this.node=n.PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e},n.PropertyBinding.prototype={constructor:n.PropertyBinding,getValue:function(t,r){this.bind(),this.getValue(t,r)},setValue:function(t,r){this.bind(),this.setValue(t,r)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,i=t.propertyName,a=t.propertyIndex;if(e||(e=n.PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("  trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){var o=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("  can not bind to material as node does not have a material",this);return}if(!e.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===o){o=s;break}break;default:if(e[r]===void 0){console.error("  can not bind to objectName of node, undefined",this);return}e=e[r]}if(o!==void 0){if(e[o]===void 0){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,e);return}e=e[o]}}var c=e[i];if(!c){var u=t.nodeName;console.error("  trying to update property for track: "+u+"."+i+" but it wasn't found.",e);return}var h=this.Versioning.None;e.needsUpdate!==void 0?(h=this.Versioning.NeedsUpdate,this.targetObject=e):e.matrixWorldNeedsUpdate!==void 0&&(h=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var l=this.BindingType.Direct;if(a!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);return}if(!e.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);return}for(var s=0;s<this.node.geometry.morphTargets.length;s++)if(e.geometry.morphTargets[s].name===a){a=s;break}}l=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=a}else c.fromArray!==void 0&&c.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=c):c.length!==void 0?(l=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][h]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}},Object.assign(n.PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:n.PropertyBinding.prototype.getValue,_setValue_unbound:n.PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,r){t[r]=this.node[this.propertyName]},function(t,r){for(var i=this.resolvedProperty,a=0,o=i.length;a!==o;++a)t[r++]=i[a]},function(t,r){t[r]=this.resolvedProperty[this.propertyIndex]},function(t,r){this.resolvedProperty.toArray(t,r)}],SetterByBindingTypeAndVersioning:[[function(t,r){this.node[this.propertyName]=t[r]},function(t,r){this.node[this.propertyName]=t[r],this.targetObject.needsUpdate=!0},function(t,r){this.node[this.propertyName]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,r){for(var i=this.resolvedProperty,a=0,o=i.length;a!==o;++a)i[a]=t[r++]},function(t,r){for(var i=this.resolvedProperty,a=0,o=i.length;a!==o;++a)i[a]=t[r++];this.targetObject.needsUpdate=!0},function(t,r){for(var i=this.resolvedProperty,a=0,o=i.length;a!==o;++a)i[a]=t[r++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,r){this.resolvedProperty[this.propertyIndex]=t[r]},function(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.needsUpdate=!0},function(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,r){this.resolvedProperty.fromArray(t,r)},function(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.needsUpdate=!0},function(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.matrixWorldNeedsUpdate=!0}]]}),n.PropertyBinding.Composite=function(e,t,r){var i=r||n.PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)},n.PropertyBinding.Composite.prototype={constructor:n.PropertyBinding.Composite,getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,a=r.length;i!==a;++i)r[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}},n.PropertyBinding.create=function(e,t,r){return e instanceof n.AnimationObjectGroup?new n.PropertyBinding.Composite(e,t,r):new n.PropertyBinding(e,t,r)},n.PropertyBinding.parseTrackName=function(e){var t=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_.:\- ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,r=t.exec(e);if(!r)throw new Error("cannot parse trackName at all: "+e);r.index===t.lastIndex&&t.lastIndex++;var i={nodeName:r[3],objectName:r[5],objectIndex:r[7],propertyName:r[9],propertyIndex:r[11]};if(i.propertyName===null||i.propertyName.length===0)throw new Error("can not parse propertyName from trackName: "+e);return i},n.PropertyBinding.findNode=function(e,t){if(!t||t===""||t==="root"||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=function(s){for(var c=0;c<s.bones.length;c++){var u=s.bones[c];if(u.name===t)return u}return null},i=r(e.skeleton);if(i)return i}if(e.children){var a=function(s){for(var c=0;c<s.length;c++){var u=s[c];if(u.name===t||u.uuid===t)return u;var h=a(u.children);if(h)return h}return null},o=a(e.children);if(o)return o}return null},n.PropertyMixer=function(e,t,r){this.binding=e,this.valueSize=r;var i=Float64Array,a;switch(t){case"quaternion":a=this._slerp;break;case"string":case"bool":i=Array,a=this._select;break;default:a=this._lerp}this.buffer=new i(r*4),this._mixBufferRegion=a,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0},n.PropertyMixer.prototype={constructor:n.PropertyMixer,accumulate:function(e,t){var r=this.buffer,i=this.valueSize,a=e*i+i,o=this.cumulativeWeight;if(o===0){for(var s=0;s!==i;++s)r[a+s]=r[s];o=t}else{o+=t;var c=t/o;this._mixBufferRegion(r,a,0,c,i)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,r=this.buffer,i=e*t+t,a=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,a<1){var s=t*3;this._mixBufferRegion(r,i,s,1-a,t)}for(var c=t,u=t+t;c!==u;++c)if(r[c]!==r[c+t]){o.setValue(r,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,i=r*3;e.getValue(t,i);for(var a=r,o=i;a!==o;++a)t[a]=t[i+a%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=this.valueSize*3;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,i,a){if(i>=.5)for(var o=0;o!==a;++o)e[t+o]=e[r+o]},_slerp:function(e,t,r,i,a){n.Quaternion.slerpFlat(e,t,e,t,e,r,i)},_lerp:function(e,t,r,i,a){for(var o=1-i,s=0;s!==a;++s){var c=t+s;e[c]=e[c]*o+e[r+s]*i}}},n.BooleanKeyframeTrack=function(e,t,r){n.KeyframeTrack.call(this,e,t,r)},n.BooleanKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:n.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),n.ColorKeyframeTrack=function(e,t,r,i){n.KeyframeTrack.call(this,e,t,r,i)},n.ColorKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.ColorKeyframeTrack,ValueTypeName:"color"}),n.NumberKeyframeTrack=function(e,t,r,i){n.KeyframeTrack.call(this,e,t,r,i)},n.NumberKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.NumberKeyframeTrack,ValueTypeName:"number"}),n.QuaternionKeyframeTrack=function(e,t,r,i){n.KeyframeTrack.call(this,e,t,r,i)},n.QuaternionKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:n.InterpolateLinear,InterpolantFactoryMethodLinear:function(e){return new n.QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),n.StringKeyframeTrack=function(e,t,r,i){n.KeyframeTrack.call(this,e,t,r,i)},n.StringKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:n.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),n.VectorKeyframeTrack=function(e,t,r,i){n.KeyframeTrack.call(this,e,t,r,i)},n.VectorKeyframeTrack.prototype=Object.assign(Object.create(n.KeyframeTrack.prototype),{constructor:n.VectorKeyframeTrack,ValueTypeName:"vector"}),n.Audio=function(e){n.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]},n.Audio.prototype=Object.assign(Object.create(n.Object3D.prototype),{constructor:n.Audio,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function(e){return this.source.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}var e=this.context.createBufferSource();return e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.start(0,this.startTime),e.playbackRate.value=this.playbackRate,this.isPlaying=!0,this.source=e,this.connect()},pause:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.source.stop(),this.startTime=this.context.currentTime,this},stop:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.source.stop(),this.startTime=0,this},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),this.isPlaying===!0?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&(this.source.playbackRate.value=this.playbackRate),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.source.loop},setLoop:function(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this.source.loop=e},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.value=e,this}}),n.AudioAnalyser=function(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t!==void 0?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)},Object.assign(n.AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.defineProperty(n,"AudioContext",{get:function(){var e;return function(){return e===void 0&&(e=new(window.AudioContext||window.webkitAudioContext)),e}}()}),n.PositionalAudio=function(e){n.Audio.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)},n.PositionalAudio.prototype=Object.assign(Object.create(n.Audio.prototype),{constructor:n.PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var e=new n.Vector3;return function(r){n.Object3D.prototype.updateMatrixWorld.call(this,r),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}),n.AudioListener=function(){n.Object3D.call(this),this.type="AudioListener",this.context=n.AudioContext,this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null},n.AudioListener.prototype=Object.assign(Object.create(n.Object3D.prototype),{constructor:n.AudioListener,getInput:function(){return this.gain},removeFilter:function(){this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(e){this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.value=e},updateMatrixWorld:function(){var e=new n.Vector3,t=new n.Quaternion,r=new n.Vector3,i=new n.Vector3;return function(o){n.Object3D.prototype.updateMatrixWorld.call(this,o);var s=this.context.listener,c=this.up;this.matrixWorld.decompose(e,t,r),i.set(0,0,-1).applyQuaternion(t),s.setPosition(e.x,e.y,e.z),s.setOrientation(i.x,i.y,i.z,c.x,c.y,c.z)}}()}),n.Camera=function(){n.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new n.Matrix4,this.projectionMatrix=new n.Matrix4},n.Camera.prototype=Object.create(n.Object3D.prototype),n.Camera.prototype.constructor=n.Camera,n.Camera.prototype.getWorldDirection=function(){var e=new n.Quaternion;return function(t){var r=t||new n.Vector3;return this.getWorldQuaternion(e),r.set(0,0,-1).applyQuaternion(e)}}(),n.Camera.prototype.lookAt=function(){var e=new n.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),n.Camera.prototype.clone=function(){return new this.constructor().copy(this)},n.Camera.prototype.copy=function(e){return n.Object3D.prototype.copy.call(this,e),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},n.CubeCamera=function(e,t,r){n.Object3D.call(this),this.type="CubeCamera";var i=90,a=1,o=new n.PerspectiveCamera(i,a,e,t);o.up.set(0,-1,0),o.lookAt(new n.Vector3(1,0,0)),this.add(o);var s=new n.PerspectiveCamera(i,a,e,t);s.up.set(0,-1,0),s.lookAt(new n.Vector3(-1,0,0)),this.add(s);var c=new n.PerspectiveCamera(i,a,e,t);c.up.set(0,0,1),c.lookAt(new n.Vector3(0,1,0)),this.add(c);var u=new n.PerspectiveCamera(i,a,e,t);u.up.set(0,0,-1),u.lookAt(new n.Vector3(0,-1,0)),this.add(u);var h=new n.PerspectiveCamera(i,a,e,t);h.up.set(0,-1,0),h.lookAt(new n.Vector3(0,0,1)),this.add(h);var l=new n.PerspectiveCamera(i,a,e,t);l.up.set(0,-1,0),l.lookAt(new n.Vector3(0,0,-1)),this.add(l);var f={format:n.RGBFormat,magFilter:n.LinearFilter,minFilter:n.LinearFilter};this.renderTarget=new n.WebGLRenderTargetCube(r,r,f),this.updateCubeMap=function(d,p){this.parent===null&&this.updateMatrixWorld();var m=this.renderTarget,y=m.texture.generateMipmaps;m.texture.generateMipmaps=!1,m.activeCubeFace=0,d.render(p,o,m),m.activeCubeFace=1,d.render(p,s,m),m.activeCubeFace=2,d.render(p,c,m),m.activeCubeFace=3,d.render(p,u,m),m.activeCubeFace=4,d.render(p,h,m),m.texture.generateMipmaps=y,m.activeCubeFace=5,d.render(p,l,m),d.setRenderTarget(null)}},n.CubeCamera.prototype=Object.create(n.Object3D.prototype),n.CubeCamera.prototype.constructor=n.CubeCamera,n.OrthographicCamera=function(e,t,r,i,a,o){n.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=a!==void 0?a:.1,this.far=o!==void 0?o:2e3,this.updateProjectionMatrix()},n.OrthographicCamera.prototype=Object.assign(Object.create(n.Camera.prototype),{constructor:n.OrthographicCamera,copy:function(e){return n.Camera.prototype.copy.call(this,e),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,i+t,i-t,this.near,this.far)},toJSON:function(e){var t=n.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,t}}),n.PerspectiveCamera=function(e,t,r,i){n.Camera.call(this),this.type="PerspectiveCamera",this.fov=e!==void 0?e:50,this.zoom=1,this.near=r!==void 0?r:.1,this.far=i!==void 0?i:2e3,this.focus=10,this.aspect=t!==void 0?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()},n.PerspectiveCamera.prototype=Object.assign(Object.create(n.Camera.prototype),{constructor:n.PerspectiveCamera,copy:function(e){return n.Camera.prototype.copy.call(this,e),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=n.Math.RAD2DEG*2*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(n.Math.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return n.Math.RAD2DEG*2*Math.atan(Math.tan(n.Math.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,i,a,o){this.aspect=e/t,this.view={fullWidth:e,fullHeight:t,offsetX:r,offsetY:i,width:a,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(n.Math.DEG2RAD*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,a=-.5*i,o=this.view;if(o!==null){var s=o.fullWidth,c=o.fullHeight;a+=o.offsetX*i/s,t-=o.offsetY*r/c,i*=o.width/s,r*=o.height/c}var u=this.filmOffset;u!==0&&(a+=e*u/this.getFilmWidth()),this.projectionMatrix.makeFrustum(a,a+i,t-r,t,e,this.far)},toJSON:function(e){var t=n.Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),n.StereoCamera=function(){this.type="StereoCamera",this.aspect=1,this.cameraL=new n.PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new n.PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1},Object.assign(n.StereoCamera.prototype,{update:function(){var e,t,r,i,a,o=new n.Matrix4,s=new n.Matrix4;return function(u){var h=e!==u.focus||t!==u.fov||r!==u.aspect*this.aspect||i!==u.near||a!==u.far;if(h){e=u.focus,t=u.fov,r=u.aspect*this.aspect,i=u.near,a=u.far;var l=u.projectionMatrix.clone(),f=.064/2,d=f*i/e,p=i*Math.tan(n.Math.DEG2RAD*t*.5),m,y;s.elements[12]=-f,o.elements[12]=f,m=-p*r+d,y=p*r+d,l.elements[0]=2*i/(y-m),l.elements[8]=(y+m)/(y-m),this.cameraL.projectionMatrix.copy(l),m=-p*r-d,y=p*r-d,l.elements[0]=2*i/(y-m),l.elements[8]=(y+m)/(y-m),this.cameraR.projectionMatrix.copy(l)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(s),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(o)}}()}),n.Light=function(e,t){n.Object3D.call(this),this.type="Light",this.color=new n.Color(e),this.intensity=t!==void 0?t:1,this.receiveShadow=void 0},n.Light.prototype=Object.assign(Object.create(n.Object3D.prototype),{constructor:n.Light,copy:function(e){return n.Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=n.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),t}}),n.LightShadow=function(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new n.Vector2(512,512),this.map=null,this.matrix=new n.Matrix4},Object.assign(n.LightShadow.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)}}),n.AmbientLight=function(e,t){n.Light.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0},n.AmbientLight.prototype=Object.assign(Object.create(n.Light.prototype),{constructor:n.AmbientLight}),n.DirectionalLight=function(e,t){n.Light.call(this,e,t),this.type="DirectionalLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new n.Object3D,this.shadow=new n.DirectionalLightShadow},n.DirectionalLight.prototype=Object.assign(Object.create(n.Light.prototype),{constructor:n.DirectionalLight,copy:function(e){return n.Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),n.DirectionalLightShadow=function(e){n.LightShadow.call(this,new n.OrthographicCamera(-5,5,5,-5,.5,500))},n.DirectionalLightShadow.prototype=Object.assign(Object.create(n.LightShadow.prototype),{constructor:n.DirectionalLightShadow}),n.HemisphereLight=function(e,t,r){n.Light.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.set(0,1,0),this.updateMatrix(),this.groundColor=new n.Color(t)},n.HemisphereLight.prototype=Object.assign(Object.create(n.Light.prototype),{constructor:n.HemisphereLight,copy:function(e){return n.Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),n.PointLight=function(e,t,r,i){n.Light.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}}),this.distance=r!==void 0?r:0,this.decay=i!==void 0?i:1,this.shadow=new n.LightShadow(new n.PerspectiveCamera(90,1,.5,500))},n.PointLight.prototype=Object.assign(Object.create(n.Light.prototype),{constructor:n.PointLight,copy:function(e){return n.Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),n.SpotLight=function(e,t,r,i,a,o){n.Light.call(this,e,t),this.type="SpotLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new n.Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(s){this.intensity=s/Math.PI}}),this.distance=r!==void 0?r:0,this.angle=i!==void 0?i:Math.PI/3,this.penumbra=a!==void 0?a:0,this.decay=o!==void 0?o:1,this.shadow=new n.SpotLightShadow},n.SpotLight.prototype=Object.assign(Object.create(n.Light.prototype),{constructor:n.SpotLight,copy:function(e){return n.Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),n.SpotLightShadow=function(){n.LightShadow.call(this,new n.PerspectiveCamera(50,1,.5,500))},n.SpotLightShadow.prototype=Object.assign(Object.create(n.LightShadow.prototype),{constructor:n.SpotLightShadow,update:function(e){var t=n.Math.RAD2DEG*2*e.angle,r=this.mapSize.width/this.mapSize.height,i=e.distance||500,a=this.camera;(t!==a.fov||r!==a.aspect||i!==a.far)&&(a.fov=t,a.aspect=r,a.far=i,a.updateProjectionMatrix())}}),n.AudioLoader=function(e){this.manager=e!==void 0?e:n.DefaultLoadingManager},n.AudioLoader.prototype={constructor:n.AudioLoader,load:function(e,t,r,i){var a=new n.XHRLoader(this.manager);a.setResponseType("arraybuffer"),a.load(e,function(o){var s=n.AudioContext;s.decodeAudioData(o,function(c){t(c)})},r,i)}},n.Cache={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},n.Loader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},n.Loader.prototype={constructor:n.Loader,crossOrigin:void 0,extractUrlBase:function(e){var t=e.split("/");return t.length===1?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t,r){for(var i=[],a=0;a<e.length;++a)i[a]=this.createMaterial(e[a],t,r);return i},createMaterial:function(){var e,t,r;return function(i,a,o){e===void 0&&(e=new n.Color),t===void 0&&(t=new n.TextureLoader),r===void 0&&(r=new n.MaterialLoader);var s={};function c(f,d,p,m,y){var g=a+f,x=n.Loader.Handlers.get(g),M;x!==null?M=x.load(g):(t.setCrossOrigin(o),M=t.load(g)),d!==void 0&&(M.repeat.fromArray(d),d[0]!==1&&(M.wrapS=n.RepeatWrapping),d[1]!==1&&(M.wrapT=n.RepeatWrapping)),p!==void 0&&M.offset.fromArray(p),m!==void 0&&(m[0]==="repeat"&&(M.wrapS=n.RepeatWrapping),m[0]==="mirror"&&(M.wrapS=n.MirroredRepeatWrapping),m[1]==="repeat"&&(M.wrapT=n.RepeatWrapping),m[1]==="mirror"&&(M.wrapT=n.MirroredRepeatWrapping)),y!==void 0&&(M.anisotropy=y);var w=n.Math.generateUUID();return s[w]=M,w}var u={uuid:n.Math.generateUUID(),type:"MeshLambertMaterial"};for(var h in i){var l=i[h];switch(h){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":u.name=l;break;case"blending":u.blending=n[l];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",h,"is no longer supported.");break;case"colorDiffuse":u.color=e.fromArray(l).getHex();break;case"colorSpecular":u.specular=e.fromArray(l).getHex();break;case"colorEmissive":u.emissive=e.fromArray(l).getHex();break;case"specularCoef":u.shininess=l;break;case"shading":l.toLowerCase()==="basic"&&(u.type="MeshBasicMaterial"),l.toLowerCase()==="phong"&&(u.type="MeshPhongMaterial");break;case"mapDiffuse":u.map=c(l,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapLight":u.lightMap=c(l,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":u.aoMap=c(l,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":u.bumpMap=c(l,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":u.bumpScale=l;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":u.normalMap=c(l,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":u.normalScale=[l,l];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":u.specularMap=c(l,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapAlpha":u.alphaMap=c(l,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":u.side=n.BackSide;break;case"doubleSided":u.side=n.DoubleSide;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),u.opacity=l;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":u[h]=l;break;case"vertexColors":l===!0&&(u.vertexColors=n.VertexColors),l==="face"&&(u.vertexColors=n.FaceColors);break;default:console.error("THREE.Loader.createMaterial: Unsupported",h,l);break}}return u.type==="MeshBasicMaterial"&&delete u.emissive,u.type!=="MeshPhongMaterial"&&delete u.specular,u.opacity<1&&(u.transparent=!0),r.setTextures(s),r.parse(u)}}()},n.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,i=t.length;r<i;r+=2){var a=t[r],o=t[r+1];if(a.test(e))return o}return null}},n.XHRLoader=function(e){this.manager=e!==void 0?e:n.DefaultLoadingManager},n.XHRLoader.prototype={constructor:n.XHRLoader,load:function(e,t,r,i){this.path!==void 0&&(e=this.path+e);var a=this,o=n.Cache.get(e);if(o!==void 0)return t&&setTimeout(function(){t(o)},0),o;var s=new XMLHttpRequest;return s.overrideMimeType("text/plain"),s.open("GET",e,!0),s.addEventListener("load",function(c){var u=c.target.response;n.Cache.add(e,u),this.status===200?(t&&t(u),a.manager.itemEnd(e)):this.status===0?(console.warn("THREE.XHRLoader: HTTP Status 0 received."),t&&t(u),a.manager.itemEnd(e)):(i&&i(c),a.manager.itemError(e))},!1),r!==void 0&&s.addEventListener("progress",function(c){r(c)},!1),s.addEventListener("error",function(c){i&&i(c),a.manager.itemError(e)},!1),this.responseType!==void 0&&(s.responseType=this.responseType),this.withCredentials!==void 0&&(s.withCredentials=this.withCredentials),s.send(null),a.manager.itemStart(e),s},setPath:function(e){this.path=e},setResponseType:function(e){this.responseType=e},setWithCredentials:function(e){this.withCredentials=e}},n.FontLoader=function(e){this.manager=e!==void 0?e:n.DefaultLoadingManager},n.FontLoader.prototype={constructor:n.FontLoader,load:function(e,t,r,i){var a=this,o=new n.XHRLoader(this.manager);o.load(e,function(s){var c;try{c=JSON.parse(s)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),c=JSON.parse(s.substring(65,s.length-2))}var u=a.parse(c);t&&t(u)},r,i)},parse:function(e){return new n.Font(e)}},n.ImageLoader=function(e){this.manager=e!==void 0?e:n.DefaultLoadingManager},n.ImageLoader.prototype={constructor:n.ImageLoader,load:function(e,t,r,i){this.path!==void 0&&(e=this.path+e);var a=this,o=n.Cache.get(e);if(o!==void 0)return a.manager.itemStart(e),t?setTimeout(function(){t(o),a.manager.itemEnd(e)},0):a.manager.itemEnd(e),o;var s=document.createElement("img");return s.addEventListener("load",function(c){n.Cache.add(e,this),t&&t(this),a.manager.itemEnd(e)},!1),r!==void 0&&s.addEventListener("progress",function(c){r(c)},!1),s.addEventListener("error",function(c){i&&i(c),a.manager.itemError(e)},!1),this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),a.manager.itemStart(e),s.src=e,s},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e}},n.JSONLoader=function(e){typeof e=="boolean"&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=e!==void 0?e:n.DefaultLoadingManager,this.withCredentials=!1},n.JSONLoader.prototype={constructor:n.JSONLoader,get statusDomElement(){return this._statusDomElement===void 0&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.JSONLoader: .statusDomElement has been removed."),this._statusDomElement},load:function(e,t,r,i){var a=this,o=this.texturePath&&typeof this.texturePath=="string"?this.texturePath:n.Loader.prototype.extractUrlBase(e),s=new n.XHRLoader(this.manager);s.setWithCredentials(this.withCredentials),s.load(e,function(c){var u=JSON.parse(c),h=u.metadata;if(h!==void 0){var l=h.type;if(l!==void 0){if(l.toLowerCase()==="object"){console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");return}if(l.toLowerCase()==="scene"){console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.");return}}}var f=a.parse(u,o);t(f.geometry,f.materials)},r,i)},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){var r=new n.Geometry,i=e.scale!==void 0?1/e.scale:1;a(i),o(),s(i),c(),r.computeFaceNormals(),r.computeBoundingSphere();function a(h){function l(K,ie){return K&1<<ie}var f,d,p,m,y,g,x,M,w,E,S,U,C,P,B,F,N,W,I,k,T,O,G,j,Z,Q,R,A=e.faces,D=e.vertices,H=e.normals,Y=e.colors,X=0;if(e.uvs!==void 0){for(f=0;f<e.uvs.length;f++)e.uvs[f].length&&X++;for(f=0;f<X;f++)r.faceVertexUvs[f]=[]}for(m=0,y=D.length;m<y;)W=new n.Vector3,W.x=D[m++]*h,W.y=D[m++]*h,W.z=D[m++]*h,r.vertices.push(W);for(m=0,y=A.length;m<y;)if(E=A[m++],S=l(E,0),U=l(E,1),C=l(E,3),P=l(E,4),B=l(E,5),F=l(E,6),N=l(E,7),S){if(k=new n.Face3,k.a=A[m],k.b=A[m+1],k.c=A[m+3],T=new n.Face3,T.a=A[m+1],T.b=A[m+2],T.c=A[m+3],m+=4,U&&(w=A[m++],k.materialIndex=w,T.materialIndex=w),p=r.faces.length,C)for(f=0;f<X;f++)for(j=e.uvs[f],r.faceVertexUvs[f][p]=[],r.faceVertexUvs[f][p+1]=[],d=0;d<4;d++)M=A[m++],Q=j[M*2],R=j[M*2+1],Z=new n.Vector2(Q,R),d!==2&&r.faceVertexUvs[f][p].push(Z),d!==0&&r.faceVertexUvs[f][p+1].push(Z);if(P&&(x=A[m++]*3,k.normal.set(H[x++],H[x++],H[x]),T.normal.copy(k.normal)),B)for(f=0;f<4;f++)x=A[m++]*3,G=new n.Vector3(H[x++],H[x++],H[x]),f!==2&&k.vertexNormals.push(G),f!==0&&T.vertexNormals.push(G);if(F&&(g=A[m++],O=Y[g],k.color.setHex(O),T.color.setHex(O)),N)for(f=0;f<4;f++)g=A[m++],O=Y[g],f!==2&&k.vertexColors.push(new n.Color(O)),f!==0&&T.vertexColors.push(new n.Color(O));r.faces.push(k),r.faces.push(T)}else{if(I=new n.Face3,I.a=A[m++],I.b=A[m++],I.c=A[m++],U&&(w=A[m++],I.materialIndex=w),p=r.faces.length,C)for(f=0;f<X;f++)for(j=e.uvs[f],r.faceVertexUvs[f][p]=[],d=0;d<3;d++)M=A[m++],Q=j[M*2],R=j[M*2+1],Z=new n.Vector2(Q,R),r.faceVertexUvs[f][p].push(Z);if(P&&(x=A[m++]*3,I.normal.set(H[x++],H[x++],H[x])),B)for(f=0;f<3;f++)x=A[m++]*3,G=new n.Vector3(H[x++],H[x++],H[x]),I.vertexNormals.push(G);if(F&&(g=A[m++],I.color.setHex(Y[g])),N)for(f=0;f<3;f++)g=A[m++],I.vertexColors.push(new n.Color(Y[g]));r.faces.push(I)}}function o(){var h=e.influencesPerVertex!==void 0?e.influencesPerVertex:2;if(e.skinWeights)for(var l=0,f=e.skinWeights.length;l<f;l+=h){var d=e.skinWeights[l],p=h>1?e.skinWeights[l+1]:0,m=h>2?e.skinWeights[l+2]:0,y=h>3?e.skinWeights[l+3]:0;r.skinWeights.push(new n.Vector4(d,p,m,y))}if(e.skinIndices)for(var l=0,f=e.skinIndices.length;l<f;l+=h){var g=e.skinIndices[l],x=h>1?e.skinIndices[l+1]:0,M=h>2?e.skinIndices[l+2]:0,w=h>3?e.skinIndices[l+3]:0;r.skinIndices.push(new n.Vector4(g,x,M,w))}r.bones=e.bones,r.bones&&r.bones.length>0&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)&&console.warn("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match.")}function s(h){if(e.morphTargets!==void 0)for(var l=0,f=e.morphTargets.length;l<f;l++){r.morphTargets[l]={},r.morphTargets[l].name=e.morphTargets[l].name,r.morphTargets[l].vertices=[];for(var d=r.morphTargets[l].vertices,p=e.morphTargets[l].vertices,m=0,y=p.length;m<y;m+=3){var g=new n.Vector3;g.x=p[m]*h,g.y=p[m+1]*h,g.z=p[m+2]*h,d.push(g)}}if(e.morphColors!==void 0&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var x=r.faces,M=e.morphColors[0].colors,l=0,f=x.length;l<f;l++)x[l].color.fromArray(M,l*3)}}function c(){var h=[],l=[];e.animation!==void 0&&l.push(e.animation),e.animations!==void 0&&(e.animations.length?l=l.concat(e.animations):l.push(e.animations));for(var f=0;f<l.length;f++){var d=n.AnimationClip.parseAnimation(l[f],r.bones);d&&h.push(d)}if(r.morphTargets){var p=n.AnimationClip.CreateClipsFromMorphTargetSequences(r.morphTargets,10);h=h.concat(p)}h.length>0&&(r.animations=h)}if(e.materials===void 0||e.materials.length===0)return{geometry:r};var u=n.Loader.prototype.initMaterials(e.materials,t,this.crossOrigin);return{geometry:r,materials:u}}},n.LoadingManager=function(e,t,r){var i=this,a=!1,o=0,s=0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(c){s++,a===!1&&i.onStart!==void 0&&i.onStart(c,o,s),a=!0},this.itemEnd=function(c){o++,i.onProgress!==void 0&&i.onProgress(c,o,s),o===s&&(a=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(c){i.onError!==void 0&&i.onError(c)}},n.DefaultLoadingManager=new n.LoadingManager,n.BufferGeometryLoader=function(e){this.manager=e!==void 0?e:n.DefaultLoadingManager},n.BufferGeometryLoader.prototype={constructor:n.BufferGeometryLoader,load:function(e,t,r,i){var a=this,o=new n.XHRLoader(a.manager);o.load(e,function(s){t(a.parse(JSON.parse(s)))},r,i)},parse:function(e){var t=new n.BufferGeometry,r=e.data.index,i={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};if(r!==void 0){var a=new i[r.type](r.array);t.setIndex(new n.BufferAttribute(a,1))}var o=e.data.attributes;for(var s in o){var c=o[s],a=new i[c.type](c.array);t.addAttribute(s,new n.BufferAttribute(a,c.itemSize,c.normalized))}var u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(var h=0,l=u.length;h!==l;++h){var f=u[h];t.addGroup(f.start,f.count,f.materialIndex)}var d=e.data.boundingSphere;if(d!==void 0){var p=new n.Vector3;d.center!==void 0&&p.fromArray(d.center),t.boundingSphere=new n.Sphere(p,d.radius)}return t}},n.MaterialLoader=function(e){this.manager=e!==void 0?e:n.DefaultLoadingManager,this.textures={}},n.MaterialLoader.prototype={constructor:n.MaterialLoader,load:function(e,t,r,i){var a=this,o=new n.XHRLoader(a.manager);o.load(e,function(s){t(a.parse(JSON.parse(s)))},r,i)},setTextures:function(e){this.textures=e},getTexture:function(e){var t=this.textures;return t[e]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]},parse:function(e){var t=new n[e.type];if(e.uuid!==void 0&&(t.uuid=e.uuid),e.name!==void 0&&(t.name=e.name),e.color!==void 0&&t.color.setHex(e.color),e.roughness!==void 0&&(t.roughness=e.roughness),e.metalness!==void 0&&(t.metalness=e.metalness),e.emissive!==void 0&&t.emissive.setHex(e.emissive),e.specular!==void 0&&t.specular.setHex(e.specular),e.shininess!==void 0&&(t.shininess=e.shininess),e.uniforms!==void 0&&(t.uniforms=e.uniforms),e.vertexShader!==void 0&&(t.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(t.fragmentShader=e.fragmentShader),e.vertexColors!==void 0&&(t.vertexColors=e.vertexColors),e.shading!==void 0&&(t.shading=e.shading),e.blending!==void 0&&(t.blending=e.blending),e.side!==void 0&&(t.side=e.side),e.opacity!==void 0&&(t.opacity=e.opacity),e.transparent!==void 0&&(t.transparent=e.transparent),e.alphaTest!==void 0&&(t.alphaTest=e.alphaTest),e.depthTest!==void 0&&(t.depthTest=e.depthTest),e.depthWrite!==void 0&&(t.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(t.colorWrite=e.colorWrite),e.wireframe!==void 0&&(t.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(t.wireframeLinewidth=e.wireframeLinewidth),e.size!==void 0&&(t.size=e.size),e.sizeAttenuation!==void 0&&(t.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(t.map=this.getTexture(e.map)),e.alphaMap!==void 0&&(t.alphaMap=this.getTexture(e.alphaMap),t.transparent=!0),e.bumpMap!==void 0&&(t.bumpMap=this.getTexture(e.bumpMap)),e.bumpScale!==void 0&&(t.bumpScale=e.bumpScale),e.normalMap!==void 0&&(t.normalMap=this.getTexture(e.normalMap)),e.normalScale!==void 0){var r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),t.normalScale=new n.Vector2().fromArray(r)}if(e.displacementMap!==void 0&&(t.displacementMap=this.getTexture(e.displacementMap)),e.displacementScale!==void 0&&(t.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(t.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(t.roughnessMap=this.getTexture(e.roughnessMap)),e.metalnessMap!==void 0&&(t.metalnessMap=this.getTexture(e.metalnessMap)),e.emissiveMap!==void 0&&(t.emissiveMap=this.getTexture(e.emissiveMap)),e.emissiveIntensity!==void 0&&(t.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(t.specularMap=this.getTexture(e.specularMap)),e.envMap!==void 0&&(t.envMap=this.getTexture(e.envMap),t.combine=n.MultiplyOperation),e.reflectivity&&(t.reflectivity=e.reflectivity),e.lightMap!==void 0&&(t.lightMap=this.getTexture(e.lightMap)),e.lightMapIntensity!==void 0&&(t.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(t.aoMap=this.getTexture(e.aoMap)),e.aoMapIntensity!==void 0&&(t.aoMapIntensity=e.aoMapIntensity),e.materials!==void 0)for(var i=0,a=e.materials.length;i<a;i++)t.materials.push(this.parse(e.materials[i]));return t}},n.ObjectLoader=function(e){this.manager=e!==void 0?e:n.DefaultLoadingManager,this.texturePath=""},n.ObjectLoader.prototype={constructor:n.ObjectLoader,load:function(e,t,r,i){this.texturePath===""&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var a=this,o=new n.XHRLoader(a.manager);o.load(e,function(s){a.parse(JSON.parse(s),t)},r,i)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseGeometries(e.geometries),i=this.parseImages(e.images,function(){t!==void 0&&t(s)}),a=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,r,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),(e.images===void 0||e.images.length===0)&&t!==void 0&&t(s),s},parseGeometries:function(e){var t={};if(e!==void 0)for(var r=new n.JSONLoader,i=new n.BufferGeometryLoader,a=0,o=e.length;a<o;a++){var s,c=e[a];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new n[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new n[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new n[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new n[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new n[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new n[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":s=new n[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new n[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new n[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new n[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new n[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"BufferGeometry":s=i.parse(c);break;case"Geometry":s=r.parse(c.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+c.type+'"');continue}s.uuid=c.uuid,c.name!==void 0&&(s.name=c.name),t[c.uuid]=s}return t},parseMaterials:function(e,t){var r={};if(e!==void 0){var i=new n.MaterialLoader;i.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=i.parse(e[a]);r[s.uuid]=s}}return r},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var i=n.AnimationClip.parse(e[r]);t.push(i)}return t},parseImages:function(e,t){var r=this,i={};function a(f){return r.manager.itemStart(f),s.load(f,function(){r.manager.itemEnd(f)})}if(e!==void 0&&e.length>0){var o=new n.LoadingManager(t),s=new n.ImageLoader(o);s.setCrossOrigin(this.crossOrigin);for(var c=0,u=e.length;c<u;c++){var h=e[c],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h.url)?h.url:r.texturePath+h.url;i[h.uuid]=a(l)}}return i},parseTextures:function(e,t){function r(u){return typeof u=="number"?u:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",u),n[u])}var i={};if(e!==void 0)for(var a=0,o=e.length;a<o;a++){var s=e[a];s.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),t[s.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var c=new n.Texture(t[s.image]);c.needsUpdate=!0,c.uuid=s.uuid,s.name!==void 0&&(c.name=s.name),s.mapping!==void 0&&(c.mapping=r(s.mapping)),s.offset!==void 0&&(c.offset=new n.Vector2(s.offset[0],s.offset[1])),s.repeat!==void 0&&(c.repeat=new n.Vector2(s.repeat[0],s.repeat[1])),s.minFilter!==void 0&&(c.minFilter=r(s.minFilter)),s.magFilter!==void 0&&(c.magFilter=r(s.magFilter)),s.anisotropy!==void 0&&(c.anisotropy=s.anisotropy),Array.isArray(s.wrap)&&(c.wrapS=r(s.wrap[0]),c.wrapT=r(s.wrap[1])),i[s.uuid]=c}return i},parseObject:function(){var e=new n.Matrix4;return function(t,r,i){var a;function o(p){return r[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",p),r[p]}function s(p){if(p!==void 0)return i[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",p),i[p]}switch(t.type){case"Scene":a=new n.Scene;break;case"PerspectiveCamera":a=new n.PerspectiveCamera(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(a.focus=t.focus),t.zoom!==void 0&&(a.zoom=t.zoom),t.filmGauge!==void 0&&(a.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(a.filmOffset=t.filmOffset),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new n.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":a=new n.AmbientLight(t.color,t.intensity);break;case"DirectionalLight":a=new n.DirectionalLight(t.color,t.intensity);break;case"PointLight":a=new n.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":a=new n.SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":a=new n.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var c=o(t.geometry),u=s(t.material);c.bones&&c.bones.length>0?a=new n.SkinnedMesh(c,u):a=new n.Mesh(c,u);break;case"LOD":a=new n.LOD;break;case"Line":a=new n.Line(o(t.geometry),s(t.material),t.mode);break;case"PointCloud":case"Points":a=new n.Points(o(t.geometry),s(t.material));break;case"Sprite":a=new n.Sprite(s(t.material));break;case"Group":a=new n.Group;break;default:a=new n.Object3D}if(a.uuid=t.uuid,t.name!==void 0&&(a.name=t.name),t.matrix!==void 0?(e.fromArray(t.matrix),e.decompose(a.position,a.quaternion,a.scale)):(t.position!==void 0&&a.position.fromArray(t.position),t.rotation!==void 0&&a.rotation.fromArray(t.rotation),t.scale!==void 0&&a.scale.fromArray(t.scale)),t.castShadow!==void 0&&(a.castShadow=t.castShadow),t.receiveShadow!==void 0&&(a.receiveShadow=t.receiveShadow),t.visible!==void 0&&(a.visible=t.visible),t.userData!==void 0&&(a.userData=t.userData),t.children!==void 0)for(var h in t.children)a.add(this.parseObject(t.children[h],r,i));if(t.type==="LOD")for(var l=t.levels,f=0;f<l.length;f++){var d=l[f],h=a.getObjectByProperty("uuid",d.object);h!==void 0&&a.addLevel(h,d.distance)}return a}}()},n.TextureLoader=function(e){this.manager=e!==void 0?e:n.DefaultLoadingManager},n.TextureLoader.prototype={constructor:n.TextureLoader,load:function(e,t,r,i){var a=new n.Texture,o=new n.ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(s){a.image=s,a.needsUpdate=!0,t!==void 0&&t(a)},r,i),a},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e}},n.CubeTextureLoader=function(e){this.manager=e!==void 0?e:n.DefaultLoadingManager},n.CubeTextureLoader.prototype={constructor:n.CubeTextureLoader,load:function(e,t,r,i){var a=new n.CubeTexture,o=new n.ImageLoader(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var s=0;function c(h){o.load(e[h],function(l){a.images[h]=l,s++,s===6&&(a.needsUpdate=!0,t&&t(a))},void 0,i)}for(var u=0;u<e.length;++u)c(u);return a},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e}},n.DataTextureLoader=n.BinaryTextureLoader=function(e){this.manager=e!==void 0?e:n.DefaultLoadingManager,this._parser=null},n.BinaryTextureLoader.prototype={constructor:n.BinaryTextureLoader,load:function(e,t,r,i){var a=this,o=new n.DataTexture,s=new n.XHRLoader(this.manager);return s.setResponseType("arraybuffer"),s.load(e,function(c){var u=a._parser(c);u&&(u.image!==void 0?o.image=u.image:u.data!==void 0&&(o.image.width=u.width,o.image.height=u.height,o.image.data=u.data),o.wrapS=u.wrapS!==void 0?u.wrapS:n.ClampToEdgeWrapping,o.wrapT=u.wrapT!==void 0?u.wrapT:n.ClampToEdgeWrapping,o.magFilter=u.magFilter!==void 0?u.magFilter:n.LinearFilter,o.minFilter=u.minFilter!==void 0?u.minFilter:n.LinearMipMapLinearFilter,o.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.format!==void 0&&(o.format=u.format),u.type!==void 0&&(o.type=u.type),u.mipmaps!==void 0&&(o.mipmaps=u.mipmaps),u.mipmapCount===1&&(o.minFilter=n.LinearFilter),o.needsUpdate=!0,t&&t(o,u))},r,i),o}},n.CompressedTextureLoader=function(e){this.manager=e!==void 0?e:n.DefaultLoadingManager,this._parser=null},n.CompressedTextureLoader.prototype={constructor:n.CompressedTextureLoader,load:function(e,t,r,i){var a=this,o=[],s=new n.CompressedTexture;s.image=o;var c=new n.XHRLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer");function u(d){c.load(e[d],function(p){var m=a._parser(p,!0);o[d]={width:m.width,height:m.height,format:m.format,mipmaps:m.mipmaps},h+=1,h===6&&(m.mipmapCount===1&&(s.minFilter=n.LinearFilter),s.format=m.format,s.needsUpdate=!0,t&&t(s))},r,i)}if(Array.isArray(e))for(var h=0,l=0,f=e.length;l<f;++l)u(l);else c.load(e,function(d){var p=a._parser(d,!0);if(p.isCubemap)for(var m=p.mipmaps.length/p.mipmapCount,y=0;y<m;y++){o[y]={mipmaps:[]};for(var g=0;g<p.mipmapCount;g++)o[y].mipmaps.push(p.mipmaps[y*p.mipmapCount+g]),o[y].format=p.format,o[y].width=p.width,o[y].height=p.height}else s.image.width=p.width,s.image.height=p.height,s.mipmaps=p.mipmaps;p.mipmapCount===1&&(s.minFilter=n.LinearFilter),s.format=p.format,s.needsUpdate=!0,t&&t(s)},r,i);return s},setPath:function(e){this.path=e}},n.Material=function(){Object.defineProperty(this,"id",{value:n.MaterialIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=n.NormalBlending,this.side=n.FrontSide,this.shading=n.SmoothShading,this.vertexColors=n.NoColors,this.opacity=1,this.transparent=!1,this.blendSrc=n.SrcAlphaFactor,this.blendDst=n.OneMinusSrcAlphaFactor,this.blendEquation=n.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=n.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},n.Material.prototype={constructor:n.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},setValues:function(e){if(e!==void 0)for(var t in e){var r=e[t];if(r===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}var i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i instanceof n.Color?i.set(r):i instanceof n.Vector3&&r instanceof n.Vector3?i.copy(r):t==="overdraw"?this[t]=Number(r):this[t]=r}},toJSON:function(e){var t=e===void 0;t&&(e={textures:{},images:{}});var r={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color instanceof n.Color&&(r.color=this.color.getHex()),this.roughness!==.5&&(r.roughness=this.roughness),this.metalness!==.5&&(r.metalness=this.metalness),this.emissive instanceof n.Color&&(r.emissive=this.emissive.getHex()),this.specular instanceof n.Color&&(r.specular=this.specular.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.map instanceof n.Texture&&(r.map=this.map.toJSON(e).uuid),this.alphaMap instanceof n.Texture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap instanceof n.Texture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap instanceof n.Texture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap instanceof n.Texture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap instanceof n.Texture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap instanceof n.Texture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap instanceof n.Texture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap instanceof n.Texture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap instanceof n.Texture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap instanceof n.Texture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity),this.size!==void 0&&(r.size=this.size),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==n.NormalBlending&&(r.blending=this.blending),this.shading!==n.SmoothShading&&(r.shading=this.shading),this.side!==n.FrontSide&&(r.side=this.side),this.vertexColors!==n.NoColors&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth);function i(s){var c=[];for(var u in s){var h=s[u];delete h.metadata,c.push(h)}return c}if(t){var a=i(e.textures),o=i(e.images);a.length>0&&(r.textures=a),o.length>0&&(r.images=o)}return r},clone:function(){return new this.constructor().copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.clipShadows=e.clipShadows;var t=e.clippingPlanes,r=null;if(t!==null){var i=t.length;r=new Array(i);for(var a=0;a!==i;++a)r[a]=t[a].clone()}return this.clippingPlanes=r,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Object.assign(n.Material.prototype,n.EventDispatcher.prototype),n.MaterialIdCount=0,n.LineBasicMaterial=function(e){n.Material.call(this),this.type="LineBasicMaterial",this.color=new n.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)},n.LineBasicMaterial.prototype=Object.create(n.Material.prototype),n.LineBasicMaterial.prototype.constructor=n.LineBasicMaterial,n.LineBasicMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},n.LineDashedMaterial=function(e){n.Material.call(this),this.type="LineDashedMaterial",this.color=new n.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.lights=!1,this.setValues(e)},n.LineDashedMaterial.prototype=Object.create(n.Material.prototype),n.LineDashedMaterial.prototype.constructor=n.LineDashedMaterial,n.LineDashedMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this},n.MeshBasicMaterial=function(e){n.Material.call(this),this.type="MeshBasicMaterial",this.color=new n.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)},n.MeshBasicMaterial.prototype=Object.create(n.Material.prototype),n.MeshBasicMaterial.prototype.constructor=n.MeshBasicMaterial,n.MeshBasicMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},n.MeshDepthMaterial=function(e){n.Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=n.BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)},n.MeshDepthMaterial.prototype=Object.create(n.Material.prototype),n.MeshDepthMaterial.prototype.constructor=n.MeshDepthMaterial,n.MeshDepthMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},n.MeshLambertMaterial=function(e){n.Material.call(this),this.type="MeshLambertMaterial",this.color=new n.Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new n.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},n.MeshLambertMaterial.prototype=Object.create(n.Material.prototype),n.MeshLambertMaterial.prototype.constructor=n.MeshLambertMaterial,n.MeshLambertMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},n.MeshNormalMaterial=function(e){n.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.morphTargets=!1,this.setValues(e)},n.MeshNormalMaterial.prototype=Object.create(n.Material.prototype),n.MeshNormalMaterial.prototype.constructor=n.MeshNormalMaterial,n.MeshNormalMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},n.MeshPhongMaterial=function(e){n.Material.call(this),this.type="MeshPhongMaterial",this.color=new n.Color(16777215),this.specular=new n.Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new n.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new n.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},n.MeshPhongMaterial.prototype=Object.create(n.Material.prototype),n.MeshPhongMaterial.prototype.constructor=n.MeshPhongMaterial,n.MeshPhongMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},n.MeshStandardMaterial=function(e){n.Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new n.Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new n.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new n.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},n.MeshStandardMaterial.prototype=Object.create(n.Material.prototype),n.MeshStandardMaterial.prototype.constructor=n.MeshStandardMaterial,n.MeshStandardMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},n.MeshPhysicalMaterial=function(e){n.MeshStandardMaterial.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.setValues(e)},n.MeshPhysicalMaterial.prototype=Object.create(n.MeshStandardMaterial.prototype),n.MeshPhysicalMaterial.prototype.constructor=n.MeshPhysicalMaterial,n.MeshPhysicalMaterial.prototype.copy=function(e){return n.MeshStandardMaterial.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this},n.MultiMaterial=function(e){this.uuid=n.Math.generateUUID(),this.type="MultiMaterial",this.materials=e instanceof Array?e:[],this.visible=!0},n.MultiMaterial.prototype={constructor:n.MultiMaterial,toJSON:function(e){for(var t={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},r=this.materials,i=0,a=r.length;i<a;i++){var o=r[i].toJSON(e);delete o.metadata,t.materials.push(o)}return t.visible=this.visible,t},clone:function(){for(var e=new this.constructor,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e.visible=this.visible,e}},n.PointsMaterial=function(e){n.Material.call(this),this.type="PointsMaterial",this.color=new n.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)},n.PointsMaterial.prototype=Object.create(n.Material.prototype),n.PointsMaterial.prototype.constructor=n.PointsMaterial,n.PointsMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},n.ShaderMaterial=function(e){n.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))},n.ShaderMaterial.prototype=Object.create(n.Material.prototype),n.ShaderMaterial.prototype.constructor=n.ShaderMaterial,n.ShaderMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=n.UniformsUtils.clone(e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},n.ShaderMaterial.prototype.toJSON=function(e){var t=n.Material.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},n.RawShaderMaterial=function(e){n.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},n.RawShaderMaterial.prototype=Object.create(n.ShaderMaterial.prototype),n.RawShaderMaterial.prototype.constructor=n.RawShaderMaterial,n.SpriteMaterial=function(e){n.Material.call(this),this.type="SpriteMaterial",this.color=new n.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)},n.SpriteMaterial.prototype=Object.create(n.Material.prototype),n.SpriteMaterial.prototype.constructor=n.SpriteMaterial,n.SpriteMaterial.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},n.ShadowMaterial=function(){n.ShaderMaterial.call(this,{uniforms:n.UniformsUtils.merge([n.UniformsLib.lights,{opacity:{value:1}}]),vertexShader:n.ShaderChunk.shadow_vert,fragmentShader:n.ShaderChunk.shadow_frag}),this.lights=!0,this.transparent=!0,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}}})},n.ShadowMaterial.prototype=Object.create(n.ShaderMaterial.prototype),n.ShadowMaterial.prototype.constructor=n.ShadowMaterial,n.Texture=function(e,t,r,i,a,o,s,c,u,h){Object.defineProperty(this,"id",{value:n.TextureIdCount++}),this.uuid=n.Math.generateUUID(),this.name="",this.sourceFile="",this.image=e!==void 0?e:n.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=t!==void 0?t:n.Texture.DEFAULT_MAPPING,this.wrapS=r!==void 0?r:n.ClampToEdgeWrapping,this.wrapT=i!==void 0?i:n.ClampToEdgeWrapping,this.magFilter=a!==void 0?a:n.LinearFilter,this.minFilter=o!==void 0?o:n.LinearMipMapLinearFilter,this.anisotropy=u!==void 0?u:1,this.format=s!==void 0?s:n.RGBAFormat,this.type=c!==void 0?c:n.UnsignedByteType,this.offset=new n.Vector2(0,0),this.repeat=new n.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h!==void 0?h:n.LinearEncoding,this.version=0,this.onUpdate=null},n.Texture.DEFAULT_IMAGE=void 0,n.Texture.DEFAULT_MAPPING=n.UVMapping,n.Texture.prototype={constructor:n.Texture,set needsUpdate(e){e===!0&&this.version++},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){if(e.textures[this.uuid]!==void 0)return e.textures[this.uuid];function t(a){var o;return a.toDataURL!==void 0?o=a:(o=document.createElement("canvas"),o.width=a.width,o.height=a.height,o.getContext("2d").drawImage(a,0,0,a.width,a.height)),o.width>2048||o.height>2048?o.toDataURL("image/jpeg",.6):o.toDataURL("image/png")}var r={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(this.image!==void 0){var i=this.image;i.uuid===void 0&&(i.uuid=n.Math.generateUUID()),e.images[i.uuid]===void 0&&(e.images[i.uuid]={uuid:i.uuid,url:t(i)}),r.image=i.uuid}return e.textures[this.uuid]=r,r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===n.UVMapping){if(e.multiply(this.repeat),e.add(this.offset),e.x<0||e.x>1)switch(this.wrapS){case n.RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case n.ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case n.MirroredRepeatWrapping:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case n.RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case n.ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case n.MirroredRepeatWrapping:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}this.flipY&&(e.y=1-e.y)}}},Object.assign(n.Texture.prototype,n.EventDispatcher.prototype),n.TextureIdCount=0,n.DepthTexture=function(e,t,r,i,a,o,s,c,u){n.Texture.call(this,null,i,a,o,s,c,n.DepthFormat,r,u),this.image={width:e,height:t},this.type=r!==void 0?r:n.UnsignedShortType,this.magFilter=s!==void 0?s:n.NearestFilter,this.minFilter=c!==void 0?c:n.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},n.DepthTexture.prototype=Object.create(n.Texture.prototype),n.DepthTexture.prototype.constructor=n.DepthTexture,n.CanvasTexture=function(e,t,r,i,a,o,s,c,u){n.Texture.call(this,e,t,r,i,a,o,s,c,u),this.needsUpdate=!0},n.CanvasTexture.prototype=Object.create(n.Texture.prototype),n.CanvasTexture.prototype.constructor=n.CanvasTexture,n.CubeTexture=function(e,t,r,i,a,o,s,c,u,h){e=e!==void 0?e:[],t=t!==void 0?t:n.CubeReflectionMapping,n.Texture.call(this,e,t,r,i,a,o,s,c,u,h),this.flipY=!1},n.CubeTexture.prototype=Object.create(n.Texture.prototype),n.CubeTexture.prototype.constructor=n.CubeTexture,Object.defineProperty(n.CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),n.CompressedTexture=function(e,t,r,i,a,o,s,c,u,h,l,f){n.Texture.call(this,null,o,s,c,u,h,i,a,l,f),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},n.CompressedTexture.prototype=Object.create(n.Texture.prototype),n.CompressedTexture.prototype.constructor=n.CompressedTexture,n.DataTexture=function(e,t,r,i,a,o,s,c,u,h,l,f){n.Texture.call(this,null,o,s,c,u,h,i,a,l,f),this.image={data:e,width:t,height:r},this.magFilter=u!==void 0?u:n.NearestFilter,this.minFilter=h!==void 0?h:n.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},n.DataTexture.prototype=Object.create(n.Texture.prototype),n.DataTexture.prototype.constructor=n.DataTexture,n.VideoTexture=function(e,t,r,i,a,o,s,c,u){n.Texture.call(this,e,t,r,i,a,o,s,c,u),this.generateMipmaps=!1;var h=this;function l(){requestAnimationFrame(l),e.readyState>=e.HAVE_CURRENT_DATA&&(h.needsUpdate=!0)}l()},n.VideoTexture.prototype=Object.create(n.Texture.prototype),n.VideoTexture.prototype.constructor=n.VideoTexture,n.Group=function(){n.Object3D.call(this),this.type="Group"},n.Group.prototype=Object.assign(Object.create(n.Object3D.prototype),{constructor:n.Group}),n.Points=function(e,t){n.Object3D.call(this),this.type="Points",this.geometry=e!==void 0?e:new n.BufferGeometry,this.material=t!==void 0?t:new n.PointsMaterial({color:Math.random()*16777215})},n.Points.prototype=Object.assign(Object.create(n.Object3D.prototype),{constructor:n.Points,raycast:function(){var e=new n.Matrix4,t=new n.Ray,r=new n.Sphere;return function(a,o){var s=this,c=this.geometry,u=this.matrixWorld,h=a.params.Points.threshold;if(c.boundingSphere===null&&c.computeBoundingSphere(),r.copy(c.boundingSphere),r.applyMatrix4(u),a.ray.intersectsSphere(r)===!1)return;e.getInverse(u),t.copy(a.ray).applyMatrix4(e);var l=h/((this.scale.x+this.scale.y+this.scale.z)/3),f=l*l,d=new n.Vector3;function p(C,P){var B=t.distanceSqToPoint(C);if(B<f){var F=t.closestPointToPoint(C);F.applyMatrix4(u);var N=a.ray.origin.distanceTo(F);if(N<a.near||N>a.far)return;o.push({distance:N,distanceToRay:Math.sqrt(B),point:F.clone(),index:P,face:null,object:s})}}if(c instanceof n.BufferGeometry){var m=c.index,y=c.attributes,g=y.position.array;if(m!==null)for(var x=m.array,M=0,w=x.length;M<w;M++){var E=x[M];d.fromArray(g,E*3),p(d,E)}else for(var M=0,S=g.length/3;M<S;M++)d.fromArray(g,M*3),p(d,M)}else for(var U=c.vertices,M=0,S=U.length;M<S;M++)p(U[M],M)}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),n.Line=function(e,t,r){if(r===1)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new n.LineSegments(e,t);n.Object3D.call(this),this.type="Line",this.geometry=e!==void 0?e:new n.BufferGeometry,this.material=t!==void 0?t:new n.LineBasicMaterial({color:Math.random()*16777215})},n.Line.prototype=Object.assign(Object.create(n.Object3D.prototype),{constructor:n.Line,raycast:function(){var e=new n.Matrix4,t=new n.Ray,r=new n.Sphere;return function(a,o){var s=a.linePrecision,c=s*s,u=this.geometry,h=this.matrixWorld;if(u.boundingSphere===null&&u.computeBoundingSphere(),r.copy(u.boundingSphere),r.applyMatrix4(h),a.ray.intersectsSphere(r)!==!1){e.getInverse(h),t.copy(a.ray).applyMatrix4(e);var l=new n.Vector3,f=new n.Vector3,d=new n.Vector3,p=new n.Vector3,m=this instanceof n.LineSegments?2:1;if(u instanceof n.BufferGeometry){var y=u.index,g=u.attributes,x=g.position.array;if(y!==null)for(var M=y.array,w=0,E=M.length-1;w<E;w+=m){var S=M[w],U=M[w+1];l.fromArray(x,S*3),f.fromArray(x,U*3);var C=t.distanceSqToSegment(l,f,p,d);if(!(C>c)){p.applyMatrix4(this.matrixWorld);var P=a.ray.origin.distanceTo(p);P<a.near||P>a.far||o.push({distance:P,point:d.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}else for(var w=0,E=x.length/3-1;w<E;w+=m){l.fromArray(x,3*w),f.fromArray(x,3*w+3);var C=t.distanceSqToSegment(l,f,p,d);if(!(C>c)){p.applyMatrix4(this.matrixWorld);var P=a.ray.origin.distanceTo(p);P<a.near||P>a.far||o.push({distance:P,point:d.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}else if(u instanceof n.Geometry)for(var B=u.vertices,F=B.length,w=0;w<F-1;w+=m){var C=t.distanceSqToSegment(B[w],B[w+1],p,d);if(!(C>c)){p.applyMatrix4(this.matrixWorld);var P=a.ray.origin.distanceTo(p);P<a.near||P>a.far||o.push({distance:P,point:d.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),n.LineSegments=function(e,t){n.Line.call(this,e,t),this.type="LineSegments"},n.LineSegments.prototype=Object.assign(Object.create(n.Line.prototype),{constructor:n.LineSegments}),n.Mesh=function(e,t){n.Object3D.call(this),this.type="Mesh",this.geometry=e!==void 0?e:new n.BufferGeometry,this.material=t!==void 0?t:new n.MeshBasicMaterial({color:Math.random()*16777215}),this.drawMode=n.TrianglesDrawMode,this.updateMorphTargets()},n.Mesh.prototype=Object.assign(Object.create(n.Object3D.prototype),{constructor:n.Mesh,setDrawMode:function(e){this.drawMode=e},updateMorphTargets:function(){if(this.geometry.morphTargets!==void 0&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},getMorphTargetIndexByName:function(e){return this.morphTargetDictionary[e]!==void 0?this.morphTargetDictionary[e]:(console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},raycast:function(){var e=new n.Matrix4,t=new n.Ray,r=new n.Sphere,i=new n.Vector3,a=new n.Vector3,o=new n.Vector3,s=new n.Vector3,c=new n.Vector3,u=new n.Vector3,h=new n.Vector2,l=new n.Vector2,f=new n.Vector2,d=new n.Vector3,p=new n.Vector3,m=new n.Vector3;function y(M,w,E,S,U,C,P){return n.Triangle.barycoordFromPoint(M,w,E,S,d),U.multiplyScalar(d.x),C.multiplyScalar(d.y),P.multiplyScalar(d.z),U.add(C).add(P),U.clone()}function g(M,w,E,S,U,C,P){var B,F=M.material;if(F.side===n.BackSide?B=E.intersectTriangle(C,U,S,!0,P):B=E.intersectTriangle(S,U,C,F.side!==n.DoubleSide,P),B===null)return null;m.copy(P),m.applyMatrix4(M.matrixWorld);var N=w.ray.origin.distanceTo(m);return N<w.near||N>w.far?null:{distance:N,point:m.clone(),object:M}}function x(M,w,E,S,U,C,P,B){i.fromArray(S,C*3),a.fromArray(S,P*3),o.fromArray(S,B*3);var F=g(M,w,E,i,a,o,p);return F&&(U&&(h.fromArray(U,C*2),l.fromArray(U,P*2),f.fromArray(U,B*2),F.uv=y(p,i,a,o,h,l,f)),F.face=new n.Face3(C,P,B,n.Triangle.normal(i,a,o)),F.faceIndex=C),F}return function(w,E){var S=this.geometry,U=this.material,C=this.matrixWorld;if(U!==void 0&&(S.boundingSphere===null&&S.computeBoundingSphere(),r.copy(S.boundingSphere),r.applyMatrix4(C),w.ray.intersectsSphere(r)!==!1&&(e.getInverse(C),t.copy(w.ray).applyMatrix4(e),!(S.boundingBox!==null&&t.intersectsBox(S.boundingBox)===!1)))){var P,B;if(S instanceof n.BufferGeometry){var F,N,W,I=S.index,k=S.attributes,T=k.position.array;if(k.uv!==void 0&&(P=k.uv.array),I!==null)for(var O=I.array,G=0,j=O.length;G<j;G+=3)F=O[G],N=O[G+1],W=O[G+2],B=x(this,w,t,T,P,F,N,W),B&&(B.faceIndex=Math.floor(G/3),E.push(B));else for(var G=0,j=T.length;G<j;G+=9)F=G/3,N=F+1,W=F+2,B=x(this,w,t,T,P,F,N,W),B&&(B.index=F,E.push(B))}else if(S instanceof n.Geometry){var Z,Q,R,A=U instanceof n.MultiMaterial,D=A===!0?U.materials:null,H=S.vertices,Y=S.faces,X=S.faceVertexUvs[0];X.length>0&&(P=X);for(var K=0,ie=Y.length;K<ie;K++){var ce=Y[K],b=A===!0?D[ce.materialIndex]:U;if(b!==void 0){if(Z=H[ce.a],Q=H[ce.b],R=H[ce.c],b.morphTargets===!0){var me=S.morphTargets,_e=this.morphTargetInfluences;i.set(0,0,0),a.set(0,0,0),o.set(0,0,0);for(var he=0,pe=me.length;he<pe;he++){var J=_e[he];if(J!==0){var fe=me[he].vertices;i.addScaledVector(s.subVectors(fe[ce.a],Z),J),a.addScaledVector(c.subVectors(fe[ce.b],Q),J),o.addScaledVector(u.subVectors(fe[ce.c],R),J)}}i.add(Z),a.add(Q),o.add(R),Z=i,Q=a,R=o}if(B=g(this,w,t,Z,Q,R,p),B){if(P){var le=P[K];h.copy(le[0]),l.copy(le[1]),f.copy(le[2]),B.uv=y(p,Z,Q,R,h,l,f)}B.face=ce,B.faceIndex=K,E.push(B)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),n.Bone=function(e){n.Object3D.call(this),this.type="Bone",this.skin=e},n.Bone.prototype=Object.assign(Object.create(n.Object3D.prototype),{constructor:n.Bone,copy:function(e){return n.Object3D.prototype.copy.call(this,e),this.skin=e.skin,this}}),n.Skeleton=function(e,t,r){if(this.useVertexTexture=r!==void 0?r:!0,this.identityMatrix=new n.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var i=Math.sqrt(this.bones.length*4);i=n.Math.nextPowerOfTwo(Math.ceil(i)),i=Math.max(i,4),this.boneTextureWidth=i,this.boneTextureHeight=i,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new n.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,n.RGBAFormat,n.FloatType)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(t===void 0)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var a=0,o=this.bones.length;a<o;a++)this.boneInverses.push(new n.Matrix4)}},Object.assign(n.Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new n.Matrix4;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){for(var e,t=0,r=this.bones.length;t<r;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,r=this.bones.length;t<r;t++)e=this.bones[t],e&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new n.Matrix4;return function(){for(var r=0,i=this.bones.length;r<i;r++){var a=this.bones[r]?this.bones[r].matrixWorld:this.identityMatrix;e.multiplyMatrices(a,this.boneInverses[r]),e.toArray(this.boneMatrices,r*16)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new n.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)}}),n.SkinnedMesh=function(e,t,r){n.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new n.Matrix4,this.bindMatrixInverse=new n.Matrix4;var i=[];if(this.geometry&&this.geometry.bones!==void 0){for(var a,o,s=0,c=this.geometry.bones.length;s<c;++s)o=this.geometry.bones[s],a=new n.Bone(this),i.push(a),a.name=o.name,a.position.fromArray(o.pos),a.quaternion.fromArray(o.rotq),o.scl!==void 0&&a.scale.fromArray(o.scl);for(var s=0,c=this.geometry.bones.length;s<c;++s)o=this.geometry.bones[s],o.parent!==-1&&o.parent!==null&&i[o.parent]!==void 0?i[o.parent].add(i[s]):this.add(i[s])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new n.Skeleton(i,void 0,r),this.matrixWorld)},n.SkinnedMesh.prototype=Object.assign(Object.create(n.Mesh.prototype),{constructor:n.SkinnedMesh,bind:function(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry instanceof n.Geometry)for(var e=0;e<this.geometry.skinWeights.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0)}else if(this.geometry instanceof n.BufferGeometry)for(var i=new n.Vector4,a=this.geometry.attributes.skinWeight,e=0;e<a.count;e++){i.x=a.getX(e),i.y=a.getY(e),i.z=a.getZ(e),i.w=a.getW(e);var r=1/i.lengthManhattan();r!==1/0?i.multiplyScalar(r):i.set(1,0,0,0),a.setXYZW(e,i.x,i.y,i.z,i.w)}},updateMatrixWorld:function(e){n.Mesh.prototype.updateMatrixWorld.call(this,!0),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)}}),n.LOD=function(){n.Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})},n.LOD.prototype=Object.assign(Object.create(n.Object3D.prototype),{constructor:n.LOD,copy:function(e){n.Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,i=t.length;r<i;r++){var a=t[r];this.addLevel(a.object.clone(),a.distance)}return this},addLevel:function(e,t){t===void 0&&(t=0),t=Math.abs(t);for(var r=this.levels,i=0;i<r.length&&!(t<r[i].distance);i++);r.splice(i,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,r=1,i=t.length;r<i&&!(e<t[r].distance);r++);return t[r-1].object},raycast:function(){var e=new n.Vector3;return function(r,i){e.setFromMatrixPosition(this.matrixWorld);var a=r.ray.origin.distanceTo(e);this.getObjectForDistance(a).raycast(r,i)}}(),update:function(){var e=new n.Vector3,t=new n.Vector3;return function(i){var a=this.levels;if(a.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var o=e.distanceTo(t);a[0].object.visible=!0;for(var s=1,c=a.length;s<c&&o>=a[s].distance;s++)a[s-1].object.visible=!1,a[s].object.visible=!0;for(;s<c;s++)a[s].object.visible=!1}}}(),toJSON:function(e){var t=n.Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,i=0,a=r.length;i<a;i++){var o=r[i];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),n.Sprite=function(e){n.Object3D.call(this),this.type="Sprite",this.material=e!==void 0?e:new n.SpriteMaterial},n.Sprite.prototype=Object.assign(Object.create(n.Object3D.prototype),{constructor:n.Sprite,raycast:function(){var e=new n.Vector3;return function(r,i){e.setFromMatrixPosition(this.matrixWorld);var a=r.ray.distanceSqToPoint(e),o=this.scale.x*this.scale.y/4;a>o||i.push({distance:Math.sqrt(a),point:this.position,face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)}}),n.LensFlare=function(e,t,r,i,a){n.Object3D.call(this),this.lensFlares=[],this.positionScreen=new n.Vector3,this.customUpdateCallback=void 0,e!==void 0&&this.add(e,t,r,i,a)},n.LensFlare.prototype=Object.assign(Object.create(n.Object3D.prototype),{constructor:n.LensFlare,copy:function(e){n.Object3D.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,r=e.lensFlares.length;t<r;t++)this.lensFlares.push(e.lensFlares[t]);return this},add:function(e,t,r,i,a,o){t===void 0&&(t=-1),r===void 0&&(r=0),o===void 0&&(o=1),a===void 0&&(a=new n.Color(16777215)),i===void 0&&(i=n.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:a,blending:i})},updateLensFlares:function(){var e,t=this.lensFlares.length,r,i=-this.positionScreen.x*2,a=-this.positionScreen.y*2;for(e=0;e<t;e++)r=this.lensFlares[e],r.x=this.positionScreen.x+i*r.distance,r.y=this.positionScreen.y+a*r.distance,r.wantedRotation=r.x*Math.PI*.25,r.rotation+=(r.wantedRotation-r.rotation)*.25}}),n.Scene=function(){n.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},n.Scene.prototype=Object.create(n.Object3D.prototype),n.Scene.prototype.constructor=n.Scene,n.Scene.prototype.copy=function(e,t){return n.Object3D.prototype.copy.call(this,e,t),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},n.Fog=function(e,t,r){this.name="",this.color=new n.Color(e),this.near=t!==void 0?t:1,this.far=r!==void 0?r:1e3},n.Fog.prototype.clone=function(){return new n.Fog(this.color.getHex(),this.near,this.far)},n.FogExp2=function(e,t){this.name="",this.color=new n.Color(e),this.density=t!==void 0?t:25e-5},n.FogExp2.prototype.clone=function(){return new n.FogExp2(this.color.getHex(),this.density)},n.ShaderChunk={},n.ShaderChunk.alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif
`,n.ShaderChunk.alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif
`,n.ShaderChunk.alphatest_fragment=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif
`,n.ShaderChunk.aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( PHYSICAL )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif
`,n.ShaderChunk.aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,n.ShaderChunk.begin_vertex=`
vec3 transformed = vec3( position );
`,n.ShaderChunk.beginnormal_vertex=`
vec3 objectNormal = vec3( normal );
`,n.ShaderChunk.bsdfs=`bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {
	return any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
		if( decayExponent > 0.0 ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
			float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
			float maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
			return distanceFalloff * maxDistanceCutoffFactor;
#else
			return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
#endif
		}
		return 1.0;
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;
	return specularColor * AB.x + AB.y;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
`,n.ShaderChunk.bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = dFdx( surf_pos );
		vec3 vSigmaY = dFdy( surf_pos );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif
`,n.ShaderChunk.clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	for ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {
		vec4 plane = clippingPlanes[ i ];
		if ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;
	}
#endif
`,n.ShaderChunk.clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	#if ! defined( PHYSICAL ) && ! defined( PHONG )
		varying vec3 vViewPosition;
	#endif
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif
`,n.ShaderChunk.clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )
	varying vec3 vViewPosition;
#endif
`,n.ShaderChunk.clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )
	vViewPosition = - mvPosition.xyz;
#endif
`,n.ShaderChunk.color_fragment=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,n.ShaderChunk.color_pars_fragment=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif
`,n.ShaderChunk.color_pars_vertex=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,n.ShaderChunk.color_vertex=`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,n.ShaderChunk.common=`#define PI 3.14159265359
#define PI2 6.28318530718
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#define saturate(a) clamp( a, 0.0, 1.0 )
#define whiteCompliment(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
`,n.ShaderChunk.cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_textureSize (1024.0)
int getFaceFromDirection(vec3 direction) {
	vec3 absDirection = abs(direction);
	int face = -1;
	if( absDirection.x > absDirection.z ) {
		if(absDirection.x > absDirection.y )
			face = direction.x > 0.0 ? 0 : 3;
		else
			face = direction.y > 0.0 ? 1 : 4;
	}
	else {
		if(absDirection.z > absDirection.y )
			face = direction.z > 0.0 ? 2 : 5;
		else
			face = direction.y > 0.0 ? 1 : 4;
	}
	return face;
}
#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)
#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))
vec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {
	float scale = exp2(cubeUV_maxLods1 - roughnessLevel);
	float dxRoughness = dFdx(roughness);
	float dyRoughness = dFdy(roughness);
	vec3 dx = dFdx( vec * scale * dxRoughness );
	vec3 dy = dFdy( vec * scale * dyRoughness );
	float d = max( dot( dx, dx ), dot( dy, dy ) );
	d = clamp(d, 1.0, cubeUV_rangeClamp);
	float mipLevel = 0.5 * log2(d);
	return vec2(floor(mipLevel), fract(mipLevel));
}
#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)
#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)
vec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {
	mipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;
	float a = 16.0 * cubeUV_rcpTextureSize;
	vec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );
	vec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;
	float powScale = exp2_packed.x * exp2_packed.y;
	float scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;
	float mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;
	bool bRes = mipLevel == 0.0;
	scale =  bRes && (scale < a) ? a : scale;
	vec3 r;
	vec2 offset;
	int face = getFaceFromDirection(direction);
	float rcpPowScale = 1.0 / powScale;
	if( face == 0) {
		r = vec3(direction.x, -direction.z, direction.y);
		offset = vec2(0.0+mipOffset,0.75 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;
	}
	else if( face == 1) {
		r = vec3(direction.y, direction.x, direction.z);
		offset = vec2(scale+mipOffset, 0.75 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;
	}
	else if( face == 2) {
		r = vec3(direction.z, direction.x, direction.y);
		offset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;
	}
	else if( face == 3) {
		r = vec3(direction.x, direction.z, direction.y);
		offset = vec2(0.0+mipOffset,0.5 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;
	}
	else if( face == 4) {
		r = vec3(direction.y, direction.x, -direction.z);
		offset = vec2(scale+mipOffset, 0.5 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;
	}
	else {
		r = vec3(direction.z, -direction.x, direction.y);
		offset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;
	}
	r = normalize(r);
	float texelOffset = 0.5 * cubeUV_rcpTextureSize;
	vec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;
	vec2 base = offset + vec2( texelOffset );
	return base + s * ( scale - 2.0 * texelOffset );
}
#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)
vec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {
	float roughnessVal = roughness* cubeUV_maxLods3;
	float r1 = floor(roughnessVal);
	float r2 = r1 + 1.0;
	float t = fract(roughnessVal);
	vec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);
	float s = mipInfo.y;
	float level0 = mipInfo.x;
	float level1 = level0 + 1.0;
	level1 = level1 > 5.0 ? 5.0 : level1;
	level0 += min( floor( s + 0.5 ), 5.0 );
	vec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);
	vec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));
	vec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);
	vec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));
	vec4 result = mix(color10, color20, t);
	return vec4(result.rgb, 1.0);
}
#endif
`,n.ShaderChunk.defaultnormal_vertex=`#ifdef FLIP_SIDED
	objectNormal = -objectNormal;
#endif
vec3 transformedNormal = normalMatrix * objectNormal;
`,n.ShaderChunk.displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );
#endif
`,n.ShaderChunk.displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif
`,n.ShaderChunk.emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif
`,n.ShaderChunk.emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif
`,n.ShaderChunk.encodings_pars_fragment=`
vec4 LinearToLinear( in vec4 value ) {
  return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );
}
vec4 sRGBToLinear( in vec4 value ) {
  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );
}
vec4 LinearTosRGB( in vec4 value ) {
  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );
}
vec4 RGBEToLinear( in vec4 value ) {
  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
  float maxComponent = max( max( value.r, value.g ), value.b );
  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
  return vec4( value.xyz * value.w * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
  float maxRGB = max( value.x, max( value.g, value.b ) );
  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );
  M            = ceil( M * 255.0 ) / 255.0;
  return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
    float maxRGB = max( value.x, max( value.g, value.b ) );
    float D      = max( maxRange / maxRGB, 1.0 );
    D            = min( floor( D ) / 255.0, 1.0 );
    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;
  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));
  vec4 vResult;
  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
  vResult.w = fract(Le);
  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;
  return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
  float Le = value.z * 255.0 + value.w;
  vec3 Xp_Y_XYZp;
  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);
  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;
  return vec4( max(vRGB, 0.0), 1.0 );
}
`,n.ShaderChunk.encodings_fragment=`  gl_FragColor = linearToOutputTexel( gl_FragColor );
`,n.ShaderChunk.envmap_fragment=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToVertex, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef DOUBLE_SIDED
		float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#else
		float flipNormal = 1.0;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		vec2 sampleUV;
		sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );
		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
		vec4 envColor = texture2D( envMap, sampleUV );
	#elif defined( ENVMAP_TYPE_SPHERE )
		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));
		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );
	#endif
	envColor = envMapTexelToLinear( envColor );
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif
`,n.ShaderChunk.envmap_pars_fragment=`#if defined( USE_ENVMAP ) || defined( PHYSICAL )
	uniform float reflectivity;
	uniform float envMapIntenstiy;
#endif
#ifdef USE_ENVMAP
	#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )
		varying vec3 vWorldPosition;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	uniform float flipEnvMap;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif
`,n.ShaderChunk.envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif
`,n.ShaderChunk.envmap_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif
`,n.ShaderChunk.fog_fragment=`#ifdef USE_FOG
	#ifdef USE_LOGDEPTHBUF_EXT
		float depth = gl_FragDepthEXT / gl_FragCoord.w;
	#else
		float depth = gl_FragCoord.z / gl_FragCoord.w;
	#endif
	#ifdef FOG_EXP2
		float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, depth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif
`,n.ShaderChunk.fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,n.ShaderChunk.lightmap_fragment=`#ifdef USE_LIGHTMAP
	reflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;
#endif
`,n.ShaderChunk.lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,n.ShaderChunk.lights_lambert_vertex=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
#if NUM_POINT_LIGHTS > 0
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_DIR_LIGHTS > 0
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_HEMI_LIGHTS > 0
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
#endif
`,n.ShaderChunk.lights_pars=`uniform vec3 ambientLightColor;
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		if ( testLightInRange( lightDistance, pointLight.distance ) ) {
			directLight.color = pointLight.color;
			directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif
#if defined( USE_ENVMAP ) && defined( PHYSICAL )
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		#ifdef DOUBLE_SIDED
			float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#else
			float flipNormal = 1.0;
		#endif
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			vec4 envMapColor = textureCubeUV( queryVec, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );
		#else
			vec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );
		#endif
		#ifdef DOUBLE_SIDED
			float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#else
			float flipNormal = 1.0;
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			vec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV;
			sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );
			sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_SPHERE )
			vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif
`,n.ShaderChunk.lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;
`,n.ShaderChunk.lights_phong_pars_fragment=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)
`,n.ShaderChunk.lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );
#ifdef STANDARD
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.16 * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#endif
`,n.ShaderChunk.lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
	#ifndef STANDARD
	#endif
};
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );
}
#define RE_Direct				RE_Direct_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}
`,n.ShaderChunk.lights_template=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = normalize( vViewPosition );
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#ifdef USE_SHADOWMAP
		directLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#ifdef USE_SHADOWMAP
		directLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#ifdef USE_SHADOWMAP
		directLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if defined( RE_IndirectDiffuse )
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#ifdef USE_LIGHTMAP
		vec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
	#endif
	#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )
	 	irradiance += getLightProbeIndirectIrradiance( geometry, 8 );
	#endif
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	vec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );
	RE_IndirectSpecular( radiance, geometry, material, reflectedLight );
#endif
`,n.ShaderChunk.logdepthbuf_fragment=`#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)
	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;
#endif`,n.ShaderChunk.logdepthbuf_pars_fragment=`#ifdef USE_LOGDEPTHBUF
	uniform float logDepthBufFC;
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
	#endif
#endif
`,n.ShaderChunk.logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
	#endif
	uniform float logDepthBufFC;
#endif`,n.ShaderChunk.logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
	#else
		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;
	#endif
#endif
`,n.ShaderChunk.map_fragment=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif
`,n.ShaderChunk.map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif
`,n.ShaderChunk.map_particle_fragment=`#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
`,n.ShaderChunk.map_particle_pars_fragment=`#ifdef USE_MAP
	uniform vec4 offsetRepeat;
	uniform sampler2D map;
#endif
`,n.ShaderChunk.metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.r;
#endif
`,n.ShaderChunk.metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,n.ShaderChunk.morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];
	objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];
	objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];
	objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];
#endif
`,n.ShaderChunk.morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,n.ShaderChunk.morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];
	transformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];
	transformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];
	transformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];
	transformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];
	transformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];
	transformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];
	#endif
#endif
`,n.ShaderChunk.normal_fragment=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );
	#endif
#endif
#ifdef USE_NORMALMAP
	normal = perturbNormal2Arb( -vViewPosition, normal );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif
`,n.ShaderChunk.normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 S = normalize( q0 * st1.t - q1 * st0.t );
		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );
		vec3 N = normalize( surf_norm );
		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
		mapN.xy = normalScale * mapN.xy;
		mat3 tsn = mat3( S, T, N );
		return normalize( tsn * mapN );
	}
#endif
`,n.ShaderChunk.packing=`vec3 packNormalToRGB( const in vec3 normal ) {
  return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
  return 1.0 - 2.0 * rgb.xyz;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
float viewZToOrthoDepth( const in float viewZ, const in float near, const in float far ) {
  return ( viewZ + near ) / ( near - far );
}
float OrthoDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
  return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
  return ( near * far ) / ( ( far - near ) * invClipZ - far );
}
`,n.ShaderChunk.premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif
`,n.ShaderChunk.project_vertex=`#ifdef USE_SKINNING
	vec4 mvPosition = modelViewMatrix * skinned;
#else
	vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
#endif
gl_Position = projectionMatrix * mvPosition;
`,n.ShaderChunk.roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.r;
#endif
`,n.ShaderChunk.roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,n.ShaderChunk.shadowmap_pars_fragment=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];
	#endif
	#if NUM_SPOT_LIGHTS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];
	#endif
	#if NUM_POINT_LIGHTS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	float texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {
		const vec2 offset = vec2( 0.0, 1.0 );
		vec2 texelSize = vec2( 1.0 ) / size;
		vec2 centroidUV = floor( uv * size + 0.5 ) / size;
		float lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );
		float lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );
		float rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );
		float rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );
		vec2 f = fract( uv * size + 0.5 );
		float a = mix( lb, lt, f.y );
		float b = mix( rb, rt, f.y );
		float c = mix( a, b, f.x );
		return c;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			return (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			return (
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return 1.0;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		float dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif
`,n.ShaderChunk.shadowmap_pars_vertex=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];
	#endif
	#if NUM_SPOT_LIGHTS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];
	#endif
	#if NUM_POINT_LIGHTS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];
	#endif
#endif
`,n.ShaderChunk.shadowmap_vertex=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_SPOT_LIGHTS > 0
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_POINT_LIGHTS > 0
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;
	}
	#endif
#endif
`,n.ShaderChunk.shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
	DirectionalLight directionalLight;
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		shadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_SPOT_LIGHTS > 0
	SpotLight spotLight;
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		shadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_POINT_LIGHTS > 0
	PointLight pointLight;
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		shadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#endif
	return shadow;
}
`,n.ShaderChunk.skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,n.ShaderChunk.skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform sampler2D boneTexture;
		uniform int boneTextureWidth;
		uniform int boneTextureHeight;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureWidth ) );
			float y = floor( j / float( boneTextureWidth ) );
			float dx = 1.0 / float( boneTextureWidth );
			float dy = 1.0 / float( boneTextureHeight );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif
`,n.ShaderChunk.skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	skinned  = bindMatrixInverse * skinned;
#endif
`,n.ShaderChunk.skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
#endif
`,n.ShaderChunk.specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,n.ShaderChunk.specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,n.ShaderChunk.tonemapping_fragment=`#if defined( TONE_MAPPING )
  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif
`,n.ShaderChunk.tonemapping_pars_fragment=`#define saturate(a) clamp( a, 0.0, 1.0 )
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping( vec3 color ) {
  return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
  color *= toneMappingExposure;
  return saturate( color / ( vec3( 1.0 ) + color ) );
}
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {
  color *= toneMappingExposure;
  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
  color *= toneMappingExposure;
  color = max( vec3( 0.0 ), color - 0.004 );
  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
`,n.ShaderChunk.uv2_pars_fragment=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,n.ShaderChunk.uv2_pars_vertex=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
#endif`,n.ShaderChunk.uv2_vertex=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = uv2;
#endif`,n.ShaderChunk.uv_pars_fragment=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )
	varying vec2 vUv;
#endif`,n.ShaderChunk.uv_pars_vertex=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )
	varying vec2 vUv;
	uniform vec4 offsetRepeat;
#endif
`,n.ShaderChunk.uv_vertex=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )
	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;
#endif`,n.ShaderChunk.worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )
	#ifdef USE_SKINNING
		vec4 worldPosition = modelMatrix * skinned;
	#else
		vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
	#endif
#endif
`,n.UniformsUtils={merge:function(e){for(var t={},r=0;r<e.length;r++){var i=this.clone(e[r]);for(var a in i)t[a]=i[a]}return t},clone:function(e){var t={};for(var r in e){t[r]={};for(var i in e[r]){var a=e[r][i];a instanceof n.Color||a instanceof n.Vector2||a instanceof n.Vector3||a instanceof n.Vector4||a instanceof n.Matrix3||a instanceof n.Matrix4||a instanceof n.Texture?t[r][i]=a.clone():Array.isArray(a)?t[r][i]=a.slice():t[r][i]=a}}return t}},n.UniformsLib={common:{diffuse:{type:"c",value:new n.Color(15658734)},opacity:{type:"1f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"1f",value:-1},reflectivity:{type:"1f",value:1},refractionRatio:{type:"1f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"1f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"1f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"1f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new n.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"1f",value:1},displacementBias:{type:"1f",value:0}},roughnessmap:{roughnessMap:{type:"t",value:null}},metalnessmap:{metalnessMap:{type:"t",value:null}},fog:{fogDensity:{type:"1f",value:25e-5},fogNear:{type:"1f",value:1},fogFar:{type:"1f",value:2e3},fogColor:{type:"c",value:new n.Color(16777215)}},lights:{ambientLightColor:{type:"3fv",value:[]},directionalLights:{type:"sa",value:[],properties:{direction:{type:"v3"},color:{type:"c"},shadow:{type:"1i"},shadowBias:{type:"1f"},shadowRadius:{type:"1f"},shadowMapSize:{type:"v2"}}},directionalShadowMap:{type:"tv",value:[]},directionalShadowMatrix:{type:"m4v",value:[]},spotLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},direction:{type:"v3"},distance:{type:"1f"},coneCos:{type:"1f"},penumbraCos:{type:"1f"},decay:{type:"1f"},shadow:{type:"1i"},shadowBias:{type:"1f"},shadowRadius:{type:"1f"},shadowMapSize:{type:"v2"}}},spotShadowMap:{type:"tv",value:[]},spotShadowMatrix:{type:"m4v",value:[]},pointLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},decay:{type:"1f"},distance:{type:"1f"},shadow:{type:"1i"},shadowBias:{type:"1f"},shadowRadius:{type:"1f"},shadowMapSize:{type:"v2"}}},pointShadowMap:{type:"tv",value:[]},pointShadowMatrix:{type:"m4v",value:[]},hemisphereLights:{type:"sa",value:[],properties:{direction:{type:"v3"},skyColor:{type:"c"},groundColor:{type:"c"}}}},points:{diffuse:{type:"c",value:new n.Color(15658734)},opacity:{type:"1f",value:1},size:{type:"1f",value:1},scale:{type:"1f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new n.Vector4(0,0,1,1)}}},n.ShaderChunk.cube_frag=`uniform samplerCube tCube;
uniform float tFlip;
varying vec3 vWorldPosition;
#include <common>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );
	#include <logdepthbuf_fragment>
}
`,n.ShaderChunk.cube_vert=`varying vec3 vWorldPosition;
#include <common>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vWorldPosition = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}
`,n.ShaderChunk.depth_frag=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( gl_FragCoord.z );
	#endif
}
`,n.ShaderChunk.depth_vert=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#include <begin_vertex>
	#include <displacementmap_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}
`,n.ShaderChunk.distanceRGBA_frag=`uniform vec3 lightPos;
varying vec4 vWorldPosition;
#include <common>
#include <packing>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	gl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );
}
`,n.ShaderChunk.distanceRGBA_vert=`varying vec4 vWorldPosition;
#include <common>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <skinbase_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition;
}
`,n.ShaderChunk.equirect_frag=`uniform sampler2D tEquirect;
uniform float tFlip;
varying vec3 vWorldPosition;
#include <common>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 direction = normalize( vWorldPosition );
	vec2 sampleUV;
	sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );
	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <logdepthbuf_fragment>
}
`,n.ShaderChunk.equirect_vert=`varying vec3 vWorldPosition;
#include <common>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vWorldPosition = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}
`,n.ShaderChunk.linedashed_frag=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}
`,n.ShaderChunk.linedashed_vert=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	vLineDistance = scale * lineDistance;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}
`,n.ShaderChunk.meshbasic_frag=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight;
	reflectedLight.directDiffuse = vec3( 0.0 );
	reflectedLight.directSpecular = vec3( 0.0 );
	reflectedLight.indirectDiffuse = diffuseColor.rgb;
	reflectedLight.indirectSpecular = vec3( 0.0 );
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}
`,n.ShaderChunk.meshbasic_vert=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
}
`,n.ShaderChunk.meshlambert_frag=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
#endif
#include <common>
#include <packing>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_pars_fragment>
#include <bsdfs>
#include <lights_pars>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}
`,n.ShaderChunk.meshlambert_vert=`#define LAMBERT
varying vec3 vLightFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars>
#include <color_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
}
`,n.ShaderChunk.meshphong_frag=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_template>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}
`,n.ShaderChunk.meshphong_vert=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <displacementmap_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
}
`,n.ShaderChunk.meshphysical_frag=`#define PHYSICAL
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float envMapIntensity;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <packing>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <lights_pars>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_template>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}
`,n.ShaderChunk.meshphysical_vert=`#define PHYSICAL
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <displacementmap_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
}
`,n.ShaderChunk.normal_frag=`uniform float opacity;
varying vec3 vNormal;
#include <common>
#include <packing>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	gl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );
	#include <logdepthbuf_fragment>
}
`,n.ShaderChunk.normal_vert=`varying vec3 vNormal;
#include <common>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vNormal = normalize( normalMatrix * normal );
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}
`,n.ShaderChunk.points_frag=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}
`,n.ShaderChunk.points_vert=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <project_vertex>
	#ifdef USE_SIZEATTENUATION
		gl_PointSize = size * ( scale / - mvPosition.z );
	#else
		gl_PointSize = size;
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
}
`,n.ShaderChunk.shadow_frag=`uniform float opacity;
#include <common>
#include <packing>
#include <bsdfs>
#include <lights_pars>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );
}
`,n.ShaderChunk.shadow_vert=`#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
}
`,n.ShaderLib={basic:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.aomap,n.UniformsLib.fog]),vertexShader:n.ShaderChunk.meshbasic_vert,fragmentShader:n.ShaderChunk.meshbasic_frag},lambert:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.aomap,n.UniformsLib.lightmap,n.UniformsLib.emissivemap,n.UniformsLib.fog,n.UniformsLib.lights,{emissive:{type:"c",value:new n.Color(0)}}]),vertexShader:n.ShaderChunk.meshlambert_vert,fragmentShader:n.ShaderChunk.meshlambert_frag},phong:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.aomap,n.UniformsLib.lightmap,n.UniformsLib.emissivemap,n.UniformsLib.bumpmap,n.UniformsLib.normalmap,n.UniformsLib.displacementmap,n.UniformsLib.fog,n.UniformsLib.lights,{emissive:{type:"c",value:new n.Color(0)},specular:{type:"c",value:new n.Color(1118481)},shininess:{type:"1f",value:30}}]),vertexShader:n.ShaderChunk.meshphong_vert,fragmentShader:n.ShaderChunk.meshphong_frag},standard:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.aomap,n.UniformsLib.lightmap,n.UniformsLib.emissivemap,n.UniformsLib.bumpmap,n.UniformsLib.normalmap,n.UniformsLib.displacementmap,n.UniformsLib.roughnessmap,n.UniformsLib.metalnessmap,n.UniformsLib.fog,n.UniformsLib.lights,{emissive:{type:"c",value:new n.Color(0)},roughness:{type:"1f",value:.5},metalness:{type:"1f",value:0},envMapIntensity:{type:"1f",value:1}}]),vertexShader:n.ShaderChunk.meshphysical_vert,fragmentShader:n.ShaderChunk.meshphysical_frag},points:{uniforms:n.UniformsUtils.merge([n.UniformsLib.points,n.UniformsLib.fog]),vertexShader:n.ShaderChunk.points_vert,fragmentShader:n.ShaderChunk.points_frag},dashed:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,{scale:{type:"1f",value:1},dashSize:{type:"1f",value:1},totalSize:{type:"1f",value:2}}]),vertexShader:n.ShaderChunk.linedashed_vert,fragmentShader:n.ShaderChunk.linedashed_frag},depth:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.displacementmap]),vertexShader:n.ShaderChunk.depth_vert,fragmentShader:n.ShaderChunk.depth_frag},normal:{uniforms:{opacity:{type:"1f",value:1}},vertexShader:n.ShaderChunk.normal_vert,fragmentShader:n.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"1f",value:-1}},vertexShader:n.ShaderChunk.cube_vert,fragmentShader:n.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"1f",value:-1}},vertexShader:n.ShaderChunk.equirect_vert,fragmentShader:n.ShaderChunk.equirect_frag},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new n.Vector3}},vertexShader:n.ShaderChunk.distanceRGBA_vert,fragmentShader:n.ShaderChunk.distanceRGBA_frag}},n.ShaderLib.physical={uniforms:n.UniformsUtils.merge([n.ShaderLib.standard.uniforms,{}]),vertexShader:n.ShaderChunk.meshphysical_vert,fragmentShader:n.ShaderChunk.meshphysical_frag},n.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",n.REVISION),e=e||{};var t=e.canvas!==void 0?e.canvas:document.createElement("canvas"),r=e.context!==void 0?e.context:null,i=e.alpha!==void 0?e.alpha:!1,a=e.depth!==void 0?e.depth:!0,o=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,c=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,u=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,h=[],l=[],f=-1,d=[],p=-1,m=new Float32Array(8),y=[],g=[];this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=n.LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var x=this,M=null,w=null,E=null,S=-1,U="",C=null,P=new n.Vector4,B=null,F=new n.Vector4,N=0,W=new n.Color(0),I=0,k=t.width,T=t.height,O=1,G=new n.Vector4(0,0,k,T),j=!1,Z=new n.Vector4(0,0,k,T),Q=new n.Frustum,R=new n.WebGLClipping,A=!1,D=!1,H=new n.Sphere,Y=new n.Matrix4,X=new n.Vector3,K={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},ie={geometries:0,textures:0},ce={calls:0,vertices:0,faces:0,points:0};this.info={render:ce,memory:ie,programs:null};var b;try{var me={alpha:i,depth:a,stencil:o,antialias:s,premultipliedAlpha:c,preserveDrawingBuffer:u};if(b=r||t.getContext("webgl",me)||t.getContext("experimental-webgl",me),b===null)throw t.getContext("webgl")!==null?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";b.getShaderPrecisionFormat===void 0&&(b.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),t.addEventListener("webglcontextlost",ze,!1)}catch(v){console.error("THREE.WebGLRenderer: "+v)}var _e=typeof WebGL2RenderingContext<"u"&&b instanceof WebGL2RenderingContext,he=new n.WebGLExtensions(b);he.get("WEBGL_depth_texture"),he.get("OES_texture_float"),he.get("OES_texture_float_linear"),he.get("OES_texture_half_float"),he.get("OES_texture_half_float_linear"),he.get("OES_standard_derivatives"),he.get("ANGLE_instanced_arrays"),he.get("OES_element_index_uint")&&(n.BufferGeometry.MaxIndex=4294967296);var pe=new n.WebGLCapabilities(b,he,e),J=new n.WebGLState(b,he,Ce),fe=new n.WebGLProperties,le=new n.WebGLObjects(b,fe,this.info),de=new n.WebGLPrograms(this,pe),ge=new n.WebGLLights;this.info.programs=de.programs;var xe=new n.WebGLBufferRenderer(b,he,ce),Ee=new n.WebGLIndexedBufferRenderer(b,he,ce);function Re(){return w===null?O:1}function Me(v,_,L,V){c===!0&&(v*=V,_*=V,L*=V),J.clearColor(v,_,L,V)}function Ae(){J.init(),J.scissor(P.copy(G).multiplyScalar(O)),J.viewport(F.copy(Z).multiplyScalar(O)),Me(W.r,W.g,W.b,I)}function Le(){M=null,C=null,U="",S=-1,J.reset()}Ae(),this.context=b,this.capabilities=pe,this.extensions=he,this.properties=fe,this.state=J;var Se=new n.WebGLShadowMap(this,K,le);this.shadowMap=Se;var Ge=new n.SpritePlugin(this,y),Ve=new n.LensFlarePlugin(this,g);this.getContext=function(){return b},this.getContextAttributes=function(){return b.getContextAttributes()},this.forceContextLoss=function(){he.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){var v;return function(){if(v!==void 0)return v;var L=he.get("EXT_texture_filter_anisotropic");return L!==null?v=b.getParameter(L.MAX_TEXTURE_MAX_ANISOTROPY_EXT):v=0,v}}(),this.getPrecision=function(){return pe.precision},this.getPixelRatio=function(){return O},this.setPixelRatio=function(v){v!==void 0&&(O=v,this.setSize(Z.z,Z.w,!1))},this.getSize=function(){return{width:k,height:T}},this.setSize=function(v,_,L){k=v,T=_,t.width=v*O,t.height=_*O,L!==!1&&(t.style.width=v+"px",t.style.height=_+"px"),this.setViewport(0,0,v,_)},this.setViewport=function(v,_,L,V){J.viewport(Z.set(v,_,L,V))},this.setScissor=function(v,_,L,V){J.scissor(G.set(v,_,L,V))},this.setScissorTest=function(v){J.setScissorTest(j=v)},this.getClearColor=function(){return W},this.setClearColor=function(v,_){W.set(v),I=_!==void 0?_:1,Me(W.r,W.g,W.b,I)},this.getClearAlpha=function(){return I},this.setClearAlpha=function(v){I=v,Me(W.r,W.g,W.b,I)},this.clear=function(v,_,L){var V=0;(v===void 0||v)&&(V|=b.COLOR_BUFFER_BIT),(_===void 0||_)&&(V|=b.DEPTH_BUFFER_BIT),(L===void 0||L)&&(V|=b.STENCIL_BUFFER_BIT),b.clear(V)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(v,_,L,V){this.setRenderTarget(v),this.clear(_,L,V)},this.resetGLState=Le,this.dispose=function(){t.removeEventListener("webglcontextlost",ze,!1)};function ze(v){v.preventDefault(),Le(),Ae(),fe.clear()}function Oe(v){var _=v.target;_.removeEventListener("dispose",Oe),Je(_),ie.textures--}function ke(v){var _=v.target;_.removeEventListener("dispose",ke),$e(_),ie.textures--}function He(v){var _=v.target;_.removeEventListener("dispose",He),je(_)}function Je(v){var _=fe.get(v);if(v.image&&_.__image__webglTextureCube)b.deleteTexture(_.__image__webglTextureCube);else{if(_.__webglInit===void 0)return;b.deleteTexture(_.__webglTexture)}fe.delete(v)}function $e(v){var _=fe.get(v),L=fe.get(v.texture);if(v){if(L.__webglTexture!==void 0&&b.deleteTexture(L.__webglTexture),v.depthTexture&&v.depthTexture.dispose(),v instanceof n.WebGLRenderTargetCube)for(var V=0;V<6;V++)b.deleteFramebuffer(_.__webglFramebuffer[V]),_.__webglDepthbuffer&&b.deleteRenderbuffer(_.__webglDepthbuffer[V]);else b.deleteFramebuffer(_.__webglFramebuffer),_.__webglDepthbuffer&&b.deleteRenderbuffer(_.__webglDepthbuffer);fe.delete(v.texture),fe.delete(v)}}function je(v){We(v),fe.delete(v)}function We(v){var _=fe.get(v).program;v.program=void 0,_!==void 0&&de.releaseProgram(_)}this.renderBufferImmediate=function(v,_,L){J.initAttributes();var V=fe.get(v);v.hasPositions&&!V.position&&(V.position=b.createBuffer()),v.hasNormals&&!V.normal&&(V.normal=b.createBuffer()),v.hasUvs&&!V.uv&&(V.uv=b.createBuffer()),v.hasColors&&!V.color&&(V.color=b.createBuffer());var z=_.getAttributes();if(v.hasPositions&&(b.bindBuffer(b.ARRAY_BUFFER,V.position),b.bufferData(b.ARRAY_BUFFER,v.positionArray,b.DYNAMIC_DRAW),J.enableAttribute(z.position),b.vertexAttribPointer(z.position,3,b.FLOAT,!1,0,0)),v.hasNormals){if(b.bindBuffer(b.ARRAY_BUFFER,V.normal),L.type!=="MeshPhongMaterial"&&L.type!=="MeshStandardMaterial"&&L.type!=="MeshPhysicalMaterial"&&L.shading===n.FlatShading)for(var $=0,re=v.count*3;$<re;$+=9){var ee=v.normalArray,ue=(ee[$+0]+ee[$+3]+ee[$+6])/3,oe=(ee[$+1]+ee[$+4]+ee[$+7])/3,ne=(ee[$+2]+ee[$+5]+ee[$+8])/3;ee[$+0]=ue,ee[$+1]=oe,ee[$+2]=ne,ee[$+3]=ue,ee[$+4]=oe,ee[$+5]=ne,ee[$+6]=ue,ee[$+7]=oe,ee[$+8]=ne}b.bufferData(b.ARRAY_BUFFER,v.normalArray,b.DYNAMIC_DRAW),J.enableAttribute(z.normal),b.vertexAttribPointer(z.normal,3,b.FLOAT,!1,0,0)}v.hasUvs&&L.map&&(b.bindBuffer(b.ARRAY_BUFFER,V.uv),b.bufferData(b.ARRAY_BUFFER,v.uvArray,b.DYNAMIC_DRAW),J.enableAttribute(z.uv),b.vertexAttribPointer(z.uv,2,b.FLOAT,!1,0,0)),v.hasColors&&L.vertexColors!==n.NoColors&&(b.bindBuffer(b.ARRAY_BUFFER,V.color),b.bufferData(b.ARRAY_BUFFER,v.colorArray,b.DYNAMIC_DRAW),J.enableAttribute(z.color),b.vertexAttribPointer(z.color,3,b.FLOAT,!1,0,0)),J.disableUnusedAttributes(),b.drawArrays(b.TRIANGLES,0,v.count),v.count=0},this.renderBufferDirect=function(v,_,L,V,z,$){ct(V);var re=ut(v,_,V,z),ee=!1,ue=L.id+"_"+re.id+"_"+V.wireframe;ue!==U&&(U=ue,ee=!0);var oe=z.morphTargetInfluences;if(oe!==void 0){for(var ne=[],te=0,ye=oe.length;te<ye;te++){var ve=oe[te];ne.push([ve,te])}ne.sort(wt),ne.length>8&&(ne.length=8);for(var we=L.morphAttributes,te=0,ye=ne.length;te<ye;te++){var ve=ne[te];if(m[te]=ve[0],ve[0]!==0){var Te=ve[1];V.morphTargets===!0&&we.position&&L.addAttribute("morphTarget"+te,we.position[Te]),V.morphNormals===!0&&we.normal&&L.addAttribute("morphNormal"+te,we.normal[Te])}else V.morphTargets===!0&&L.removeAttribute("morphTarget"+te),V.morphNormals===!0&&L.removeAttribute("morphNormal"+te)}re.getUniforms().setValue(b,"morphTargetInfluences",m),ee=!0}var Te=L.index,Pe=L.attributes.position;V.wireframe===!0&&(Te=le.getWireframeAttribute(L));var ae;Te!==null?(ae=Ee,ae.setIndex(Te)):ae=xe,ee&&(Ne(V,re,L),Te!==null&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,le.getAttributeBuffer(Te)));var Qe=0,Ue=1/0;Te!==null?Ue=Te.count:Pe!==void 0&&(Ue=Pe.count);var vt=L.drawRange.start,Zt=L.drawRange.count,gt=$!==null?$.start:0,Qt=$!==null?$.count:1/0,tt=Math.max(Qe,vt,gt),Kt=Math.min(Qe+Ue,vt+Zt,gt+Qt)-1,yt=Math.max(0,Kt-tt+1);if(z instanceof n.Mesh)if(V.wireframe===!0)J.setLineWidth(V.wireframeLinewidth*Re()),ae.setMode(b.LINES);else switch(z.drawMode){case n.TrianglesDrawMode:ae.setMode(b.TRIANGLES);break;case n.TriangleStripDrawMode:ae.setMode(b.TRIANGLE_STRIP);break;case n.TriangleFanDrawMode:ae.setMode(b.TRIANGLE_FAN);break}else if(z instanceof n.Line){var nt=V.linewidth;nt===void 0&&(nt=1),J.setLineWidth(nt*Re()),z instanceof n.LineSegments?ae.setMode(b.LINES):ae.setMode(b.LINE_STRIP)}else z instanceof n.Points&&ae.setMode(b.POINTS);L instanceof n.InstancedBufferGeometry?L.maxInstancedCount>0&&ae.renderInstances(L,tt,yt):ae.render(tt,yt)};function Ne(v,_,L,V){var z;if(L instanceof n.InstancedBufferGeometry&&(z=he.get("ANGLE_instanced_arrays"),z===null)){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}V===void 0&&(V=0),J.initAttributes();var $=L.attributes,re=_.getAttributes(),ee=v.defaultAttributeValues;for(var ue in re){var oe=re[ue];if(oe>=0){var ne=$[ue];if(ne!==void 0){var te=b.FLOAT,ye=ne.array,ve=ne.normalized;ye instanceof Float32Array?te=b.FLOAT:ye instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):ye instanceof Uint16Array?te=b.UNSIGNED_SHORT:ye instanceof Int16Array?te=b.SHORT:ye instanceof Uint32Array?te=b.UNSIGNED_INT:ye instanceof Int32Array?te=b.INT:ye instanceof Int8Array?te=b.BYTE:ye instanceof Uint8Array&&(te=b.UNSIGNED_BYTE);var we=ne.itemSize,Te=le.getAttributeBuffer(ne);if(ne instanceof n.InterleavedBufferAttribute){var Pe=ne.data,ae=Pe.stride,Qe=ne.offset;Pe instanceof n.InstancedInterleavedBuffer?(J.enableAttributeAndDivisor(oe,Pe.meshPerAttribute,z),L.maxInstancedCount===void 0&&(L.maxInstancedCount=Pe.meshPerAttribute*Pe.count)):J.enableAttribute(oe),b.bindBuffer(b.ARRAY_BUFFER,Te),b.vertexAttribPointer(oe,we,te,ve,ae*Pe.array.BYTES_PER_ELEMENT,(V*ae+Qe)*Pe.array.BYTES_PER_ELEMENT)}else ne instanceof n.InstancedBufferAttribute?(J.enableAttributeAndDivisor(oe,ne.meshPerAttribute,z),L.maxInstancedCount===void 0&&(L.maxInstancedCount=ne.meshPerAttribute*ne.count)):J.enableAttribute(oe),b.bindBuffer(b.ARRAY_BUFFER,Te),b.vertexAttribPointer(oe,we,te,ve,0,V*we*ne.array.BYTES_PER_ELEMENT)}else if(ee!==void 0){var Ue=ee[ue];if(Ue!==void 0)switch(Ue.length){case 2:b.vertexAttrib2fv(oe,Ue);break;case 3:b.vertexAttrib3fv(oe,Ue);break;case 4:b.vertexAttrib4fv(oe,Ue);break;default:b.vertexAttrib1fv(oe,Ue)}}}}J.disableUnusedAttributes()}function wt(v,_){return Math.abs(_[0])-Math.abs(v[0])}function bt(v,_){return v.object.renderOrder!==_.object.renderOrder?v.object.renderOrder-_.object.renderOrder:v.material.id!==_.material.id?v.material.id-_.material.id:v.z!==_.z?v.z-_.z:v.id-_.id}function Et(v,_){return v.object.renderOrder!==_.object.renderOrder?v.object.renderOrder-_.object.renderOrder:v.z!==_.z?_.z-v.z:v.id-_.id}this.render=function(v,_,L,V){if(!(_ instanceof n.Camera)){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var z=v.fog;if(U="",S=-1,C=null,v.autoUpdate===!0&&v.updateMatrixWorld(),_.parent===null&&_.updateMatrixWorld(),_.matrixWorldInverse.getInverse(_.matrixWorld),Y.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),Q.setFromMatrix(Y),h.length=0,f=-1,p=-1,y.length=0,g.length=0,D=this.localClippingEnabled,A=R.init(this.clippingPlanes,D,_),st(v,_),l.length=f+1,d.length=p+1,x.sortObjects===!0&&(l.sort(bt),d.sort(Et)),A&&R.beginShadows(),It(h),Se.render(v,_),Gt(h,_),A&&R.endShadows(),ce.calls=0,ce.vertices=0,ce.faces=0,ce.points=0,L===void 0&&(L=null),this.setRenderTarget(L),(this.autoClear||V)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),v.overrideMaterial){var $=v.overrideMaterial;Ye(l,_,z,$),Ye(d,_,z,$)}else J.setBlending(n.NoBlending),Ye(l,_,z),Ye(d,_,z);if(Ge.render(v,_),Ve.render(v,_,F),L){var re=L.texture;re.generateMipmaps&&Ze(L)&&re.minFilter!==n.NearestFilter&&re.minFilter!==n.LinearFilter&&qt(L)}J.setDepthTest(!0),J.setDepthWrite(!0),J.setColorWrite(!0)};function et(v,_,L,V,z){var $,re;L.transparent?($=d,re=++p):($=l,re=++f);var ee=$[re];ee!==void 0?(ee.id=v.id,ee.object=v,ee.geometry=_,ee.material=L,ee.z=X.z,ee.group=z):(ee={id:v.id,object:v,geometry:_,material:L,z:X.z,group:z},$.push(ee))}function St(v){var _=v.geometry;return _.boundingSphere===null&&_.computeBoundingSphere(),H.copy(_.boundingSphere).applyMatrix4(v.matrixWorld),ot(H)}function Tt(v){return H.center.set(0,0,0),H.radius=.7071067811865476,H.applyMatrix4(v.matrixWorld),ot(H)}function ot(v){if(!Q.intersectsSphere(v))return!1;var _=R.numPlanes;if(_===0)return!0;var L=x.clippingPlanes,V=v.center,z=-v.radius,$=0;do if(L[$].distanceToPoint(V)<z)return!1;while(++$!==_);return!0}function st(v,_){if(v.visible!==!1){if(v.layers.test(_.layers)){if(v instanceof n.Light)h.push(v);else if(v instanceof n.Sprite)(v.frustumCulled===!1||Tt(v)===!0)&&y.push(v);else if(v instanceof n.LensFlare)g.push(v);else if(v instanceof n.ImmediateRenderObject)x.sortObjects===!0&&(X.setFromMatrixPosition(v.matrixWorld),X.applyProjection(Y)),et(v,null,v.material,X.z,null);else if((v instanceof n.Mesh||v instanceof n.Line||v instanceof n.Points)&&(v instanceof n.SkinnedMesh&&v.skeleton.update(),v.frustumCulled===!1||St(v)===!0)){var L=v.material;if(L.visible===!0){x.sortObjects===!0&&(X.setFromMatrixPosition(v.matrixWorld),X.applyProjection(Y));var V=le.update(v);if(L instanceof n.MultiMaterial)for(var z=V.groups,$=L.materials,re=0,ee=z.length;re<ee;re++){var ue=z[re],oe=$[ue.materialIndex];oe.visible===!0&&et(v,V,oe,X.z,ue)}else et(v,V,L,X.z,null)}}}for(var ne=v.children,re=0,ee=ne.length;re<ee;re++)st(ne[re],_)}}function Ye(v,_,L,V){for(var z=0,$=v.length;z<$;z++){var re=v[z],ee=re.object,ue=re.geometry,oe=V===void 0?re.material:V,ne=re.group;if(ee.modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,ee.matrixWorld),ee.normalMatrix.getNormalMatrix(ee.modelViewMatrix),ee instanceof n.ImmediateRenderObject){ct(oe);var te=ut(_,L,oe,ee);U="",ee.render(function(ye){x.renderBufferImmediate(ye,te,oe)})}else x.renderBufferDirect(_,L,ue,oe,ee,ne)}}function At(v,_,L){var V=fe.get(v),z=de.getParameters(v,K,_,R.numPlanes,L),$=de.getProgramCode(v,z),re=V.program,ee=!0;if(re===void 0)v.addEventListener("dispose",He);else if(re.code!==$)We(v);else{if(z.shaderID!==void 0)return;ee=!1}if(ee){if(z.shaderID){var ue=n.ShaderLib[z.shaderID];V.__webglShader={name:v.type,uniforms:n.UniformsUtils.clone(ue.uniforms),vertexShader:ue.vertexShader,fragmentShader:ue.fragmentShader}}else V.__webglShader={name:v.type,uniforms:v.uniforms,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader};v.__webglShader=V.__webglShader,re=de.acquireProgram(v,z,$),V.program=re,v.program=re}var oe=re.getAttributes();if(v.morphTargets){v.numSupportedMorphTargets=0;for(var ne=0;ne<x.maxMorphTargets;ne++)oe["morphTarget"+ne]>=0&&v.numSupportedMorphTargets++}if(v.morphNormals){v.numSupportedMorphNormals=0;for(var ne=0;ne<x.maxMorphNormals;ne++)oe["morphNormal"+ne]>=0&&v.numSupportedMorphNormals++}var te=V.__webglShader.uniforms;(!(v instanceof n.ShaderMaterial)&&!(v instanceof n.RawShaderMaterial)||v.clipping===!0)&&(V.numClippingPlanes=R.numPlanes,te.clippingPlanes=R.uniform),v.lights&&(V.lightsHash=K.hash,te.ambientLightColor.value=K.ambient,te.directionalLights.value=K.directional,te.spotLights.value=K.spot,te.pointLights.value=K.point,te.hemisphereLights.value=K.hemi,te.directionalShadowMap.value=K.directionalShadowMap,te.directionalShadowMatrix.value=K.directionalShadowMatrix,te.spotShadowMap.value=K.spotShadowMap,te.spotShadowMatrix.value=K.spotShadowMatrix,te.pointShadowMap.value=K.pointShadowMap,te.pointShadowMatrix.value=K.pointShadowMatrix);var ye=V.program.getUniforms(),ve=n.WebGLUniforms.seqWithValue(ye.seq,te);V.uniformsList=ve,V.dynamicUniforms=n.WebGLUniforms.splitDynamic(ve,te)}function ct(v){v.side!==n.DoubleSide?J.enable(b.CULL_FACE):J.disable(b.CULL_FACE),J.setFlipSided(v.side===n.BackSide),v.transparent===!0?J.setBlending(v.blending,v.blendEquation,v.blendSrc,v.blendDst,v.blendEquationAlpha,v.blendSrcAlpha,v.blendDstAlpha,v.premultipliedAlpha):J.setBlending(n.NoBlending),J.setDepthFunc(v.depthFunc),J.setDepthTest(v.depthTest),J.setDepthWrite(v.depthWrite),J.setColorWrite(v.colorWrite),J.setPolygonOffset(v.polygonOffset,v.polygonOffsetFactor,v.polygonOffsetUnits)}function ut(v,_,L,V){N=0;var z=fe.get(L);if(A){if(D||v!==C){var $=v===C&&L.id===S;R.setState(L.clippingPlanes,L.clipShadows,v,z,$)}z.numClippingPlanes!==void 0&&z.numClippingPlanes!==R.numPlanes&&(L.needsUpdate=!0)}z.program===void 0&&(L.needsUpdate=!0),z.lightsHash!==void 0&&z.lightsHash!==K.hash&&(L.needsUpdate=!0),L.needsUpdate&&(At(L,_,V),L.needsUpdate=!1);var re=!1,ee=!1,ue=!1,oe=z.program,ne=oe.getUniforms(),te=z.__webglShader.uniforms;if(oe.id!==M&&(b.useProgram(oe.program),M=oe.id,re=!0,ee=!0,ue=!0),L.id!==S&&(S=L.id,ee=!0),re||v!==C){if(ne.set(b,v,"projectionMatrix"),pe.logarithmicDepthBuffer&&ne.setValue(b,"logDepthBufFC",2/(Math.log(v.far+1)/Math.LN2)),v!==C&&(C=v,ee=!0,ue=!0),L instanceof n.ShaderMaterial||L instanceof n.MeshPhongMaterial||L instanceof n.MeshStandardMaterial||L.envMap){var ye=ne.map.cameraPosition;ye!==void 0&&ye.setValue(b,X.setFromMatrixPosition(v.matrixWorld))}(L instanceof n.MeshPhongMaterial||L instanceof n.MeshLambertMaterial||L instanceof n.MeshBasicMaterial||L instanceof n.MeshStandardMaterial||L instanceof n.ShaderMaterial||L.skinning)&&ne.setValue(b,"viewMatrix",v.matrixWorldInverse),ne.set(b,x,"toneMappingExposure"),ne.set(b,x,"toneMappingWhitePoint")}if(L.skinning){ne.setOptional(b,V,"bindMatrix"),ne.setOptional(b,V,"bindMatrixInverse");var ve=V.skeleton;ve&&(pe.floatVertexTextures&&ve.useVertexTexture?(ne.set(b,ve,"boneTexture"),ne.set(b,ve,"boneTextureWidth"),ne.set(b,ve,"boneTextureHeight")):ne.setOptional(b,ve,"boneMatrices"))}ee&&(L.lights&&Ut(te,ue),_&&L.fog&&Pt(te,_),(L instanceof n.MeshBasicMaterial||L instanceof n.MeshLambertMaterial||L instanceof n.MeshPhongMaterial||L instanceof n.MeshStandardMaterial||L instanceof n.MeshDepthMaterial)&&Lt(te,L),L instanceof n.LineBasicMaterial?ht(te,L):L instanceof n.LineDashedMaterial?(ht(te,L),Ct(te,L)):L instanceof n.PointsMaterial?Rt(te,L):L instanceof n.MeshLambertMaterial?Ft(te,L):L instanceof n.MeshPhongMaterial?Bt(te,L):L instanceof n.MeshPhysicalMaterial?Dt(te,L):L instanceof n.MeshStandardMaterial?lt(te,L):L instanceof n.MeshDepthMaterial?L.displacementMap&&(te.displacementMap.value=L.displacementMap,te.displacementScale.value=L.displacementScale,te.displacementBias.value=L.displacementBias):L instanceof n.MeshNormalMaterial&&(te.opacity.value=L.opacity),n.WebGLUniforms.upload(b,z.uniformsList,te,x)),ne.set(b,V,"modelViewMatrix"),ne.set(b,V,"normalMatrix"),ne.setValue(b,"modelMatrix",V.matrixWorld);var we=z.dynamicUniforms;return we!==null&&(n.WebGLUniforms.evalDynamic(we,te,V,v),n.WebGLUniforms.upload(b,we,te,x)),oe}function Lt(v,_){v.opacity.value=_.opacity,v.diffuse.value=_.color,_.emissive&&v.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),v.map.value=_.map,v.specularMap.value=_.specularMap,v.alphaMap.value=_.alphaMap,_.aoMap&&(v.aoMap.value=_.aoMap,v.aoMapIntensity.value=_.aoMapIntensity);var L;if(_.map?L=_.map:_.specularMap?L=_.specularMap:_.displacementMap?L=_.displacementMap:_.normalMap?L=_.normalMap:_.bumpMap?L=_.bumpMap:_.roughnessMap?L=_.roughnessMap:_.metalnessMap?L=_.metalnessMap:_.alphaMap?L=_.alphaMap:_.emissiveMap&&(L=_.emissiveMap),L!==void 0){L instanceof n.WebGLRenderTarget&&(L=L.texture);var V=L.offset,z=L.repeat;v.offsetRepeat.value.set(V.x,V.y,z.x,z.y)}v.envMap.value=_.envMap,v.flipEnvMap.value=_.envMap instanceof n.CubeTexture?-1:1,v.reflectivity.value=_.reflectivity,v.refractionRatio.value=_.refractionRatio}function ht(v,_){v.diffuse.value=_.color,v.opacity.value=_.opacity}function Ct(v,_){v.dashSize.value=_.dashSize,v.totalSize.value=_.dashSize+_.gapSize,v.scale.value=_.scale}function Rt(v,_){if(v.diffuse.value=_.color,v.opacity.value=_.opacity,v.size.value=_.size*O,v.scale.value=t.clientHeight*.5,v.map.value=_.map,_.map!==null){var L=_.map.offset,V=_.map.repeat;v.offsetRepeat.value.set(L.x,L.y,V.x,V.y)}}function Pt(v,_){v.fogColor.value=_.color,_ instanceof n.Fog?(v.fogNear.value=_.near,v.fogFar.value=_.far):_ instanceof n.FogExp2&&(v.fogDensity.value=_.density)}function Ft(v,_){_.lightMap&&(v.lightMap.value=_.lightMap,v.lightMapIntensity.value=_.lightMapIntensity),_.emissiveMap&&(v.emissiveMap.value=_.emissiveMap)}function Bt(v,_){v.specular.value=_.specular,v.shininess.value=Math.max(_.shininess,1e-4),_.lightMap&&(v.lightMap.value=_.lightMap,v.lightMapIntensity.value=_.lightMapIntensity),_.emissiveMap&&(v.emissiveMap.value=_.emissiveMap),_.bumpMap&&(v.bumpMap.value=_.bumpMap,v.bumpScale.value=_.bumpScale),_.normalMap&&(v.normalMap.value=_.normalMap,v.normalScale.value.copy(_.normalScale)),_.displacementMap&&(v.displacementMap.value=_.displacementMap,v.displacementScale.value=_.displacementScale,v.displacementBias.value=_.displacementBias)}function lt(v,_){v.roughness.value=_.roughness,v.metalness.value=_.metalness,_.roughnessMap&&(v.roughnessMap.value=_.roughnessMap),_.metalnessMap&&(v.metalnessMap.value=_.metalnessMap),_.lightMap&&(v.lightMap.value=_.lightMap,v.lightMapIntensity.value=_.lightMapIntensity),_.emissiveMap&&(v.emissiveMap.value=_.emissiveMap),_.bumpMap&&(v.bumpMap.value=_.bumpMap,v.bumpScale.value=_.bumpScale),_.normalMap&&(v.normalMap.value=_.normalMap,v.normalScale.value.copy(_.normalScale)),_.displacementMap&&(v.displacementMap.value=_.displacementMap,v.displacementScale.value=_.displacementScale,v.displacementBias.value=_.displacementBias),_.envMap&&(v.envMapIntensity.value=_.envMapIntensity)}function Dt(v,_){lt(v,_)}function Ut(v,_){v.ambientLightColor.needsUpdate=_,v.directionalLights.needsUpdate=_,v.pointLights.needsUpdate=_,v.spotLights.needsUpdate=_,v.hemisphereLights.needsUpdate=_}function It(v){for(var _=0,L=0,V=v.length;L<V;L++){var z=v[L];z.castShadow&&(K.shadows[_++]=z)}K.shadows.length=_}function Gt(v,_){var L,V,z,$=0,re=0,ee=0,ue,oe,ne,te,ye=_.matrixWorldInverse,ve=0,we=0,Te=0,Pe=0;for(L=0,V=v.length;L<V;L++)if(z=v[L],ue=z.color,oe=z.intensity,ne=z.distance,te=z.shadow&&z.shadow.map?z.shadow.map.texture:null,z instanceof n.AmbientLight)$+=ue.r*oe,re+=ue.g*oe,ee+=ue.b*oe;else if(z instanceof n.DirectionalLight){var ae=ge.get(z);ae.color.copy(z.color).multiplyScalar(z.intensity),ae.direction.setFromMatrixPosition(z.matrixWorld),X.setFromMatrixPosition(z.target.matrixWorld),ae.direction.sub(X),ae.direction.transformDirection(ye),ae.shadow=z.castShadow,z.castShadow&&(ae.shadowBias=z.shadow.bias,ae.shadowRadius=z.shadow.radius,ae.shadowMapSize=z.shadow.mapSize),K.directionalShadowMap[ve]=te,K.directionalShadowMatrix[ve]=z.shadow.matrix,K.directional[ve++]=ae}else if(z instanceof n.SpotLight){var ae=ge.get(z);ae.position.setFromMatrixPosition(z.matrixWorld),ae.position.applyMatrix4(ye),ae.color.copy(ue).multiplyScalar(oe),ae.distance=ne,ae.direction.setFromMatrixPosition(z.matrixWorld),X.setFromMatrixPosition(z.target.matrixWorld),ae.direction.sub(X),ae.direction.transformDirection(ye),ae.coneCos=Math.cos(z.angle),ae.penumbraCos=Math.cos(z.angle*(1-z.penumbra)),ae.decay=z.distance===0?0:z.decay,ae.shadow=z.castShadow,z.castShadow&&(ae.shadowBias=z.shadow.bias,ae.shadowRadius=z.shadow.radius,ae.shadowMapSize=z.shadow.mapSize),K.spotShadowMap[Te]=te,K.spotShadowMatrix[Te]=z.shadow.matrix,K.spot[Te++]=ae}else if(z instanceof n.PointLight){var ae=ge.get(z);ae.position.setFromMatrixPosition(z.matrixWorld),ae.position.applyMatrix4(ye),ae.color.copy(z.color).multiplyScalar(z.intensity),ae.distance=z.distance,ae.decay=z.distance===0?0:z.decay,ae.shadow=z.castShadow,z.castShadow&&(ae.shadowBias=z.shadow.bias,ae.shadowRadius=z.shadow.radius,ae.shadowMapSize=z.shadow.mapSize),K.pointShadowMap[we]=te,K.pointShadowMatrix[we]===void 0&&(K.pointShadowMatrix[we]=new n.Matrix4),X.setFromMatrixPosition(z.matrixWorld).negate(),K.pointShadowMatrix[we].identity().setPosition(X),K.point[we++]=ae}else if(z instanceof n.HemisphereLight){var ae=ge.get(z);ae.direction.setFromMatrixPosition(z.matrixWorld),ae.direction.transformDirection(ye),ae.direction.normalize(),ae.skyColor.copy(z.color).multiplyScalar(oe),ae.groundColor.copy(z.groundColor).multiplyScalar(oe),K.hemi[Pe++]=ae}K.ambient[0]=$,K.ambient[1]=re,K.ambient[2]=ee,K.directional.length=ve,K.spot.length=Te,K.point.length=we,K.hemi.length=Pe,K.hash=ve+","+we+","+Te+","+Pe+","+K.shadows.length}this.setFaceCulling=function(v,_){J.setCullFace(v),J.setFlipSided(_===n.FrontFaceDirectionCW)};function Ot(){var v=N;return v>=pe.maxTextures&&console.warn("WebGLRenderer: trying to use "+v+" texture units while this GPU supports only "+pe.maxTextures),N+=1,v}function qe(v,_,L){var V;if(L?(b.texParameteri(v,b.TEXTURE_WRAP_S,Ce(_.wrapS)),b.texParameteri(v,b.TEXTURE_WRAP_T,Ce(_.wrapT)),b.texParameteri(v,b.TEXTURE_MAG_FILTER,Ce(_.magFilter)),b.texParameteri(v,b.TEXTURE_MIN_FILTER,Ce(_.minFilter))):(b.texParameteri(v,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(v,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),(_.wrapS!==n.ClampToEdgeWrapping||_.wrapT!==n.ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",_),b.texParameteri(v,b.TEXTURE_MAG_FILTER,mt(_.magFilter)),b.texParameteri(v,b.TEXTURE_MIN_FILTER,mt(_.minFilter)),_.minFilter!==n.NearestFilter&&_.minFilter!==n.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",_)),V=he.get("EXT_texture_filter_anisotropic"),V){if(_.type===n.FloatType&&he.get("OES_texture_float_linear")===null||_.type===n.HalfFloatType&&he.get("OES_texture_half_float_linear")===null)return;(_.anisotropy>1||fe.get(_).__currentAnisotropy)&&(b.texParameterf(v,V.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(_.anisotropy,x.getMaxAnisotropy())),fe.get(_).__currentAnisotropy=_.anisotropy)}}function Nt(v,_,L){v.__webglInit===void 0&&(v.__webglInit=!0,_.addEventListener("dispose",Oe),v.__webglTexture=b.createTexture(),ie.textures++),J.activeTexture(b.TEXTURE0+L),J.bindTexture(b.TEXTURE_2D,v.__webglTexture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,_.flipY),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_.premultiplyAlpha),b.pixelStorei(b.UNPACK_ALIGNMENT,_.unpackAlignment);var V=ft(_.image,pe.maxTextureSize);zt(_)&&Ze(V)===!1&&(V=kt(V));var z=Ze(V),$=Ce(_.format),re=Ce(_.type);qe(b.TEXTURE_2D,_,z);var ee,ue=_.mipmaps;if(_ instanceof n.DepthTexture){var oe=b.DEPTH_COMPONENT;if(_.type===n.FloatType){if(!_e)throw new Error("Float Depth Texture only supported in WebGL2.0");oe=b.DEPTH_COMPONENT32F}else _e&&(oe=b.DEPTH_COMPONENT16);J.texImage2D(b.TEXTURE_2D,0,oe,V.width,V.height,0,$,re,null)}else if(_ instanceof n.DataTexture)if(ue.length>0&&z){for(var ne=0,te=ue.length;ne<te;ne++)ee=ue[ne],J.texImage2D(b.TEXTURE_2D,ne,$,ee.width,ee.height,0,$,re,ee.data);_.generateMipmaps=!1}else J.texImage2D(b.TEXTURE_2D,0,$,V.width,V.height,0,$,re,V.data);else if(_ instanceof n.CompressedTexture)for(var ne=0,te=ue.length;ne<te;ne++)ee=ue[ne],_.format!==n.RGBAFormat&&_.format!==n.RGBFormat?J.getCompressedTextureFormats().indexOf($)>-1?J.compressedTexImage2D(b.TEXTURE_2D,ne,$,ee.width,ee.height,0,ee.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):J.texImage2D(b.TEXTURE_2D,ne,$,ee.width,ee.height,0,$,re,ee.data);else if(ue.length>0&&z){for(var ne=0,te=ue.length;ne<te;ne++)ee=ue[ne],J.texImage2D(b.TEXTURE_2D,ne,$,$,re,ee);_.generateMipmaps=!1}else J.texImage2D(b.TEXTURE_2D,0,$,$,re,V);_.generateMipmaps&&z&&b.generateMipmap(b.TEXTURE_2D),v.__version=_.version,_.onUpdate&&_.onUpdate(_)}function Vt(v,_){var L=fe.get(v);if(v.version>0&&L.__version!==v.version){var V=v.image;if(V===void 0){console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",v);return}if(V.complete===!1){console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",v);return}Nt(L,v,_);return}J.activeTexture(b.TEXTURE0+_),J.bindTexture(b.TEXTURE_2D,L.__webglTexture)}function ft(v,_){if(v.width>_||v.height>_){var L=_/Math.max(v.width,v.height),V=document.createElement("canvas");V.width=Math.floor(v.width*L),V.height=Math.floor(v.height*L);var z=V.getContext("2d");return z.drawImage(v,0,0,v.width,v.height,0,0,V.width,V.height),console.warn("THREE.WebGLRenderer: image is too big ("+v.width+"x"+v.height+"). Resized to "+V.width+"x"+V.height,v),V}return v}function Ze(v){return n.Math.isPowerOfTwo(v.width)&&n.Math.isPowerOfTwo(v.height)}function zt(v){return v.wrapS!==n.ClampToEdgeWrapping||v.wrapT!==n.ClampToEdgeWrapping||v.minFilter!==n.NearestFilter&&v.minFilter!==n.LinearFilter}function kt(v){if(v instanceof HTMLImageElement||v instanceof HTMLCanvasElement){var _=document.createElement("canvas");_.width=n.Math.nearestPowerOfTwo(v.width),_.height=n.Math.nearestPowerOfTwo(v.height);var L=_.getContext("2d");return L.drawImage(v,0,0,_.width,_.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+v.width+"x"+v.height+"). Resized to "+_.width+"x"+_.height,v),_}return v}function Ht(v,_){var L=fe.get(v);if(v.image.length===6)if(v.version>0&&L.__version!==v.version){L.__image__webglTextureCube||(v.addEventListener("dispose",Oe),L.__image__webglTextureCube=b.createTexture(),ie.textures++),J.activeTexture(b.TEXTURE0+_),J.bindTexture(b.TEXTURE_CUBE_MAP,L.__image__webglTextureCube),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,v.flipY);for(var V=v instanceof n.CompressedTexture,z=v.image[0]instanceof n.DataTexture,$=[],re=0;re<6;re++)x.autoScaleCubemaps&&!V&&!z?$[re]=ft(v.image[re],pe.maxCubemapSize):$[re]=z?v.image[re].image:v.image[re];var ee=$[0],ue=Ze(ee),oe=Ce(v.format),ne=Ce(v.type);qe(b.TEXTURE_CUBE_MAP,v,ue);for(var re=0;re<6;re++)if(!V)z?J.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,oe,$[re].width,$[re].height,0,oe,ne,$[re].data):J.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,oe,oe,ne,$[re]);else for(var te,ye=$[re].mipmaps,ve=0,we=ye.length;ve<we;ve++)te=ye[ve],v.format!==n.RGBAFormat&&v.format!==n.RGBFormat?J.getCompressedTextureFormats().indexOf(oe)>-1?J.compressedTexImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+re,ve,oe,te.width,te.height,0,te.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):J.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+re,ve,oe,te.width,te.height,0,oe,ne,te.data);v.generateMipmaps&&ue&&b.generateMipmap(b.TEXTURE_CUBE_MAP),L.__version=v.version,v.onUpdate&&v.onUpdate(v)}else J.activeTexture(b.TEXTURE0+_),J.bindTexture(b.TEXTURE_CUBE_MAP,L.__image__webglTextureCube)}function Wt(v,_){J.activeTexture(b.TEXTURE0+_),J.bindTexture(b.TEXTURE_CUBE_MAP,fe.get(v).__webglTexture)}this.allocTextureUnit=Ot,this.setTexture2D=function(){var v=!1;return function(_,L){_ instanceof n.WebGLRenderTarget&&(v||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),v=!0),_=_.texture),Vt(_,L)}}(),this.setTexture=function(){var v=!1;return function(_,L){v||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),v=!0),x.setTexture2D(_,L)}}(),this.setTextureCube=function(){var v=!1;return function(_,L){_ instanceof n.WebGLRenderTargetCube&&(v||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),v=!0),_=_.texture),_ instanceof n.CubeTexture||Array.isArray(_.image)&&_.image.length===6?Ht(_,L):Wt(_,L)}}();function dt(v,_,L,V){var z=Ce(_.texture.format),$=Ce(_.texture.type);J.texImage2D(V,0,z,_.width,_.height,0,z,$,null),b.bindFramebuffer(b.FRAMEBUFFER,v),b.framebufferTexture2D(b.FRAMEBUFFER,L,V,fe.get(_.texture).__webglTexture,0),b.bindFramebuffer(b.FRAMEBUFFER,null)}function pt(v,_){b.bindRenderbuffer(b.RENDERBUFFER,v),_.depthBuffer&&!_.stencilBuffer?(b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,_.width,_.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,v)):_.depthBuffer&&_.stencilBuffer?(b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,_.width,_.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,v)):b.renderbufferStorage(b.RENDERBUFFER,b.RGBA4,_.width,_.height),b.bindRenderbuffer(b.RENDERBUFFER,null)}function Xt(v,_){var L=_ instanceof n.WebGLRenderTargetCube;if(L)throw new Error("Depth Texture with cube render targets is not supported!");if(b.bindFramebuffer(b.FRAMEBUFFER,v),!(_.depthTexture instanceof n.DepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!fe.get(_.depthTexture).__webglTexture||_.depthTexture.image.width!==_.width||_.depthTexture.image.height!==_.height)&&(_.depthTexture.image.width=_.width,_.depthTexture.image.height=_.height,_.depthTexture.needsUpdate=!0),x.setTexture2D(_.depthTexture,0);var V=fe.get(_.depthTexture).__webglTexture;b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.TEXTURE_2D,V,0)}function jt(v){var _=fe.get(v),L=v instanceof n.WebGLRenderTargetCube;if(v.depthTexture){if(L)throw new Error("target.depthTexture not supported in Cube render targets");Xt(_.__webglFramebuffer,v)}else if(L){_.__webglDepthbuffer=[];for(var V=0;V<6;V++)b.bindFramebuffer(b.FRAMEBUFFER,_.__webglFramebuffer[V]),_.__webglDepthbuffer[V]=b.createRenderbuffer(),pt(_.__webglDepthbuffer[V],v)}else b.bindFramebuffer(b.FRAMEBUFFER,_.__webglFramebuffer),_.__webglDepthbuffer=b.createRenderbuffer(),pt(_.__webglDepthbuffer,v);b.bindFramebuffer(b.FRAMEBUFFER,null)}function Yt(v){var _=fe.get(v),L=fe.get(v.texture);v.addEventListener("dispose",ke),L.__webglTexture=b.createTexture(),ie.textures++;var V=v instanceof n.WebGLRenderTargetCube,z=n.Math.isPowerOfTwo(v.width)&&n.Math.isPowerOfTwo(v.height);if(V){_.__webglFramebuffer=[];for(var $=0;$<6;$++)_.__webglFramebuffer[$]=b.createFramebuffer()}else _.__webglFramebuffer=b.createFramebuffer();if(V){J.bindTexture(b.TEXTURE_CUBE_MAP,L.__webglTexture),qe(b.TEXTURE_CUBE_MAP,v.texture,z);for(var $=0;$<6;$++)dt(_.__webglFramebuffer[$],v,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+$);v.texture.generateMipmaps&&z&&b.generateMipmap(b.TEXTURE_CUBE_MAP),J.bindTexture(b.TEXTURE_CUBE_MAP,null)}else J.bindTexture(b.TEXTURE_2D,L.__webglTexture),qe(b.TEXTURE_2D,v.texture,z),dt(_.__webglFramebuffer,v,b.COLOR_ATTACHMENT0,b.TEXTURE_2D),v.texture.generateMipmaps&&z&&b.generateMipmap(b.TEXTURE_2D),J.bindTexture(b.TEXTURE_2D,null);v.depthBuffer&&jt(v)}this.getCurrentRenderTarget=function(){return w},this.setRenderTarget=function(v){w=v,v&&fe.get(v).__webglFramebuffer===void 0&&Yt(v);var _=v instanceof n.WebGLRenderTargetCube,L;if(v){var V=fe.get(v);_?L=V.__webglFramebuffer[v.activeCubeFace]:L=V.__webglFramebuffer,P.copy(v.scissor),B=v.scissorTest,F.copy(v.viewport)}else L=null,P.copy(G).multiplyScalar(O),B=j,F.copy(Z).multiplyScalar(O);if(E!==L&&(b.bindFramebuffer(b.FRAMEBUFFER,L),E=L),J.scissor(P),J.setScissorTest(B),J.viewport(F),_){var z=fe.get(v.texture);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+v.activeCubeFace,z.__webglTexture,v.activeMipMapLevel)}},this.readRenderTargetPixels=function(v,_,L,V,z,$){if(!(v instanceof n.WebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var re=fe.get(v).__webglFramebuffer;if(re){var ee=!1;re!==E&&(b.bindFramebuffer(b.FRAMEBUFFER,re),ee=!0);try{var ue=v.texture;if(ue.format!==n.RGBAFormat&&Ce(ue.format)!==b.getParameter(b.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(ue.type!==n.UnsignedByteType&&Ce(ue.type)!==b.getParameter(b.IMPLEMENTATION_COLOR_READ_TYPE)&&!(ue.type===n.FloatType&&he.get("WEBGL_color_buffer_float"))&&!(ue.type===n.HalfFloatType&&he.get("EXT_color_buffer_half_float"))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}b.checkFramebufferStatus(b.FRAMEBUFFER)===b.FRAMEBUFFER_COMPLETE?_>=0&&_<=v.width-V&&L>=0&&L<=v.height-z&&b.readPixels(_,L,V,z,Ce(ue.format),Ce(ue.type),$):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{ee&&b.bindFramebuffer(b.FRAMEBUFFER,E)}}};function qt(v){var _=v instanceof n.WebGLRenderTargetCube?b.TEXTURE_CUBE_MAP:b.TEXTURE_2D,L=fe.get(v.texture).__webglTexture;J.bindTexture(_,L),b.generateMipmap(_),J.bindTexture(_,null)}function mt(v){return v===n.NearestFilter||v===n.NearestMipMapNearestFilter||v===n.NearestMipMapLinearFilter?b.NEAREST:b.LINEAR}function Ce(v){var _;if(v===n.RepeatWrapping)return b.REPEAT;if(v===n.ClampToEdgeWrapping)return b.CLAMP_TO_EDGE;if(v===n.MirroredRepeatWrapping)return b.MIRRORED_REPEAT;if(v===n.NearestFilter)return b.NEAREST;if(v===n.NearestMipMapNearestFilter)return b.NEAREST_MIPMAP_NEAREST;if(v===n.NearestMipMapLinearFilter)return b.NEAREST_MIPMAP_LINEAR;if(v===n.LinearFilter)return b.LINEAR;if(v===n.LinearMipMapNearestFilter)return b.LINEAR_MIPMAP_NEAREST;if(v===n.LinearMipMapLinearFilter)return b.LINEAR_MIPMAP_LINEAR;if(v===n.UnsignedByteType)return b.UNSIGNED_BYTE;if(v===n.UnsignedShort4444Type)return b.UNSIGNED_SHORT_4_4_4_4;if(v===n.UnsignedShort5551Type)return b.UNSIGNED_SHORT_5_5_5_1;if(v===n.UnsignedShort565Type)return b.UNSIGNED_SHORT_5_6_5;if(v===n.ByteType)return b.BYTE;if(v===n.ShortType)return b.SHORT;if(v===n.UnsignedShortType)return b.UNSIGNED_SHORT;if(v===n.IntType)return b.INT;if(v===n.UnsignedIntType)return b.UNSIGNED_INT;if(v===n.FloatType)return b.FLOAT;if(_=he.get("OES_texture_half_float"),_!==null&&v===n.HalfFloatType)return _.HALF_FLOAT_OES;if(v===n.AlphaFormat)return b.ALPHA;if(v===n.RGBFormat)return b.RGB;if(v===n.RGBAFormat)return b.RGBA;if(v===n.LuminanceFormat)return b.LUMINANCE;if(v===n.LuminanceAlphaFormat)return b.LUMINANCE_ALPHA;if(v===n.DepthFormat)return b.DEPTH_COMPONENT;if(v===n.AddEquation)return b.FUNC_ADD;if(v===n.SubtractEquation)return b.FUNC_SUBTRACT;if(v===n.ReverseSubtractEquation)return b.FUNC_REVERSE_SUBTRACT;if(v===n.ZeroFactor)return b.ZERO;if(v===n.OneFactor)return b.ONE;if(v===n.SrcColorFactor)return b.SRC_COLOR;if(v===n.OneMinusSrcColorFactor)return b.ONE_MINUS_SRC_COLOR;if(v===n.SrcAlphaFactor)return b.SRC_ALPHA;if(v===n.OneMinusSrcAlphaFactor)return b.ONE_MINUS_SRC_ALPHA;if(v===n.DstAlphaFactor)return b.DST_ALPHA;if(v===n.OneMinusDstAlphaFactor)return b.ONE_MINUS_DST_ALPHA;if(v===n.DstColorFactor)return b.DST_COLOR;if(v===n.OneMinusDstColorFactor)return b.ONE_MINUS_DST_COLOR;if(v===n.SrcAlphaSaturateFactor)return b.SRC_ALPHA_SATURATE;if(_=he.get("WEBGL_compressed_texture_s3tc"),_!==null){if(v===n.RGB_S3TC_DXT1_Format)return _.COMPRESSED_RGB_S3TC_DXT1_EXT;if(v===n.RGBA_S3TC_DXT1_Format)return _.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(v===n.RGBA_S3TC_DXT3_Format)return _.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(v===n.RGBA_S3TC_DXT5_Format)return _.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(_=he.get("WEBGL_compressed_texture_pvrtc"),_!==null){if(v===n.RGB_PVRTC_4BPPV1_Format)return _.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(v===n.RGB_PVRTC_2BPPV1_Format)return _.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(v===n.RGBA_PVRTC_4BPPV1_Format)return _.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(v===n.RGBA_PVRTC_2BPPV1_Format)return _.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(_=he.get("WEBGL_compressed_texture_etc1"),_!==null&&v===n.RGB_ETC1_Format)return _.COMPRESSED_RGB_ETC1_WEBGL;if(_=he.get("EXT_blend_minmax"),_!==null){if(v===n.MinEquation)return _.MIN_EXT;if(v===n.MaxEquation)return _.MAX_EXT}return 0}},n.WebGLRenderTarget=function(e,t,r){this.uuid=n.Math.generateUUID(),this.width=e,this.height=t,this.scissor=new n.Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new n.Vector4(0,0,e,t),r=r||{},r.minFilter===void 0&&(r.minFilter=n.LinearFilter),this.texture=new n.Texture(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!0,this.depthTexture=null},Object.assign(n.WebGLRenderTarget.prototype,n.EventDispatcher.prototype,{setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),n.WebGLRenderTargetCube=function(e,t,r){n.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0,this.activeMipMapLevel=0},n.WebGLRenderTargetCube.prototype=Object.create(n.WebGLRenderTarget.prototype),n.WebGLRenderTargetCube.prototype.constructor=n.WebGLRenderTargetCube,n.WebGLBufferRenderer=function(e,t,r){var i;function a(c){i=c}function o(c,u){e.drawArrays(i,c,u),r.calls++,r.vertices+=u,i===e.TRIANGLES&&(r.faces+=u/3)}function s(c){var u=t.get("ANGLE_instanced_arrays");if(u===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}var h=c.attributes.position,l=0;h instanceof n.InterleavedBufferAttribute?(l=h.data.count,u.drawArraysInstancedANGLE(i,0,l,c.maxInstancedCount)):(l=h.count,u.drawArraysInstancedANGLE(i,0,l,c.maxInstancedCount)),r.calls++,r.vertices+=l*c.maxInstancedCount,i===e.TRIANGLES&&(r.faces+=c.maxInstancedCount*l/3)}this.setMode=a,this.render=o,this.renderInstances=s},n.WebGLClipping=function(){var e=this,t=null,r=0,i=!1,a=!1,o=new n.Plane,s=new n.Matrix3,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.init=function(l,f,d){var p=l.length!==0||f||r!==0||i;return i=f,t=h(l,d,0),r=l.length,p},this.beginShadows=function(){a=!0,h(null)},this.endShadows=function(){a=!1,u()},this.setState=function(l,f,d,p,m){if(!i||l===null||l.length===0||a&&!f)a?h(null):u();else{var y=a?0:r,g=y*4,x=p.clippingState||null;c.value=x,x=h(l,d,g,m);for(var M=0;M!==g;++M)x[M]=t[M];p.clippingState=x,this.numPlanes+=y}};function u(){c.value!==t&&(c.value=t,c.needsUpdate=r>0),e.numPlanes=r}function h(l,f,d,p){var m=l!==null?l.length:0,y=null;if(m!==0){if(y=c.value,p!==!0||y===null){var g=d+m*4,x=f.matrixWorldInverse;s.getNormalMatrix(x),(y===null||y.length<g)&&(y=new Float32Array(g));for(var M=0,w=d;M!==m;++M,w+=4)o.copy(l[M]).applyMatrix4(x,s),o.normal.toArray(y,w),y[w+3]=o.constant}c.value=y,c.needsUpdate=!0}return e.numPlanes=m,y}},n.WebGLIndexedBufferRenderer=function(e,t,r){var i;function a(l){i=l}var o,s;function c(l){l.array instanceof Uint32Array&&t.get("OES_element_index_uint")?(o=e.UNSIGNED_INT,s=4):(o=e.UNSIGNED_SHORT,s=2)}function u(l,f){e.drawElements(i,f,o,l*s),r.calls++,r.vertices+=f,i===e.TRIANGLES&&(r.faces+=f/3)}function h(l,f,d){var p=t.get("ANGLE_instanced_arrays");if(p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p.drawElementsInstancedANGLE(i,d,o,f*s,l.maxInstancedCount),r.calls++,r.vertices+=d*l.maxInstancedCount,i===e.TRIANGLES&&(r.faces+=l.maxInstancedCount*d/3)}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h},n.WebGLExtensions=function(e){var t={};this.get=function(r){if(t[r]!==void 0)return t[r];var i;switch(r){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":i=e.getExtension("WEBGL_compressed_texture_etc1");break;default:i=e.getExtension(r)}return i===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=i,i}},n.WebGLCapabilities=function(e,t,r){function i(o){if(o==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";o="mediump"}return o==="mediump"&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}this.getMaxPrecision=i,this.precision=r.precision!==void 0?r.precision:"highp",this.logarithmicDepthBuffer=r.logarithmicDepthBuffer!==void 0?r.logarithmicDepthBuffer:!1,this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=e.getParameter(e.MAX_VARYING_VECTORS),this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=!!t.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var a=i(this.precision);a!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",a,"instead."),this.precision=a),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!t.get("EXT_frag_depth"))},n.WebGLGeometries=function(e,t,r){var i={};function a(l){var f=l.geometry;if(i[f.id]!==void 0)return i[f.id];f.addEventListener("dispose",o);var d;return f instanceof n.BufferGeometry?d=f:f instanceof n.Geometry&&(f._bufferGeometry===void 0&&(f._bufferGeometry=new n.BufferGeometry().setFromObject(l)),d=f._bufferGeometry),i[f.id]=d,r.memory.geometries++,d}function o(l){var f=l.target,d=i[f.id];d.index!==null&&c(d.index),u(d.attributes),f.removeEventListener("dispose",o),delete i[f.id];var p=t.get(f);p.wireframe&&c(p.wireframe),t.delete(f);var m=t.get(d);m.wireframe&&c(m.wireframe),t.delete(d),r.memory.geometries--}function s(l){return l instanceof n.InterleavedBufferAttribute?t.get(l.data).__webglBuffer:t.get(l).__webglBuffer}function c(l){var f=s(l);f!==void 0&&(e.deleteBuffer(f),h(l))}function u(l){for(var f in l)c(l[f])}function h(l){l instanceof n.InterleavedBufferAttribute?t.delete(l.data):t.delete(l)}this.get=a},n.WebGLLights=function(){var e={};this.get=function(t){if(e[t.id]!==void 0)return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new n.Vector3,color:new n.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n.Vector2};break;case"SpotLight":r={position:new n.Vector3,direction:new n.Vector3,color:new n.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n.Vector2};break;case"PointLight":r={position:new n.Vector3,color:new n.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n.Vector2};break;case"HemisphereLight":r={direction:new n.Vector3,skyColor:new n.Color,groundColor:new n.Color};break}return e[t.id]=r,r}},n.WebGLObjects=function(e,t,r){var i=new n.WebGLGeometries(e,t,r);function a(f){var d=i.get(f);f.geometry instanceof n.Geometry&&d.updateFromObject(f);var p=d.index,m=d.attributes;p!==null&&o(p,e.ELEMENT_ARRAY_BUFFER);for(var y in m)o(m[y],e.ARRAY_BUFFER);var g=d.morphAttributes;for(var y in g)for(var x=g[y],M=0,w=x.length;M<w;M++)o(x[M],e.ARRAY_BUFFER);return d}function o(f,d){var p=f instanceof n.InterleavedBufferAttribute?f.data:f,m=t.get(p);m.__webglBuffer===void 0?s(m,p,d):m.version!==p.version&&c(m,p,d)}function s(f,d,p){f.__webglBuffer=e.createBuffer(),e.bindBuffer(p,f.__webglBuffer);var m=d.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(p,d.array,m),f.version=d.version}function c(f,d,p){e.bindBuffer(p,f.__webglBuffer),d.dynamic===!1||d.updateRange.count===-1?e.bufferSubData(p,0,d.array):d.updateRange.count===0?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(p,d.updateRange.offset*d.array.BYTES_PER_ELEMENT,d.array.subarray(d.updateRange.offset,d.updateRange.offset+d.updateRange.count)),d.updateRange.count=0),f.version=d.version}function u(f){return f instanceof n.InterleavedBufferAttribute?t.get(f.data).__webglBuffer:t.get(f).__webglBuffer}function h(f){var d=t.get(f);if(d.wireframe!==void 0)return d.wireframe;var p=[],m=f.index,y=f.attributes,g=y.position;if(m!==null)for(var x={},M=m.array,w=0,E=M.length;w<E;w+=3){var S=M[w+0],U=M[w+1],C=M[w+2];l(x,S,U)&&p.push(S,U),l(x,U,C)&&p.push(U,C),l(x,C,S)&&p.push(C,S)}else for(var M=y.position.array,w=0,E=M.length/3-1;w<E;w+=3){var S=w+0,U=w+1,C=w+2;p.push(S,U,U,C,C,S)}var P=g.count>65535?Uint32Array:Uint16Array,B=new n.BufferAttribute(new P(p),1);return o(B,e.ELEMENT_ARRAY_BUFFER),d.wireframe=B,B}function l(f,d,p){if(d>p){var m=d;d=p,p=m}var y=f[d];return y===void 0?(f[d]=[p],!0):y.indexOf(p)===-1?(y.push(p),!0):!1}this.getAttributeBuffer=u,this.getWireframeAttribute=h,this.update=a},n.WebGLProgram=function(){var e=0;function t(d){switch(d){case n.LinearEncoding:return["Linear","( value )"];case n.sRGBEncoding:return["sRGB","( value )"];case n.RGBEEncoding:return["RGBE","( value )"];case n.RGBM7Encoding:return["RGBM","( value, 7.0 )"];case n.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case n.RGBDEncoding:return["RGBD","( value, 256.0 )"];case n.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+d)}}function r(d,p){var m=t(p);return"vec4 "+d+"( vec4 value ) { return "+m[0]+"ToLinear"+m[1]+"; }"}function i(d,p){var m=t(p);return"vec4 "+d+"( vec4 value ) { return LinearTo"+m[0]+m[1]+"; }"}function a(d,p){var m;switch(p){case n.LinearToneMapping:m="Linear";break;case n.ReinhardToneMapping:m="Reinhard";break;case n.Uncharted2ToneMapping:m="Uncharted2";break;case n.CineonToneMapping:m="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+p)}return"vec3 "+d+"( vec3 color ) { return "+m+"ToneMapping( color ); }"}function o(d,p,m){d=d||{};var y=[d.derivatives||p.envMapCubeUV||p.bumpMap||p.normalMap||p.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(d.fragDepth||p.logarithmicDepthBuffer)&&m.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",d.drawBuffers&&m.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(d.shaderTextureLOD||p.envMap)&&m.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return y.filter(u).join(`
`)}function s(d){var p=[];for(var m in d){var y=d[m];y!==!1&&p.push("#define "+m+" "+y)}return p.join(`
`)}function c(d,p,m){for(var y={},g=d.getProgramParameter(p,d.ACTIVE_ATTRIBUTES),x=0;x<g;x++){var M=d.getActiveAttrib(p,x),w=M.name;y[w]=d.getAttribLocation(p,w)}return y}function u(d){return d!==""}function h(d,p){return d.replace(/NUM_DIR_LIGHTS/g,p.numDirLights).replace(/NUM_SPOT_LIGHTS/g,p.numSpotLights).replace(/NUM_POINT_LIGHTS/g,p.numPointLights).replace(/NUM_HEMI_LIGHTS/g,p.numHemiLights)}function l(d){var p=/#include +<([\w\d.]+)>/g;function m(y,g){var x=n.ShaderChunk[g];if(x===void 0)throw new Error("Can not resolve #include <"+g+">");return l(x)}return d.replace(p,m)}function f(d){var p=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function m(y,g,x,M){for(var w="",E=parseInt(g);E<parseInt(x);E++)w+=M.replace(/\[ i \]/g,"[ "+E+" ]");return w}return d.replace(p,m)}return function(p,m,y,g){var x=p.context,M=y.extensions,w=y.defines,E=y.__webglShader.vertexShader,S=y.__webglShader.fragmentShader,U="SHADOWMAP_TYPE_BASIC";g.shadowMapType===n.PCFShadowMap?U="SHADOWMAP_TYPE_PCF":g.shadowMapType===n.PCFSoftShadowMap&&(U="SHADOWMAP_TYPE_PCF_SOFT");var C="ENVMAP_TYPE_CUBE",P="ENVMAP_MODE_REFLECTION",B="ENVMAP_BLENDING_MULTIPLY";if(g.envMap){switch(y.envMap.mapping){case n.CubeReflectionMapping:case n.CubeRefractionMapping:C="ENVMAP_TYPE_CUBE";break;case n.CubeUVReflectionMapping:case n.CubeUVRefractionMapping:C="ENVMAP_TYPE_CUBE_UV";break;case n.EquirectangularReflectionMapping:case n.EquirectangularRefractionMapping:C="ENVMAP_TYPE_EQUIREC";break;case n.SphericalReflectionMapping:C="ENVMAP_TYPE_SPHERE";break}switch(y.envMap.mapping){case n.CubeRefractionMapping:case n.EquirectangularRefractionMapping:P="ENVMAP_MODE_REFRACTION";break}switch(y.combine){case n.MultiplyOperation:B="ENVMAP_BLENDING_MULTIPLY";break;case n.MixOperation:B="ENVMAP_BLENDING_MIX";break;case n.AddOperation:B="ENVMAP_BLENDING_ADD";break}}var F=p.gammaFactor>0?p.gammaFactor:1,N=o(M,g,p.extensions),W=s(w),I=x.createProgram(),k,T;y instanceof n.RawShaderMaterial?(k="",T=""):(k=["precision "+g.precision+" float;","precision "+g.precision+" int;","#define SHADER_NAME "+y.__webglShader.name,W,g.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+F,"#define MAX_BONES "+g.maxBones,g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+P:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.displacementMap&&g.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.vertexColors?"#define USE_COLOR":"",g.flatShading?"#define FLAT_SHADED":"",g.skinning?"#define USE_SKINNING":"",g.useVertexTexture?"#define BONE_TEXTURE":"",g.morphTargets?"#define USE_MORPHTARGETS":"",g.morphNormals&&g.flatShading===!1?"#define USE_MORPHNORMALS":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+g.numClippingPlanes,g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+U:"",g.sizeAttenuation?"#define USE_SIZEATTENUATION":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&p.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(u).join(`
`),T=[N,"precision "+g.precision+" float;","precision "+g.precision+" int;","#define SHADER_NAME "+y.__webglShader.name,W,g.alphaTest?"#define ALPHATEST "+g.alphaTest:"","#define GAMMA_FACTOR "+F,g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+C:"",g.envMap?"#define "+P:"",g.envMap?"#define "+B:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.vertexColors?"#define USE_COLOR":"",g.flatShading?"#define FLAT_SHADED":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+g.numClippingPlanes,g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+U:"",g.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",g.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&p.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",g.envMap&&p.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",g.toneMapping!==n.NoToneMapping?"#define TONE_MAPPING":"",g.toneMapping!==n.NoToneMapping?n.ShaderChunk.tonemapping_pars_fragment:"",g.toneMapping!==n.NoToneMapping?a("toneMapping",g.toneMapping):"",g.outputEncoding||g.mapEncoding||g.envMapEncoding||g.emissiveMapEncoding?n.ShaderChunk.encodings_pars_fragment:"",g.mapEncoding?r("mapTexelToLinear",g.mapEncoding):"",g.envMapEncoding?r("envMapTexelToLinear",g.envMapEncoding):"",g.emissiveMapEncoding?r("emissiveMapTexelToLinear",g.emissiveMapEncoding):"",g.outputEncoding?i("linearToOutputTexel",g.outputEncoding):"",g.depthPacking?"#define DEPTH_PACKING "+y.depthPacking:"",`
`].filter(u).join(`
`)),E=l(E),E=h(E,g),S=l(S),S=h(S,g),y instanceof n.ShaderMaterial||(E=f(E),S=f(S));var O=k+E,G=T+S,j=n.WebGLShader(x,x.VERTEX_SHADER,O),Z=n.WebGLShader(x,x.FRAGMENT_SHADER,G);x.attachShader(I,j),x.attachShader(I,Z),y.index0AttributeName!==void 0?x.bindAttribLocation(I,0,y.index0AttributeName):g.morphTargets===!0&&x.bindAttribLocation(I,0,"position"),x.linkProgram(I);var Q=x.getProgramInfoLog(I),R=x.getShaderInfoLog(j),A=x.getShaderInfoLog(Z),D=!0,H=!0;x.getProgramParameter(I,x.LINK_STATUS)===!1?(D=!1,console.error("THREE.WebGLProgram: shader error: ",x.getError(),"gl.VALIDATE_STATUS",x.getProgramParameter(I,x.VALIDATE_STATUS),"gl.getProgramInfoLog",Q,R,A)):Q!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",Q):(R===""||A==="")&&(H=!1),H&&(this.diagnostics={runnable:D,material:y,programLog:Q,vertexShader:{log:R,prefix:k},fragmentShader:{log:A,prefix:T}}),x.deleteShader(j),x.deleteShader(Z);var Y;this.getUniforms=function(){return Y===void 0&&(Y=new n.WebGLUniforms(x,I,p)),Y};var X;return this.getAttributes=function(){return X===void 0&&(X=c(x,I)),X},this.destroy=function(){x.deleteProgram(I),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=e++,this.code=m,this.usedTimes=1,this.program=I,this.vertexShader=j,this.fragmentShader=Z,this}}(),n.WebGLPrograms=function(e,t){var r=[],i={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},a=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","depthPacking"];function o(c){if(t.floatVertexTextures&&c&&c.skeleton&&c.skeleton.useVertexTexture)return 1024;var u=t.maxVertexUniforms,h=Math.floor((u-20)/4),l=h;return c!==void 0&&c instanceof n.SkinnedMesh&&(l=Math.min(c.skeleton.bones.length,l),l<c.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+c.skeleton.bones.length+", this GPU supports just "+l+" (try OpenGL instead of ANGLE)")),l}function s(c,u){var h;return c?c instanceof n.Texture?h=c.encoding:c instanceof n.WebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),h=c.texture.encoding):h=n.LinearEncoding,h===n.LinearEncoding&&u&&(h=n.GammaEncoding),h}this.getParameters=function(c,u,h,l,f){var d=i[c.type],p=o(f),m=e.getPrecision();c.precision!==null&&(m=t.getMaxPrecision(c.precision),m!==c.precision&&console.warn("THREE.WebGLProgram.getParameters:",c.precision,"not supported, using",m,"instead."));var y=e.getCurrentRenderTarget(),g={shaderID:d,precision:m,supportsVertexTextures:t.vertexTextures,outputEncoding:s(y?y.texture:null,e.gammaOutput),map:!!c.map,mapEncoding:s(c.map,e.gammaInput),envMap:!!c.envMap,envMapMode:c.envMap&&c.envMap.mapping,envMapEncoding:s(c.envMap,e.gammaInput),envMapCubeUV:!!c.envMap&&(c.envMap.mapping===n.CubeUVReflectionMapping||c.envMap.mapping===n.CubeUVRefractionMapping),lightMap:!!c.lightMap,aoMap:!!c.aoMap,emissiveMap:!!c.emissiveMap,emissiveMapEncoding:s(c.emissiveMap,e.gammaInput),bumpMap:!!c.bumpMap,normalMap:!!c.normalMap,displacementMap:!!c.displacementMap,roughnessMap:!!c.roughnessMap,metalnessMap:!!c.metalnessMap,specularMap:!!c.specularMap,alphaMap:!!c.alphaMap,combine:c.combine,vertexColors:c.vertexColors,fog:h,useFog:c.fog,fogExp:h instanceof n.FogExp2,flatShading:c.shading===n.FlatShading,sizeAttenuation:c.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:c.skinning,maxBones:p,useVertexTexture:t.floatVertexTextures&&f&&f.skeleton&&f.skeleton.useVertexTexture,morphTargets:c.morphTargets,morphNormals:c.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:u.directional.length,numPointLights:u.point.length,numSpotLights:u.spot.length,numHemiLights:u.hemi.length,numClippingPlanes:l,shadowMapEnabled:e.shadowMap.enabled&&f.receiveShadow&&u.shadows.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:c.premultipliedAlpha,alphaTest:c.alphaTest,doubleSided:c.side===n.DoubleSide,flipSided:c.side===n.BackSide,depthPacking:c.depthPacking!==void 0?c.depthPacking:!1};return g},this.getProgramCode=function(c,u){var h=[];if(u.shaderID?h.push(u.shaderID):(h.push(c.fragmentShader),h.push(c.vertexShader)),c.defines!==void 0)for(var l in c.defines)h.push(l),h.push(c.defines[l]);for(var f=0;f<a.length;f++)h.push(u[a[f]]);return h.join()},this.acquireProgram=function(c,u,h){for(var l,f=0,d=r.length;f<d;f++){var p=r[f];if(p.code===h){l=p,++l.usedTimes;break}}return l===void 0&&(l=new n.WebGLProgram(e,h,c,u),r.push(l)),l},this.releaseProgram=function(c){if(--c.usedTimes===0){var u=r.indexOf(c);r[u]=r[r.length-1],r.pop(),c.destroy()}},this.programs=r},n.WebGLProperties=function(){var e={};this.get=function(t){var r=t.uuid,i=e[r];return i===void 0&&(i={},e[r]=i),i},this.delete=function(t){delete e[t.uuid]},this.clear=function(){e={}}},n.WebGLShader=function(){function e(t){for(var r=t.split(`
`),i=0;i<r.length;i++)r[i]=i+1+": "+r[i];return r.join(`
`)}return function(r,i,a){var o=r.createShader(i);return r.shaderSource(o,a),r.compileShader(o),r.getShaderParameter(o,r.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),r.getShaderInfoLog(o)!==""&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",i===r.VERTEX_SHADER?"vertex":"fragment",r.getShaderInfoLog(o),e(a)),o}}(),n.WebGLShadowMap=function(e,t,r){var i=e.context,a=e.state,o=new n.Frustum,s=new n.Matrix4,c=t.shadows,u=new n.Vector2,h=new n.Vector3,l=new n.Vector3,f=[],d=1,p=2,m=(d|p)+1,y=new Array(m),g=new Array(m),x={},M=[new n.Vector3(1,0,0),new n.Vector3(-1,0,0),new n.Vector3(0,0,1),new n.Vector3(0,0,-1),new n.Vector3(0,1,0),new n.Vector3(0,-1,0)],w=[new n.Vector3(0,1,0),new n.Vector3(0,1,0),new n.Vector3(0,1,0),new n.Vector3(0,1,0),new n.Vector3(0,0,1),new n.Vector3(0,0,-1)],E=[new n.Vector4,new n.Vector4,new n.Vector4,new n.Vector4,new n.Vector4,new n.Vector4],S=new n.MeshDepthMaterial;S.depthPacking=n.RGBADepthPacking,S.clipping=!0;for(var U=n.ShaderLib.distanceRGBA,C=n.UniformsUtils.clone(U.uniforms),P=0;P!==m;++P){var B=(P&d)!==0,F=(P&p)!==0,N=S.clone();N.morphTargets=B,N.skinning=F,y[P]=N;var W=new n.ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:C,vertexShader:U.vertexShader,fragmentShader:U.fragmentShader,morphTargets:B,skinning:F,clipping:!0});g[P]=W}var I=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=n.PCFShadowMap,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(O,G){if(I.enabled!==!1&&!(I.autoUpdate===!1&&I.needsUpdate===!1)&&c.length!==0){a.clearColor(1,1,1,1),a.disable(i.BLEND),a.setDepthTest(!0),a.setScissorTest(!1);for(var j,Z,Q=0,R=c.length;Q<R;Q++){var A=c[Q],D=A.shadow;if(D===void 0){console.warn("THREE.WebGLShadowMap:",A,"has no shadow.");continue}var H=D.camera;if(u.copy(D.mapSize),A instanceof n.PointLight){j=6,Z=!0;var Y=u.x,X=u.y;E[0].set(Y*2,X,Y,X),E[1].set(0,X,Y,X),E[2].set(Y*3,X,Y,X),E[3].set(Y,X,Y,X),E[4].set(Y*3,0,Y,X),E[5].set(Y,0,Y,X),u.x*=4,u.y*=2}else j=1,Z=!1;if(D.map===null){var K={minFilter:n.NearestFilter,magFilter:n.NearestFilter,format:n.RGBAFormat};D.map=new n.WebGLRenderTarget(u.x,u.y,K),H.updateProjectionMatrix()}D instanceof n.SpotLightShadow&&D.update(A);var ie=D.map,ce=D.matrix;l.setFromMatrixPosition(A.matrixWorld),H.position.copy(l),e.setRenderTarget(ie),e.clear();for(var b=0;b<j;b++){if(Z){h.copy(H.position),h.add(M[b]),H.up.copy(w[b]),H.lookAt(h);var me=E[b];a.viewport(me)}else h.setFromMatrixPosition(A.target.matrixWorld),H.lookAt(h);H.updateMatrixWorld(),H.matrixWorldInverse.getInverse(H.matrixWorld),ce.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),ce.multiply(H.projectionMatrix),ce.multiply(H.matrixWorldInverse),s.multiplyMatrices(H.projectionMatrix,H.matrixWorldInverse),o.setFromMatrix(s),f.length=0,T(O,G,H);for(var _e=0,he=f.length;_e<he;_e++){var pe=f[_e],J=r.update(pe),fe=pe.material;if(fe instanceof n.MultiMaterial)for(var le=J.groups,de=fe.materials,ge=0,xe=le.length;ge<xe;ge++){var Ee=le[ge],Re=de[Ee.materialIndex];if(Re.visible===!0){var Me=k(pe,Re,Z,l);e.renderBufferDirect(H,null,J,Me,pe,Ee)}}else{var Me=k(pe,fe,Z,l);e.renderBufferDirect(H,null,J,Me,pe,null)}}}}var Ae=e.getClearColor(),Le=e.getClearAlpha();e.setClearColor(Ae,Le),I.needsUpdate=!1}};function k(O,G,j,Z){var Q=O.geometry,R=null,A=y,D=O.customDepthMaterial;if(j&&(A=g,D=O.customDistanceMaterial),D)R=D;else{var H=Q.morphTargets!==void 0&&Q.morphTargets.length>0&&G.morphTargets,Y=O instanceof n.SkinnedMesh&&G.skinning,X=0;H&&(X|=d),Y&&(X|=p),R=A[X]}if(e.localClippingEnabled&&G.clipShadows===!0&&G.clippingPlanes.length!==0){var K=R.uuid,ie=G.uuid,ce=x[K];ce===void 0&&(ce={},x[K]=ce);var b=ce[ie];b===void 0&&(b=R.clone(),ce[ie]=b),R=b}R.visible=G.visible,R.wireframe=G.wireframe;var me=G.side;return I.renderSingleSided&&me==n.DoubleSide&&(me=n.FrontSide),I.renderReverseSided&&(me===n.FrontSide?me=n.BackSide:me===n.BackSide&&(me=n.FrontSide)),R.side=me,R.clipShadows=G.clipShadows,R.clippingPlanes=G.clippingPlanes,R.wireframeLinewidth=G.wireframeLinewidth,R.linewidth=G.linewidth,j&&R.uniforms.lightPos!==void 0&&R.uniforms.lightPos.value.copy(Z),R}function T(O,G,j){if(O.visible!==!1){if(O.layers.test(G.layers)&&(O instanceof n.Mesh||O instanceof n.Line||O instanceof n.Points)&&O.castShadow&&(O.frustumCulled===!1||o.intersectsObject(O)===!0)){var Z=O.material;Z.visible===!0&&(O.modelViewMatrix.multiplyMatrices(j.matrixWorldInverse,O.matrixWorld),f.push(O))}for(var Q=O.children,R=0,A=Q.length;R<A;R++)T(Q[R],G,j)}}},n.WebGLState=function(e,t,r){var i=this;this.buffers={color:new n.WebGLColorBuffer(e,this),depth:new n.WebGLDepthBuffer(e,this),stencil:new n.WebGLStencilBuffer(e,this)};var a=e.getParameter(e.MAX_VERTEX_ATTRIBS),o=new Uint8Array(a),s=new Uint8Array(a),c=new Uint8Array(a),u={},h=null,l=null,f=null,d=null,p=null,m=null,y=null,g=null,x=!1,M=null,w=null,E=null,S=null,U=null,C=null,P=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),B=null,F={},N=new n.Vector4,W=new n.Vector4;function I(T,O,G){var j=new Uint8Array(3),Z=e.createTexture();e.bindTexture(T,Z),e.texParameteri(T,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(T,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var Q=0;Q<G;Q++)e.texImage2D(O+Q,0,e.RGB,1,1,0,e.RGB,e.UNSIGNED_BYTE,j);return Z}var k={};k[e.TEXTURE_2D]=I(e.TEXTURE_2D,e.TEXTURE_2D,1),k[e.TEXTURE_CUBE_MAP]=I(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),this.init=function(){this.clearColor(0,0,0,1),this.clearDepth(1),this.clearStencil(0),this.enable(e.DEPTH_TEST),this.setDepthFunc(n.LessEqualDepth),this.setFlipSided(!1),this.setCullFace(n.CullFaceBack),this.enable(e.CULL_FACE),this.enable(e.BLEND),this.setBlending(n.NormalBlending)},this.initAttributes=function(){for(var T=0,O=o.length;T<O;T++)o[T]=0},this.enableAttribute=function(T){if(o[T]=1,s[T]===0&&(e.enableVertexAttribArray(T),s[T]=1),c[T]!==0){var O=t.get("ANGLE_instanced_arrays");O.vertexAttribDivisorANGLE(T,0),c[T]=0}},this.enableAttributeAndDivisor=function(T,O,G){o[T]=1,s[T]===0&&(e.enableVertexAttribArray(T),s[T]=1),c[T]!==O&&(G.vertexAttribDivisorANGLE(T,O),c[T]=O)},this.disableUnusedAttributes=function(){for(var T=0,O=s.length;T!==O;++T)s[T]!==o[T]&&(e.disableVertexAttribArray(T),s[T]=0)},this.enable=function(T){u[T]!==!0&&(e.enable(T),u[T]=!0)},this.disable=function(T){u[T]!==!1&&(e.disable(T),u[T]=!1)},this.getCompressedTextureFormats=function(){if(h===null&&(h=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")))for(var T=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),O=0;O<T.length;O++)h.push(T[O]);return h},this.setBlending=function(T,O,G,j,Z,Q,R,A){if(T!==n.NoBlending)this.enable(e.BLEND);else{this.disable(e.BLEND),l=T;return}(T!==l||A!==x)&&(T===n.AdditiveBlending?A?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):T===n.SubtractiveBlending?A?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):T===n.MultiplyBlending?A?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):A?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),l=T,x=A),T===n.CustomBlending?(Z=Z||O,Q=Q||G,R=R||j,(O!==f||Z!==m)&&(e.blendEquationSeparate(r(O),r(Z)),f=O,m=Z),(G!==d||j!==p||Q!==y||R!==g)&&(e.blendFuncSeparate(r(G),r(j),r(Q),r(R)),d=G,p=j,y=Q,g=R)):(f=null,d=null,p=null,m=null,y=null,g=null)},this.setColorWrite=function(T){this.buffers.color.setMask(T)},this.setDepthTest=function(T){this.buffers.depth.setTest(T)},this.setDepthWrite=function(T){this.buffers.depth.setMask(T)},this.setDepthFunc=function(T){this.buffers.depth.setFunc(T)},this.setStencilTest=function(T){this.buffers.stencil.setTest(T)},this.setStencilWrite=function(T){this.buffers.stencil.setMask(T)},this.setStencilFunc=function(T,O,G){this.buffers.stencil.setFunc(T,O,G)},this.setStencilOp=function(T,O,G){this.buffers.stencil.setOp(T,O,G)},this.setFlipSided=function(T){M!==T&&(T?e.frontFace(e.CW):e.frontFace(e.CCW),M=T)},this.setCullFace=function(T){T!==n.CullFaceNone?(this.enable(e.CULL_FACE),T!==w&&(T===n.CullFaceBack?e.cullFace(e.BACK):T===n.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),w=T},this.setLineWidth=function(T){T!==E&&(e.lineWidth(T),E=T)},this.setPolygonOffset=function(T,O,G){T?(this.enable(e.POLYGON_OFFSET_FILL),(S!==O||U!==G)&&(e.polygonOffset(O,G),S=O,U=G)):this.disable(e.POLYGON_OFFSET_FILL)},this.getScissorTest=function(){return C},this.setScissorTest=function(T){C=T,T?this.enable(e.SCISSOR_TEST):this.disable(e.SCISSOR_TEST)},this.activeTexture=function(T){T===void 0&&(T=e.TEXTURE0+P-1),B!==T&&(e.activeTexture(T),B=T)},this.bindTexture=function(T,O){B===null&&i.activeTexture();var G=F[B];G===void 0&&(G={type:void 0,texture:void 0},F[B]=G),(G.type!==T||G.texture!==O)&&(e.bindTexture(T,O||k[T]),G.type=T,G.texture=O)},this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(T){console.error(T)}},this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(T){console.error(T)}},this.clearColor=function(T,O,G,j){this.buffers.color.setClear(T,O,G,j)},this.clearDepth=function(T){this.buffers.depth.setClear(T)},this.clearStencil=function(T){this.buffers.stencil.setClear(T)},this.scissor=function(T){N.equals(T)===!1&&(e.scissor(T.x,T.y,T.z,T.w),N.copy(T))},this.viewport=function(T){W.equals(T)===!1&&(e.viewport(T.x,T.y,T.z,T.w),W.copy(T))},this.reset=function(){for(var T=0;T<s.length;T++)s[T]===1&&(e.disableVertexAttribArray(T),s[T]=0);u={},h=null,B=null,F={},l=null,M=null,w=null,this.buffers.color.reset(),this.buffers.depth.reset(),this.buffers.stencil.reset()}},n.WebGLColorBuffer=function(e,t){var r=!1,i=new n.Vector4,a=null,o=new n.Vector4;this.setMask=function(s){a!==s&&!r&&(e.colorMask(s,s,s,s),a=s)},this.setLocked=function(s){r=s},this.setClear=function(s,c,u,h){i.set(s,c,u,h),o.equals(i)===!1&&(e.clearColor(s,c,u,h),o.copy(i))},this.reset=function(){r=!1,a=null,o=new n.Vector4}},n.WebGLDepthBuffer=function(e,t){var r=!1,i=null,a=null,o=null;this.setTest=function(s){s?t.enable(e.DEPTH_TEST):t.disable(e.DEPTH_TEST)},this.setMask=function(s){i!==s&&!r&&(e.depthMask(s),i=s)},this.setFunc=function(s){if(a!==s){if(s)switch(s){case n.NeverDepth:e.depthFunc(e.NEVER);break;case n.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case n.LessDepth:e.depthFunc(e.LESS);break;case n.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case n.EqualDepth:e.depthFunc(e.EQUAL);break;case n.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case n.GreaterDepth:e.depthFunc(e.GREATER);break;case n.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);a=s}},this.setLocked=function(s){r=s},this.setClear=function(s){o!==s&&(e.clearDepth(s),o=s)},this.reset=function(){r=!1,i=null,a=null,o=null}},n.WebGLStencilBuffer=function(e,t){var r=!1,i=null,a=null,o=null,s=null,c=null,u=null,h=null,l=null;this.setTest=function(f){f?t.enable(e.STENCIL_TEST):t.disable(e.STENCIL_TEST)},this.setMask=function(f){i!==f&&!r&&(e.stencilMask(f),i=f)},this.setFunc=function(f,d,p){(a!==f||o!==d||s!==p)&&(e.stencilFunc(f,d,p),a=f,o=d,s=p)},this.setOp=function(f,d,p){(c!==f||u!==d||h!==p)&&(e.stencilOp(f,d,p),c=f,u=d,h=p)},this.setLocked=function(f){r=f},this.setClear=function(f){l!==f&&(e.clearStencil(f),l=f)},this.reset=function(){r=!1,i=null,a=null,o=null,s=null,c=null,u=null,h=null,l=null}},n.WebGLUniforms=function(){var e=function(){this.seq=[],this.map={}},t=[],r=[],i=function(R,A,D){var H=R[0];if(H<=0||H>0)return R;var Y=A*D,X=t[Y];if(X===void 0&&(X=new Float32Array(Y),t[Y]=X),A!==0){H.toArray(X,0);for(var K=1,ie=0;K!==A;++K)ie+=D,R[K].toArray(X,ie)}return X},a=function(R,A){var D=r[A];D===void 0&&(D=new Int32Array(A),r[A]=D);for(var H=0;H!==A;++H)D[H]=R.allocTextureUnit();return D},o=function(R,A){R.uniform1f(this.addr,A)},s=function(R,A){R.uniform1i(this.addr,A)},c=function(R,A){A.x===void 0?R.uniform2fv(this.addr,A):R.uniform2f(this.addr,A.x,A.y)},u=function(R,A){A.x!==void 0?R.uniform3f(this.addr,A.x,A.y,A.z):A.r!==void 0?R.uniform3f(this.addr,A.r,A.g,A.b):R.uniform3fv(this.addr,A)},h=function(R,A){A.x===void 0?R.uniform4fv(this.addr,A):R.uniform4f(this.addr,A.x,A.y,A.z,A.w)},l=function(R,A){R.uniformMatrix2fv(this.addr,!1,A.elements||A)},f=function(R,A){R.uniformMatrix3fv(this.addr,!1,A.elements||A)},d=function(R,A){R.uniformMatrix4fv(this.addr,!1,A.elements||A)},p=function(R,A,D){var H=D.allocTextureUnit();R.uniform1i(this.addr,H),A&&D.setTexture2D(A,H)},m=function(R,A,D){var H=D.allocTextureUnit();R.uniform1i(this.addr,H),A&&D.setTextureCube(A,H)},y=function(R,A){R.uniform2iv(this.addr,A)},g=function(R,A){R.uniform3iv(this.addr,A)},x=function(R,A){R.uniform4iv(this.addr,A)},M=function(R){switch(R){case 5126:return o;case 35664:return c;case 35665:return u;case 35666:return h;case 35674:return l;case 35675:return f;case 35676:return d;case 35678:return p;case 35680:return m;case 5124:case 35670:return s;case 35667:case 35671:return y;case 35668:case 35672:return g;case 35669:case 35673:return x}},w=function(R,A){R.uniform1fv(this.addr,A)},E=function(R,A){R.uniform1iv(this.addr,A)},S=function(R,A){R.uniform2fv(this.addr,i(A,this.size,2))},U=function(R,A){R.uniform3fv(this.addr,i(A,this.size,3))},C=function(R,A){R.uniform4fv(this.addr,i(A,this.size,4))},P=function(R,A){R.uniformMatrix2fv(this.addr,!1,i(A,this.size,4))},B=function(R,A){R.uniformMatrix3fv(this.addr,!1,i(A,this.size,9))},F=function(R,A){R.uniformMatrix4fv(this.addr,!1,i(A,this.size,16))},N=function(R,A,D){var H=A.length,Y=a(D,H);R.uniform1iv(this.addr,Y);for(var X=0;X!==H;++X){var K=A[X];K&&D.setTexture2D(K,Y[X])}},W=function(R,A,D){var H=A.length,Y=a(D,H);R.uniform1iv(this.addr,Y);for(var X=0;X!==H;++X){var K=A[X];K&&D.setTextureCube(K,Y[X])}},I=function(R){switch(R){case 5126:return w;case 35664:return S;case 35665:return U;case 35666:return C;case 35674:return P;case 35675:return B;case 35676:return F;case 35678:return N;case 35680:return W;case 5124:case 35670:return E;case 35667:case 35671:return y;case 35668:case 35672:return g;case 35669:case 35673:return x}},k=function(A,D,H){this.id=A,this.addr=H,this.setValue=M(D.type)},T=function(R,A,D){this.id=R,this.addr=D,this.size=A.size,this.setValue=I(A.type)},O=function(R){this.id=R,e.call(this)};O.prototype.setValue=function(R,A){for(var D=this.seq,H=0,Y=D.length;H!==Y;++H){var X=D[H];X.setValue(R,A[X.id])}};var G=/([\w\d_]+)(\])?(\[|\.)?/g,j=function(R,A){R.seq.push(A),R.map[A.id]=A},Z=function(R,A,D){var H=R.name,Y=H.length;for(G.lastIndex=0;;){var X=G.exec(H),K=G.lastIndex,ie=X[1],ce=X[2]==="]",b=X[3];if(ce&&(ie=ie|0),b===void 0||b==="["&&K+2===Y){j(D,b===void 0?new k(ie,R,A):new T(ie,R,A));break}else{var me=D.map,_e=me[ie];_e===void 0&&(_e=new O(ie),j(D,_e)),D=_e}}},Q=function(A,D,H){e.call(this),this.renderer=H;for(var Y=A.getProgramParameter(D,A.ACTIVE_UNIFORMS),X=0;X!==Y;++X){var K=A.getActiveUniform(D,X),ie=K.name,ce=A.getUniformLocation(D,ie);Z(K,ce,this)}};return Q.prototype.setValue=function(R,A,D){var H=this.map[A];H!==void 0&&H.setValue(R,D,this.renderer)},Q.prototype.set=function(R,A,D){var H=this.map[D];H!==void 0&&H.setValue(R,A[D],this.renderer)},Q.prototype.setOptional=function(R,A,D){var H=A[D];H!==void 0&&this.setValue(R,D,H)},Q.upload=function(R,A,D,H){for(var Y=0,X=A.length;Y!==X;++Y){var K=A[Y],ie=D[K.id];ie.needsUpdate!==!1&&K.setValue(R,ie.value,H)}},Q.seqWithValue=function(R,A){for(var D=[],H=0,Y=R.length;H!==Y;++H){var X=R[H];X.id in A&&D.push(X)}return D},Q.splitDynamic=function(R,A){for(var D=null,H=R.length,Y=0,X=0;X!==H;++X){var K=R[X],ie=A[K.id];ie&&ie.dynamic===!0?(D===null&&(D=[]),D.push(K)):(Y<X&&(R[Y]=K),++Y)}return Y<H&&(R.length=Y),D},Q.evalDynamic=function(R,A,D,H){for(var Y=0,X=R.length;Y!==X;++Y){var K=A[R[Y].id],ie=K.onUpdateCallback;ie!==void 0&&ie.call(K,D,H)}},Q}(),n.LensFlarePlugin=function(e,t){var r=e.context,i=e.state,a,o,s,c,u,h,l,f;function d(){var m=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),y=new Uint16Array([0,1,2,0,2,3]);a=r.createBuffer(),o=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,a),r.bufferData(r.ARRAY_BUFFER,m,r.STATIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o),r.bufferData(r.ELEMENT_ARRAY_BUFFER,y,r.STATIC_DRAW),l=r.createTexture(),f=r.createTexture(),i.bindTexture(r.TEXTURE_2D,l),r.texImage2D(r.TEXTURE_2D,0,r.RGB,16,16,0,r.RGB,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),i.bindTexture(r.TEXTURE_2D,f),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,16,16,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),s={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join(`
`),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join(`
`)},c=p(s),u={vertex:r.getAttribLocation(c,"position"),uv:r.getAttribLocation(c,"uv")},h={renderType:r.getUniformLocation(c,"renderType"),map:r.getUniformLocation(c,"map"),occlusionMap:r.getUniformLocation(c,"occlusionMap"),opacity:r.getUniformLocation(c,"opacity"),color:r.getUniformLocation(c,"color"),scale:r.getUniformLocation(c,"scale"),rotation:r.getUniformLocation(c,"rotation"),screenPosition:r.getUniformLocation(c,"screenPosition")}}this.render=function(m,y,g){if(t.length!==0){var x=new n.Vector3,M=g.w/g.z,w=g.z*.5,E=g.w*.5,S=16/g.w,U=new n.Vector2(S*M,S),C=new n.Vector3(1,1,0),P=new n.Vector2(1,1),B=new n.Box2;B.min.set(0,0),B.max.set(g.z-16,g.w-16),c===void 0&&d(),r.useProgram(c),i.initAttributes(),i.enableAttribute(u.vertex),i.enableAttribute(u.uv),i.disableUnusedAttributes(),r.uniform1i(h.occlusionMap,0),r.uniform1i(h.map,1),r.bindBuffer(r.ARRAY_BUFFER,a),r.vertexAttribPointer(u.vertex,2,r.FLOAT,!1,2*8,0),r.vertexAttribPointer(u.uv,2,r.FLOAT,!1,2*8,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o),i.disable(r.CULL_FACE),i.setDepthWrite(!1);for(var F=0,N=t.length;F<N;F++){S=16/g.w,U.set(S*M,S);var W=t[F];if(x.set(W.matrixWorld.elements[12],W.matrixWorld.elements[13],W.matrixWorld.elements[14]),x.applyMatrix4(y.matrixWorldInverse),x.applyProjection(y.projectionMatrix),C.copy(x),P.x=g.x+C.x*w+w-8,P.y=g.y+C.y*E+E-8,B.containsPoint(P)===!0){i.activeTexture(r.TEXTURE0),i.bindTexture(r.TEXTURE_2D,null),i.activeTexture(r.TEXTURE1),i.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGB,P.x,P.y,16,16,0),r.uniform1i(h.renderType,0),r.uniform2f(h.scale,U.x,U.y),r.uniform3f(h.screenPosition,C.x,C.y,C.z),i.disable(r.BLEND),i.enable(r.DEPTH_TEST),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0),i.activeTexture(r.TEXTURE0),i.bindTexture(r.TEXTURE_2D,f),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,P.x,P.y,16,16,0),r.uniform1i(h.renderType,1),i.disable(r.DEPTH_TEST),i.activeTexture(r.TEXTURE1),i.bindTexture(r.TEXTURE_2D,l),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0),W.positionScreen.copy(C),W.customUpdateCallback?W.customUpdateCallback(W):W.updateLensFlares(),r.uniform1i(h.renderType,2),i.enable(r.BLEND);for(var I=0,k=W.lensFlares.length;I<k;I++){var T=W.lensFlares[I];T.opacity>.001&&T.scale>.001&&(C.x=T.x,C.y=T.y,C.z=T.z,S=T.size*T.scale/g.w,U.x=S*M,U.y=S,r.uniform3f(h.screenPosition,C.x,C.y,C.z),r.uniform2f(h.scale,U.x,U.y),r.uniform1f(h.rotation,T.rotation),r.uniform1f(h.opacity,T.opacity),r.uniform3f(h.color,T.color.r,T.color.g,T.color.b),i.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),e.setTexture2D(T.texture,1),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0))}}}i.enable(r.CULL_FACE),i.enable(r.DEPTH_TEST),i.setDepthWrite(!0),e.resetGLState()}};function p(m){var y=r.createProgram(),g=r.createShader(r.FRAGMENT_SHADER),x=r.createShader(r.VERTEX_SHADER),M="precision "+e.getPrecision()+` float;
`;return r.shaderSource(g,M+m.fragmentShader),r.shaderSource(x,M+m.vertexShader),r.compileShader(g),r.compileShader(x),r.attachShader(y,g),r.attachShader(y,x),r.linkProgram(y),y}},n.SpritePlugin=function(e,t){var r=e.context,i=e.state,a,o,s,c,u,h,l=new n.Vector3,f=new n.Quaternion,d=new n.Vector3;function p(){var g=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),x=new Uint16Array([0,1,2,0,2,3]);a=r.createBuffer(),o=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,a),r.bufferData(r.ARRAY_BUFFER,g,r.STATIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o),r.bufferData(r.ELEMENT_ARRAY_BUFFER,x,r.STATIC_DRAW),s=m(),c={position:r.getAttribLocation(s,"position"),uv:r.getAttribLocation(s,"uv")},u={uvOffset:r.getUniformLocation(s,"uvOffset"),uvScale:r.getUniformLocation(s,"uvScale"),rotation:r.getUniformLocation(s,"rotation"),scale:r.getUniformLocation(s,"scale"),color:r.getUniformLocation(s,"color"),map:r.getUniformLocation(s,"map"),opacity:r.getUniformLocation(s,"opacity"),modelViewMatrix:r.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:r.getUniformLocation(s,"projectionMatrix"),fogType:r.getUniformLocation(s,"fogType"),fogDensity:r.getUniformLocation(s,"fogDensity"),fogNear:r.getUniformLocation(s,"fogNear"),fogFar:r.getUniformLocation(s,"fogFar"),fogColor:r.getUniformLocation(s,"fogColor"),alphaTest:r.getUniformLocation(s,"alphaTest")};var M=document.createElement("canvas");M.width=8,M.height=8;var w=M.getContext("2d");w.fillStyle="white",w.fillRect(0,0,8,8),h=new n.Texture(M),h.needsUpdate=!0}this.render=function(g,x){if(t.length!==0){s===void 0&&p(),r.useProgram(s),i.initAttributes(),i.enableAttribute(c.position),i.enableAttribute(c.uv),i.disableUnusedAttributes(),i.disable(r.CULL_FACE),i.enable(r.BLEND),r.bindBuffer(r.ARRAY_BUFFER,a),r.vertexAttribPointer(c.position,2,r.FLOAT,!1,2*8,0),r.vertexAttribPointer(c.uv,2,r.FLOAT,!1,2*8,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o),r.uniformMatrix4fv(u.projectionMatrix,!1,x.projectionMatrix.elements),i.activeTexture(r.TEXTURE0),r.uniform1i(u.map,0);var M=0,w=0,E=g.fog;E?(r.uniform3f(u.fogColor,E.color.r,E.color.g,E.color.b),E instanceof n.Fog?(r.uniform1f(u.fogNear,E.near),r.uniform1f(u.fogFar,E.far),r.uniform1i(u.fogType,1),M=1,w=1):E instanceof n.FogExp2&&(r.uniform1f(u.fogDensity,E.density),r.uniform1i(u.fogType,2),M=2,w=2)):(r.uniform1i(u.fogType,0),M=0,w=0);for(var S=0,U=t.length;S<U;S++){var C=t[S];C.modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,C.matrixWorld),C.z=-C.modelViewMatrix.elements[14]}t.sort(y);for(var P=[],S=0,U=t.length;S<U;S++){var C=t[S],B=C.material;r.uniform1f(u.alphaTest,B.alphaTest),r.uniformMatrix4fv(u.modelViewMatrix,!1,C.modelViewMatrix.elements),C.matrixWorld.decompose(l,f,d),P[0]=d.x,P[1]=d.y;var F=0;g.fog&&B.fog&&(F=w),M!==F&&(r.uniform1i(u.fogType,F),M=F),B.map!==null?(r.uniform2f(u.uvOffset,B.map.offset.x,B.map.offset.y),r.uniform2f(u.uvScale,B.map.repeat.x,B.map.repeat.y)):(r.uniform2f(u.uvOffset,0,0),r.uniform2f(u.uvScale,1,1)),r.uniform1f(u.opacity,B.opacity),r.uniform3f(u.color,B.color.r,B.color.g,B.color.b),r.uniform1f(u.rotation,B.rotation),r.uniform2fv(u.scale,P),i.setBlending(B.blending,B.blendEquation,B.blendSrc,B.blendDst),i.setDepthTest(B.depthTest),i.setDepthWrite(B.depthWrite),B.map?e.setTexture2D(B.map,0):e.setTexture2D(h,0),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}i.enable(r.CULL_FACE),e.resetGLState()}};function m(){var g=r.createProgram(),x=r.createShader(r.VERTEX_SHADER),M=r.createShader(r.FRAGMENT_SHADER);return r.shaderSource(x,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join(`
`)),r.shaderSource(M,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join(`
`)),r.compileShader(x),r.compileShader(M),r.attachShader(g,x),r.attachShader(g,M),r.linkProgram(g),g}function y(g,x){return g.renderOrder!==x.renderOrder?g.renderOrder-x.renderOrder:g.z!==x.z?x.z-g.z:x.id-g.id}},Object.assign(n,{Face4:function(e,t,r,i,a,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new n.Face3(e,t,r,a,o,s)},LineStrip:0,LinePieces:1,MeshFaceMaterial:n.MultiMaterial,PointCloud:function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new n.Points(e,t)},Particle:n.Sprite,ParticleSystem:function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new n.Points(e,t)},PointCloudMaterial:function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new n.PointsMaterial(e)},ParticleBasicMaterial:function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new n.PointsMaterial(e)},ParticleSystemMaterial:function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new n.PointsMaterial(e)},Vertex:function(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new n.Vector3(e,t,r)}}),Object.assign(n.Box2.prototype,{empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)}}),Object.assign(n.Box3.prototype,{empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(n.Matrix3.prototype,{multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)}}),Object.assign(n.Matrix4.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(e){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}}),Object.assign(n.Plane.prototype,{isIntersectionLine:function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)}}),Object.assign(n.Quaternion.prototype,{multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)}}),Object.assign(n.Ray.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(n.Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)}}),Object.assign(n.Object3D.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(e){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)}}),Object.defineProperties(n.Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(n.LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),n.PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(n.Light.prototype,{onlyShadow:{set:function(e){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(e){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(e){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(n.BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length}}}),Object.assign(n.BufferGeometry.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){r!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(n.BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(n.Material.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(e){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new n.Color}}}),Object.defineProperties(n.MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(e){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(n.ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),n.EventDispatcher.prototype=Object.assign(Object.create({constructor:n.EventDispatcher,apply:function(e){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in."),Object.assign(e,this)}}),n.EventDispatcher.prototype),Object.assign(n.WebGLRenderer.prototype,{supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(n.WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=e}}}),Object.defineProperties(n.WebGLShadowMap.prototype,{cullFace:{get:function(){return this.renderReverseSided?n.CullFaceFront:n.CullFaceBack},set:function(e){var t=e!==n.CullFaceBack;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+t+"."),this.renderReverseSided=t}}}),Object.defineProperties(n.WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.assign(n.Audio.prototype,{load:function(e){console.warn("THREE.Audio: .load has been deprecated. Please use THREE.AudioLoader.");var t=this,r=new n.AudioLoader;return r.load(e,function(i){t.setBuffer(i)}),this}}),Object.assign(n.AudioAnalyser.prototype,{getData:function(e){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()}}),n.GeometryUtils={merge:function(e,t,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var i;t instanceof n.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},n.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var a=new n.TextureLoader;a.setCrossOrigin(this.crossOrigin);var o=a.load(e,r,void 0,i);return t&&(o.mapping=t),o},loadTextureCube:function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var a=new n.CubeTextureLoader;a.setCrossOrigin(this.crossOrigin);var o=a.load(e,r,void 0,i);return t&&(o.mapping=t),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}},n.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},n.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},n.CurveUtils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,a){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*a},tangentSpline:function(e,t,r,i,a){var o=6*e*e-6*e,s=3*e*e-4*e+1,c=-6*e*e+6*e,u=3*e*e-2*e;return o+s+c+u},interpolate:function(e,t,r,i,a){var o=(r-e)*.5,s=(i-t)*.5,c=a*a,u=a*c;return(2*t-2*r+o+s)*u+(-3*t+3*r-2*o-s)*c+o*a+t}},n.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new n.Group,i=0,a=t.length;i<a;i++)r.add(new n.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var i=new n.Matrix4;i.getInverse(r.matrixWorld),e.applyMatrix(i),t.remove(e),r.add(e)}},n.ShapeUtils={area:function(e){for(var t=e.length,r=0,i=t-1,a=0;a<t;i=a++)r+=e[i].x*e[a].y-e[a].x*e[i].y;return r*.5},triangulate:function(){function e(t,r,i,a,o,s){var c,u,h,l,f,d,p,m,y;if(u=t[s[r]].x,h=t[s[r]].y,l=t[s[i]].x,f=t[s[i]].y,d=t[s[a]].x,p=t[s[a]].y,Number.EPSILON>(l-u)*(p-h)-(f-h)*(d-u))return!1;var g,x,M,w,E,S,U,C,P,B,F,N,W,I,k;for(g=d-l,x=p-f,M=u-d,w=h-p,E=l-u,S=f-h,c=0;c<o;c++)if(m=t[s[c]].x,y=t[s[c]].y,!(m===u&&y===h||m===l&&y===f||m===d&&y===p)&&(U=m-u,C=y-h,P=m-l,B=y-f,F=m-d,N=y-p,k=g*B-x*P,W=E*C-S*U,I=M*N-w*F,k>=-Number.EPSILON&&I>=-Number.EPSILON&&W>=-Number.EPSILON))return!1;return!0}return function(t,r){var i=t.length;if(i<3)return null;var a=[],o=[],s=[],c,u,h;if(n.ShapeUtils.area(t)>0)for(u=0;u<i;u++)o[u]=u;else for(u=0;u<i;u++)o[u]=i-1-u;var l=i,f=2*l;for(u=l-1;l>2;){if(f--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),r?s:a;if(c=u,l<=c&&(c=0),u=c+1,l<=u&&(u=0),h=u+1,l<=h&&(h=0),e(t,c,u,h,l,o)){var d,p,m,y,g;for(d=o[c],p=o[u],m=o[h],a.push([t[d],t[p],t[m]]),s.push([o[c],o[u],o[h]]),y=u,g=u+1;g<l;y++,g++)o[y]=o[g];l--,f=2*l}}return r?s:a}}(),triangulateShape:function(e,t){function r(M,w,E){return M.x!==w.x?M.x<w.x?M.x<=E.x&&E.x<=w.x:w.x<=E.x&&E.x<=M.x:M.y<w.y?M.y<=E.y&&E.y<=w.y:w.y<=E.y&&E.y<=M.y}function i(M,w,E,S,U){var C=w.x-M.x,P=w.y-M.y,B=S.x-E.x,F=S.y-E.y,N=M.x-E.x,W=M.y-E.y,I=P*B-C*F,k=P*N-C*W;if(Math.abs(I)>Number.EPSILON){var T;if(I>0){if(k<0||k>I)return[];if(T=F*N-B*W,T<0||T>I)return[]}else{if(k>0||k<I)return[];if(T=F*N-B*W,T>0||T<I)return[]}if(T===0)return U&&(k===0||k===I)?[]:[M];if(T===I)return U&&(k===0||k===I)?[]:[w];if(k===0)return[E];if(k===I)return[S];var O=T/I;return[{x:M.x+O*C,y:M.y+O*P}]}else{if(k!==0||F*N!==B*W)return[];var G=C===0&&P===0,j=B===0&&F===0;if(G&&j)return M.x!==E.x||M.y!==E.y?[]:[M];if(G)return r(E,S,M)?[M]:[];if(j)return r(M,w,E)?[E]:[];var Z,Q,R,A,D,H,Y,X;return C!==0?(M.x<w.x?(Z=M,R=M.x,Q=w,A=w.x):(Z=w,R=w.x,Q=M,A=M.x),E.x<S.x?(D=E,Y=E.x,H=S,X=S.x):(D=S,Y=S.x,H=E,X=E.x)):(M.y<w.y?(Z=M,R=M.y,Q=w,A=w.y):(Z=w,R=w.y,Q=M,A=M.y),E.y<S.y?(D=E,Y=E.y,H=S,X=S.y):(D=S,Y=S.y,H=E,X=E.y)),R<=Y?A<Y?[]:A===Y?U?[]:[D]:A<=X?[D,Q]:[D,H]:R>X?[]:R===X?U?[]:[Z]:A<=X?[Z,Q]:[Z,H]}}function a(M,w,E,S){var U=w.x-M.x,C=w.y-M.y,P=E.x-M.x,B=E.y-M.y,F=S.x-M.x,N=S.y-M.y,W=U*B-C*P,I=U*N-C*F;if(Math.abs(W)>Number.EPSILON){var k=F*B-N*P;return W>0?I>=0&&k>=0:I>=0||k>=0}else return I>0}function o(M,w){var E=M.concat(),S;function U(X,K){var ie=E.length-1,ce=X-1;ce<0&&(ce=ie);var b=X+1;b>ie&&(b=0);var me=a(E[X],E[ce],E[b],S[K]);if(!me)return!1;var _e=S.length-1,he=K-1;he<0&&(he=_e);var pe=K+1;return pe>_e&&(pe=0),me=a(S[K],S[he],S[pe],E[X]),!!me}function C(X,K){var ie,ce,b;for(ie=0;ie<E.length;ie++)if(ce=ie+1,ce%=E.length,b=i(X,K,E[ie],E[ce],!0),b.length>0)return!0;return!1}var P=[];function B(X,K){var ie,ce,b,me,_e;for(ie=0;ie<P.length;ie++)for(ce=w[P[ie]],b=0;b<ce.length;b++)if(me=b+1,me%=ce.length,_e=i(X,K,ce[b],ce[me],!0),_e.length>0)return!0;return!1}for(var F,N,W,I,k,T,O=[],G,j,Z,Q,R=0,A=w.length;R<A;R++)P.push(R);for(var D=0,H=P.length*2;P.length>0;){if(H--,H<0){console.log("Infinite Loop! Holes left:"+P.length+", Probably Hole outside Shape!");break}for(N=D;N<E.length;N++){W=E[N],F=-1;for(var R=0;R<P.length;R++)if(k=P[R],T=W.x+":"+W.y+":"+k,O[T]===void 0){S=w[k];for(var Y=0;Y<S.length;Y++)if(I=S[Y],!!U(N,Y)&&!C(W,I)&&!B(W,I)){F=Y,P.splice(R,1),G=E.slice(0,N+1),j=E.slice(N),Z=S.slice(F),Q=S.slice(0,F+1),E=G.concat(Z).concat(Q).concat(j),D=N;break}if(F>=0)break;O[T]=!0}if(F>=0)break}}return E}for(var s,c,u,h,l,f,d={},p=e.concat(),m=0,y=t.length;m<y;m++)Array.prototype.push.apply(p,t[m]);for(s=0,c=p.length;s<c;s++)l=p[s].x+":"+p[s].y,d[l]!==void 0&&console.warn("THREE.Shape: Duplicate point",l),d[l]=s;var g=o(e,t),x=n.ShapeUtils.triangulate(g,!1);for(s=0,c=x.length;s<c;s++)for(h=x[s],u=0;u<3;u++)l=h[u].x+":"+h[u].y,f=d[l],f!==void 0&&(h[u]=f);return x.concat()},isClockWise:function(e){return n.ShapeUtils.area(e)<0},b2:function(){function e(i,a){var o=1-i;return o*o*a}function t(i,a){return 2*(1-i)*i*a}function r(i,a){return i*i*a}return function(i,a,o,s){return e(i,a)+t(i,o)+r(i,s)}}(),b3:function(){function e(a,o){var s=1-a;return s*s*s*o}function t(a,o){var s=1-a;return 3*s*s*a*o}function r(a,o){var s=1-a;return 3*s*a*a*o}function i(a,o){return a*a*a*o}return function(a,o,s,c,u){return e(a,o)+t(a,s)+r(a,c)+i(a,u)}}()},n.Curve=function(){},n.Curve.prototype={constructor:n.Curve,getPoint:function(e){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},getPoints:function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPoint(t/e));return r},getSpacedPoints:function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPointAt(t/e));return r},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],r,i=this.getPoint(0),a,o=0;for(t.push(0),a=1;a<=e;a++)r=this.getPoint(a/e),o+=r.distanceTo(i),t.push(o),i=r;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r=this.getLengths(),i=0,a=r.length,o;t?o=t:o=e*r[a-1];for(var s=0,c=a-1,u;s<=c;)if(i=Math.floor(s+(c-s)/2),u=r[i]-o,u<0)s=i+1;else if(u>0)c=i-1;else{c=i;break}if(i=c,r[i]===o){var p=i/(a-1);return p}var h=r[i],l=r[i+1],f=l-h,d=(o-h)/f,p=(i+d)/(a-1);return p},getTangent:function(e){var t=1e-4,r=e-t,i=e+t;r<0&&(r=0),i>1&&(i=1);var a=this.getPoint(r),o=this.getPoint(i),s=o.clone().sub(a);return s.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)}},n.Curve.create=function(e,t){return e.prototype=Object.create(n.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},n.CurvePath=function(){this.curves=[],this.autoClose=!1},n.CurvePath.prototype=Object.assign(Object.create(n.Curve.prototype),{constructor:n.CurvePath,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new n.LineCurve(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=t){var a=r[i]-t,o=this.curves[i],s=1-a/o.getLength();return o.getPointAt(s)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},createPointsGeometry:function(e){var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){for(var t=new n.Geometry,r=0,i=e.length;r<i;r++){var a=e[r];t.vertices.push(new n.Vector3(a.x,a.y,a.z||0))}return t}}),n.Font=function(e){this.data=e},Object.assign(n.Font.prototype,{generateShapes:function(e,t,r){function i(l){for(var f=String(l).split(""),d=t/o.resolution,p=0,m=[],y=0;y<f.length;y++){var g=a(f[y],d,p);p+=g.offset,m.push(g.path)}return m}function a(l,f,d){var p=o.glyphs[l]||o.glyphs["?"];if(p){var m=new n.Path,y=[],g=n.ShapeUtils.b2,x=n.ShapeUtils.b3,M,w,E,S,U,C,P,B,F,N,W;if(p.o)for(var I=p._cachedOutline||(p._cachedOutline=p.o.split(" ")),k=0,T=I.length;k<T;){var O=I[k++];switch(O){case"m":M=I[k++]*f+d,w=I[k++]*f,m.moveTo(M,w);break;case"l":M=I[k++]*f+d,w=I[k++]*f,m.lineTo(M,w);break;case"q":if(E=I[k++]*f+d,S=I[k++]*f,P=I[k++]*f+d,B=I[k++]*f,m.quadraticCurveTo(P,B,E,S),W=y[y.length-1],W){U=W.x,C=W.y;for(var G=1;G<=r;G++){var j=G/r;g(j,U,P,E),g(j,C,B,S)}}break;case"b":if(E=I[k++]*f+d,S=I[k++]*f,P=I[k++]*f+d,B=I[k++]*f,F=I[k++]*f+d,N=I[k++]*f,m.bezierCurveTo(P,B,F,N,E,S),W=y[y.length-1],W){U=W.x,C=W.y;for(var G=1;G<=r;G++){var j=G/r;x(j,U,P,F,E),x(j,C,B,N,S)}}break}}return{offset:p.ha*f,path:m}}}t===void 0&&(t=100),r===void 0&&(r=4);for(var o=this.data,s=i(e),c=[],u=0,h=s.length;u<h;u++)Array.prototype.push.apply(c,s[u].toShapes());return c}}),n.Path=function(e){n.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},n.Path.prototype=Object.assign(Object.create(n.CurvePath.prototype),{constructor:n.Path,fromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.actions.push({action:"moveTo",args:[e,t]})},lineTo:function(e,t){var r=this.actions[this.actions.length-1].args,i=r[r.length-2],a=r[r.length-1],o=new n.LineCurve(new n.Vector2(i,a),new n.Vector2(e,t));this.curves.push(o),this.actions.push({action:"lineTo",args:[e,t]})},quadraticCurveTo:function(e,t,r,i){var a=this.actions[this.actions.length-1].args,o=a[a.length-2],s=a[a.length-1],c=new n.QuadraticBezierCurve(new n.Vector2(o,s),new n.Vector2(e,t),new n.Vector2(r,i));this.curves.push(c),this.actions.push({action:"quadraticCurveTo",args:[e,t,r,i]})},bezierCurveTo:function(e,t,r,i,a,o){var s=this.actions[this.actions.length-1].args,c=s[s.length-2],u=s[s.length-1],h=new n.CubicBezierCurve(new n.Vector2(c,u),new n.Vector2(e,t),new n.Vector2(r,i),new n.Vector2(a,o));this.curves.push(h),this.actions.push({action:"bezierCurveTo",args:[e,t,r,i,a,o]})},splineThru:function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],a=r[r.length-1],o=[new n.Vector2(i,a)];Array.prototype.push.apply(o,e);var s=new n.SplineCurve(o);this.curves.push(s),this.actions.push({action:"splineThru",args:t})},arc:function(e,t,r,i,a,o){var s=this.actions[this.actions.length-1].args,c=s[s.length-2],u=s[s.length-1];this.absarc(e+c,t+u,r,i,a,o)},absarc:function(e,t,r,i,a,o){this.absellipse(e,t,r,r,i,a,o)},ellipse:function(e,t,r,i,a,o,s,c){var u=this.actions[this.actions.length-1].args,h=u[u.length-2],l=u[u.length-1];this.absellipse(e+h,t+l,r,i,a,o,s,c)},absellipse:function(e,t,r,i,a,o,s,c){var u=[e,t,r,i,a,o,s,c||0],h=new n.EllipseCurve(e,t,r,i,a,o,s,c);this.curves.push(h);var l=h.getPoint(1);u.push(l.x),u.push(l.y),this.actions.push({action:"ellipse",args:u})},getSpacedPoints:function(e){e||(e=40);for(var t=[],r=0;r<e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t=n.ShapeUtils.b2,r=n.ShapeUtils.b3,i=[],a,o,s,c,u,h,l,f,d,p,m,y=0,g=this.actions.length;y<g;y++){var x=this.actions[y],M=x.action,w=x.args;switch(M){case"moveTo":i.push(new n.Vector2(w[0],w[1]));break;case"lineTo":i.push(new n.Vector2(w[0],w[1]));break;case"quadraticCurveTo":a=w[2],o=w[3],u=w[0],h=w[1],i.length>0?(d=i[i.length-1],l=d.x,f=d.y):(d=this.actions[y-1].args,l=d[d.length-2],f=d[d.length-1]);for(var E=1;E<=e;E++){var S=E/e;p=t(S,l,u,a),m=t(S,f,h,o),i.push(new n.Vector2(p,m))}break;case"bezierCurveTo":a=w[4],o=w[5],u=w[0],h=w[1],s=w[2],c=w[3],i.length>0?(d=i[i.length-1],l=d.x,f=d.y):(d=this.actions[y-1].args,l=d[d.length-2],f=d[d.length-1]);for(var E=1;E<=e;E++){var S=E/e;p=r(S,l,u,s,a),m=r(S,f,h,c,o),i.push(new n.Vector2(p,m))}break;case"splineThru":d=this.actions[y-1].args;var U=new n.Vector2(d[d.length-2],d[d.length-1]),C=[U],P=e*w[0].length;C=C.concat(w[0]);for(var B=new n.SplineCurve(C),E=1;E<=P;E++)i.push(B.getPointAt(E/P));break;case"arc":for(var N=w[0],W=w[1],F=w[2],T=w[3],O=w[4],G=!!w[5],Z=O-T,Q,R=e*2,E=1;E<=R;E++){var S=E/R;G||(S=1-S),Q=T+S*Z,p=N+F*Math.cos(Q),m=W+F*Math.sin(Q),i.push(new n.Vector2(p,m))}break;case"ellipse":var N=w[0],W=w[1],I=w[2],k=w[3],T=w[4],O=w[5],G=!!w[6],j=w[7],Z=O-T,Q,R=e*2,A,D;j!==0&&(A=Math.cos(j),D=Math.sin(j));for(var E=1;E<=R;E++){var S=E/R;if(G||(S=1-S),Q=T+S*Z,p=N+I*Math.cos(Q),m=W+k*Math.sin(Q),j!==0){var H=p,Y=m;p=(H-N)*A-(Y-W)*D+N,m=(H-N)*D+(Y-W)*A+W}i.push(new n.Vector2(p,m))}break}}var X=i[i.length-1];return Math.abs(X.x-i[0].x)<Number.EPSILON&&Math.abs(X.y-i[0].y)<Number.EPSILON&&i.splice(i.length-1,1),this.autoClose&&i.push(i[0]),i},toShapes:function(e,t){function r(O){for(var G=[],j=new n.Path,Z=0,Q=O.length;Z<Q;Z++){var R=O[Z],A=R.args,D=R.action;D==="moveTo"&&j.actions.length!==0&&(G.push(j),j=new n.Path),j[D].apply(j,A)}return j.actions.length!==0&&G.push(j),G}function i(O){for(var G=[],j=0,Z=O.length;j<Z;j++){var Q=O[j],R=new n.Shape;R.actions=Q.actions,R.curves=Q.curves,G.push(R)}return G}function a(O,G){for(var j=G.length,Z=!1,Q=j-1,R=0;R<j;Q=R++){var A=G[Q],D=G[R],H=D.x-A.x,Y=D.y-A.y;if(Math.abs(Y)>Number.EPSILON){if(Y<0&&(A=G[R],H=-H,D=G[Q],Y=-Y),O.y<A.y||O.y>D.y)continue;if(O.y===A.y){if(O.x===A.x)return!0}else{var X=Y*(O.x-A.x)-H*(O.y-A.y);if(X===0)return!0;if(X<0)continue;Z=!Z}}else{if(O.y!==A.y)continue;if(D.x<=O.x&&O.x<=A.x||A.x<=O.x&&O.x<=D.x)return!0}}return Z}var o=n.ShapeUtils.isClockWise,s=r(this.actions);if(s.length===0)return[];if(t===!0)return i(s);var c,u,h,l=[];if(s.length===1)return u=s[0],h=new n.Shape,h.actions=u.actions,h.curves=u.curves,l.push(h),l;var f=!o(s[0].getPoints());f=e?!f:f;var d=[],p=[],m=[],y=0,g;p[y]=void 0,m[y]=[];for(var x=0,M=s.length;x<M;x++)u=s[x],g=u.getPoints(),c=o(g),c=e?!c:c,c?(!f&&p[y]&&y++,p[y]={s:new n.Shape,p:g},p[y].s.actions=u.actions,p[y].s.curves=u.curves,f&&y++,m[y]=[]):m[y].push({h:u,p:g[0]});if(!p[0])return i(s);if(p.length>1){for(var w=!1,E=[],S=0,U=p.length;S<U;S++)d[S]=[];for(var S=0,U=p.length;S<U;S++)for(var C=m[S],P=0;P<C.length;P++){for(var B=C[P],F=!0,N=0;N<p.length;N++)a(B.p,p[N].p)&&(S!==N&&E.push({froms:S,tos:N,hole:P}),F?(F=!1,d[N].push(B)):w=!0);F&&d[S].push(B)}E.length>0&&(w||(m=d))}for(var W,x=0,I=p.length;x<I;x++){h=p[x].s,l.push(h),W=m[x];for(var k=0,T=W.length;k<T;k++)h.holes.push(W[k].h)}return l}}),n.Shape=function(){n.Path.apply(this,arguments),this.holes=[]},n.Shape.prototype=Object.assign(Object.create(n.Path.prototype),{constructor:n.Shape,extrude:function(e){return new n.ExtrudeGeometry(this,e)},makeGeometry:function(e){return new n.ShapeGeometry(this,e)},getPointsHoles:function(e){for(var t=[],r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t},extractAllPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},extractPoints:function(e){return this.extractAllPoints(e)}}),n.LineCurve=function(e,t){this.v1=e,this.v2=t},n.LineCurve.prototype=Object.create(n.Curve.prototype),n.LineCurve.prototype.constructor=n.LineCurve,n.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},n.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},n.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},n.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},n.QuadraticBezierCurve.prototype=Object.create(n.Curve.prototype),n.QuadraticBezierCurve.prototype.constructor=n.QuadraticBezierCurve,n.QuadraticBezierCurve.prototype.getPoint=function(e){var t=n.ShapeUtils.b2;return new n.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y))},n.QuadraticBezierCurve.prototype.getTangent=function(e){var t=n.CurveUtils.tangentQuadraticBezier;return new n.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y)).normalize()},n.CubicBezierCurve=function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},n.CubicBezierCurve.prototype=Object.create(n.Curve.prototype),n.CubicBezierCurve.prototype.constructor=n.CubicBezierCurve,n.CubicBezierCurve.prototype.getPoint=function(e){var t=n.ShapeUtils.b3;return new n.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},n.CubicBezierCurve.prototype.getTangent=function(e){var t=n.CurveUtils.tangentCubicBezier;return new n.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},n.SplineCurve=function(e){this.points=e??[]},n.SplineCurve.prototype=Object.create(n.Curve.prototype),n.SplineCurve.prototype.constructor=n.SplineCurve,n.SplineCurve.prototype.getPoint=function(e){var t=this.points,r=(t.length-1)*e,i=Math.floor(r),a=r-i,o=t[i===0?i:i-1],s=t[i],c=t[i>t.length-2?t.length-1:i+1],u=t[i>t.length-3?t.length-1:i+2],h=n.CurveUtils.interpolate;return new n.Vector2(h(o.x,s.x,c.x,u.x,a),h(o.y,s.y,c.y,u.y,a))},n.EllipseCurve=function(e,t,r,i,a,o,s,c){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=a,this.aEndAngle=o,this.aClockwise=s,this.aRotation=c||0},n.EllipseCurve.prototype=Object.create(n.Curve.prototype),n.EllipseCurve.prototype.constructor=n.EllipseCurve,n.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;t<0&&(t+=Math.PI*2),t>Math.PI*2&&(t-=Math.PI*2);var r;this.aClockwise===!0?r=this.aEndAngle+(1-e)*(Math.PI*2-t):r=this.aStartAngle+e*t;var i=this.aX+this.xRadius*Math.cos(r),a=this.aY+this.yRadius*Math.sin(r);if(this.aRotation!==0){var o=Math.cos(this.aRotation),s=Math.sin(this.aRotation),c=i,u=a;i=(c-this.aX)*o-(u-this.aY)*s+this.aX,a=(c-this.aX)*s+(u-this.aY)*o+this.aY}return new n.Vector2(i,a)},n.ArcCurve=function(e,t,r,i,a,o){n.EllipseCurve.call(this,e,t,r,r,i,a,o)},n.ArcCurve.prototype=Object.create(n.EllipseCurve.prototype),n.ArcCurve.prototype.constructor=n.ArcCurve,n.LineCurve3=n.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new n.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),n.QuadraticBezierCurve3=n.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t=n.ShapeUtils.b2;return new n.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y),t(e,this.v0.z,this.v1.z,this.v2.z))}),n.CubicBezierCurve3=n.Curve.create(function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},function(e){var t=n.ShapeUtils.b3;return new n.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),n.SplineCurve3=n.Curve.create(function(e){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=e??[]},function(e){var t=this.points,r=(t.length-1)*e,i=Math.floor(r),a=r-i,o=t[i==0?i:i-1],s=t[i],c=t[i>t.length-2?t.length-1:i+1],u=t[i>t.length-3?t.length-1:i+2],h=n.CurveUtils.interpolate;return new n.Vector3(h(o.x,s.x,c.x,u.x,a),h(o.y,s.y,c.y,u.y,a),h(o.z,s.z,c.z,u.z,a))}),n.CatmullRomCurve3=function(){var e=new n.Vector3,t=new a,r=new a,i=new a;function a(){}return a.prototype.init=function(o,s,c,u){this.c0=o,this.c1=c,this.c2=-3*o+3*s-2*c-u,this.c3=2*o-2*s+c+u},a.prototype.initNonuniformCatmullRom=function(o,s,c,u,h,l,f){var d=(s-o)/h-(c-o)/(h+l)+(c-s)/l,p=(c-s)/l-(u-s)/(l+f)+(u-c)/f;d*=l,p*=l,this.init(s,c,d,p)},a.prototype.initCatmullRom=function(o,s,c,u,h){this.init(s,c,h*(c-o),h*(u-s))},a.prototype.calc=function(o){var s=o*o,c=s*o;return this.c0+this.c1*o+this.c2*s+this.c3*c},n.Curve.create(function(o){this.points=o||[],this.closed=!1},function(o){var s=this.points,c,u,h,l;l=s.length,l<2&&console.log("duh, you need at least 2 points"),c=(l-(this.closed?0:1))*o,u=Math.floor(c),h=c-u,this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/s.length)+1)*s.length:h===0&&u===l-1&&(u=l-2,h=1);var f,d,p,m;if(this.closed||u>0?f=s[(u-1)%l]:(e.subVectors(s[0],s[1]).add(s[0]),f=e),d=s[u%l],p=s[(u+1)%l],this.closed||u+2<l?m=s[(u+2)%l]:(e.subVectors(s[l-1],s[l-2]).add(s[l-1]),m=e),this.type===void 0||this.type==="centripetal"||this.type==="chordal"){var y=this.type==="chordal"?.5:.25,g=Math.pow(f.distanceToSquared(d),y),x=Math.pow(d.distanceToSquared(p),y),M=Math.pow(p.distanceToSquared(m),y);x<1e-4&&(x=1),g<1e-4&&(g=x),M<1e-4&&(M=x),t.initNonuniformCatmullRom(f.x,d.x,p.x,m.x,g,x,M),r.initNonuniformCatmullRom(f.y,d.y,p.y,m.y,g,x,M),i.initNonuniformCatmullRom(f.z,d.z,p.z,m.z,g,x,M)}else if(this.type==="catmullrom"){var w=this.tension!==void 0?this.tension:.5;t.initCatmullRom(f.x,d.x,p.x,m.x,w),r.initCatmullRom(f.y,d.y,p.y,m.y,w),i.initCatmullRom(f.z,d.z,p.z,m.z,w)}var E=new n.Vector3(t.calc(h),r.calc(h),i.calc(h));return E})}(),n.ClosedSplineCurve3=function(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3."),n.CatmullRomCurve3.call(this,e),this.type="catmullrom",this.closed=!0},n.ClosedSplineCurve3.prototype=Object.create(n.CatmullRomCurve3.prototype),n.BoxGeometry=function(e,t,r,i,a,o){n.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:a,depthSegments:o},this.fromBufferGeometry(new n.BoxBufferGeometry(e,t,r,i,a,o)),this.mergeVertices()},n.BoxGeometry.prototype=Object.create(n.Geometry.prototype),n.BoxGeometry.prototype.constructor=n.BoxGeometry,n.CubeGeometry=n.BoxGeometry,n.BoxBufferGeometry=function(e,t,r,i,a,o){n.BufferGeometry.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:a,depthSegments:o};var s=this;i=Math.floor(i)||1,a=Math.floor(a)||1,o=Math.floor(o)||1;var c=M(i,a,o),u=w(i,a,o),h=new(u>65535?Uint32Array:Uint16Array)(u),l=new Float32Array(c*3),f=new Float32Array(c*3),d=new Float32Array(c*2),p=0,m=0,y=0,g=0,x=0;E("z","y","x",-1,-1,r,t,e,o,a,0),E("z","y","x",1,-1,r,t,-e,o,a,1),E("x","z","y",1,1,e,r,t,i,o,2),E("x","z","y",1,-1,e,r,-t,i,o,3),E("x","y","z",1,-1,e,t,r,i,a,4),E("x","y","z",-1,-1,e,t,-r,i,a,5),this.setIndex(new n.BufferAttribute(h,1)),this.addAttribute("position",new n.BufferAttribute(l,3)),this.addAttribute("normal",new n.BufferAttribute(f,3)),this.addAttribute("uv",new n.BufferAttribute(d,2));function M(S,U,C){var P=0;return P+=(S+1)*(U+1)*2,P+=(S+1)*(C+1)*2,P+=(C+1)*(U+1)*2,P}function w(S,U,C){var P=0;return P+=S*U*2,P+=S*C*2,P+=C*U*2,P*6}function E(S,U,C,P,B,F,N,W,I,k,T){for(var O=F/I,G=N/k,j=F/2,Z=N/2,Q=W/2,R=I+1,A=k+1,D=0,H=0,Y=new n.Vector3,X=0;X<A;X++)for(var K=X*G-Z,ie=0;ie<R;ie++){var ce=ie*O-j;Y[S]=ce*P,Y[U]=K*B,Y[C]=Q,l[p]=Y.x,l[p+1]=Y.y,l[p+2]=Y.z,Y[S]=0,Y[U]=0,Y[C]=W>0?1:-1,f[p]=Y.x,f[p+1]=Y.y,f[p+2]=Y.z,d[m]=ie/I,d[m+1]=1-X/k,p+=3,m+=2,D+=1}for(X=0;X<k;X++)for(ie=0;ie<I;ie++){var b=g+ie+R*X,me=g+ie+R*(X+1),_e=g+(ie+1)+R*(X+1),he=g+(ie+1)+R*X;h[y]=b,h[y+1]=me,h[y+2]=he,h[y+3]=me,h[y+4]=_e,h[y+5]=he,y+=6,H+=6}s.addGroup(x,H,T),x+=H,g+=D}},n.BoxBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.BoxBufferGeometry.prototype.constructor=n.BoxBufferGeometry,n.CircleGeometry=function(e,t,r,i){n.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new n.CircleBufferGeometry(e,t,r,i))},n.CircleGeometry.prototype=Object.create(n.Geometry.prototype),n.CircleGeometry.prototype.constructor=n.CircleGeometry,n.CircleBufferGeometry=function(e,t,r,i){n.BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},e=e||50,t=t!==void 0?Math.max(3,t):8,r=r!==void 0?r:0,i=i!==void 0?i:Math.PI*2;var a=t+2,o=new Float32Array(a*3),s=new Float32Array(a*3),c=new Float32Array(a*2);s[2]=1,c[0]=.5,c[1]=.5;for(var u=0,h=3,l=2;u<=t;u++,h+=3,l+=2){var f=r+u/t*i;o[h]=e*Math.cos(f),o[h+1]=e*Math.sin(f),s[h+2]=1,c[l]=(o[h]/e+1)/2,c[l+1]=(o[h+1]/e+1)/2}for(var d=[],h=1;h<=t;h++)d.push(h,h+1,0);this.setIndex(new n.BufferAttribute(new Uint16Array(d),1)),this.addAttribute("position",new n.BufferAttribute(o,3)),this.addAttribute("normal",new n.BufferAttribute(s,3)),this.addAttribute("uv",new n.BufferAttribute(c,2)),this.boundingSphere=new n.Sphere(new n.Vector3,e)},n.CircleBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.CircleBufferGeometry.prototype.constructor=n.CircleBufferGeometry,n.CylinderBufferGeometry=function(e,t,r,i,a,o,s,c){n.BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:a,openEnded:o,thetaStart:s,thetaLength:c};var u=this;e=e!==void 0?e:20,t=t!==void 0?t:20,r=r!==void 0?r:100,i=Math.floor(i)||8,a=Math.floor(a)||1,o=o!==void 0?o:!1,s=s!==void 0?s:0,c=c!==void 0?c:2*Math.PI;var h=0;o===!1&&(e>0&&h++,t>0&&h++);var l=S(),f=U(),d=new n.BufferAttribute(new(f>65535?Uint32Array:Uint16Array)(f),1),p=new n.BufferAttribute(new Float32Array(l*3),3),m=new n.BufferAttribute(new Float32Array(l*3),3),y=new n.BufferAttribute(new Float32Array(l*2),2),g=0,x=0,M=[],w=r/2,E=0;C(),o===!1&&(e>0&&P(!0),t>0&&P(!1)),this.setIndex(d),this.addAttribute("position",p),this.addAttribute("normal",m),this.addAttribute("uv",y);function S(){var B=(i+1)*(a+1);return o===!1&&(B+=(i+1)*h+i*h),B}function U(){var B=i*a*2*3;return o===!1&&(B+=i*h*3),B}function C(){var B,F,N=new n.Vector3,W=new n.Vector3,I=0,k=(t-e)/r;for(F=0;F<=a;F++){var T=[],O=F/a,G=O*(t-e)+e;for(B=0;B<=i;B++){var j=B/i;W.x=G*Math.sin(j*c+s),W.y=-O*r+w,W.z=G*Math.cos(j*c+s),p.setXYZ(g,W.x,W.y,W.z),N.copy(W),(e===0&&F===0||t===0&&F===a)&&(N.x=Math.sin(j*c+s),N.z=Math.cos(j*c+s)),N.setY(Math.sqrt(N.x*N.x+N.z*N.z)*k).normalize(),m.setXYZ(g,N.x,N.y,N.z),y.setXY(g,j,1-O),T.push(g),g++}M.push(T)}for(B=0;B<i;B++)for(F=0;F<a;F++){var Z=M[F][B],Q=M[F+1][B],R=M[F+1][B+1],A=M[F][B+1];d.setX(x,Z),x++,d.setX(x,Q),x++,d.setX(x,A),x++,d.setX(x,Q),x++,d.setX(x,R),x++,d.setX(x,A),x++,I+=6}u.addGroup(E,I,0),E+=I}function P(B){var F,N,W,I=new n.Vector2,k=new n.Vector3,T=0,O=B===!0?e:t,G=B===!0?1:-1;for(N=g,F=1;F<=i;F++)p.setXYZ(g,0,w*G,0),m.setXYZ(g,0,G,0),I.x=.5,I.y=.5,y.setXY(g,I.x,I.y),g++;for(W=g,F=0;F<=i;F++){var j=F/i,Z=j*c+s,Q=Math.cos(Z),R=Math.sin(Z);k.x=O*R,k.y=w*G,k.z=O*Q,p.setXYZ(g,k.x,k.y,k.z),m.setXYZ(g,0,G,0),I.x=Q*.5+.5,I.y=R*.5*G+.5,y.setXY(g,I.x,I.y),g++}for(F=0;F<i;F++){var A=N+F,D=W+F;B===!0?(d.setX(x,D),x++,d.setX(x,D+1),x++,d.setX(x,A),x++):(d.setX(x,D+1),x++,d.setX(x,D),x++,d.setX(x,A),x++),T+=3}u.addGroup(E,T,B===!0?1:2),E+=T}},n.CylinderBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.CylinderBufferGeometry.prototype.constructor=n.CylinderBufferGeometry,n.CylinderGeometry=function(e,t,r,i,a,o,s,c){n.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:a,openEnded:o,thetaStart:s,thetaLength:c},this.fromBufferGeometry(new n.CylinderBufferGeometry(e,t,r,i,a,o,s,c)),this.mergeVertices()},n.CylinderGeometry.prototype=Object.create(n.Geometry.prototype),n.CylinderGeometry.prototype.constructor=n.CylinderGeometry,n.ConeBufferGeometry=function(e,t,r,i,a,o,s){n.CylinderBufferGeometry.call(this,0,e,t,r,i,a,o,s),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,thetaStart:o,thetaLength:s}},n.ConeBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.ConeBufferGeometry.prototype.constructor=n.ConeBufferGeometry,n.ConeGeometry=function(e,t,r,i,a,o,s){n.CylinderGeometry.call(this,0,e,t,r,i,a,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s}},n.ConeGeometry.prototype=Object.create(n.CylinderGeometry.prototype),n.ConeGeometry.prototype.constructor=n.ConeGeometry,n.EdgesGeometry=function(e,t){n.BufferGeometry.call(this),t=t!==void 0?t:1;var r=Math.cos(n.Math.DEG2RAD*t),i=[0,0],a={};function o(M,w){return M-w}var s=["a","b","c"],c;e instanceof n.BufferGeometry?(c=new n.Geometry,c.fromBufferGeometry(e)):c=e.clone(),c.mergeVertices(),c.computeFaceNormals();for(var u=c.vertices,h=c.faces,l=0,f=h.length;l<f;l++)for(var d=h[l],p=0;p<3;p++){i[0]=d[s[p]],i[1]=d[s[(p+1)%3]],i.sort(o);var m=i.toString();a[m]===void 0?a[m]={vert1:i[0],vert2:i[1],face1:l,face2:void 0}:a[m].face2=l}var y=[];for(var m in a){var g=a[m];if(g.face2===void 0||h[g.face1].normal.dot(h[g.face2].normal)<=r){var x=u[g.vert1];y.push(x.x),y.push(x.y),y.push(x.z),x=u[g.vert2],y.push(x.x),y.push(x.y),y.push(x.z)}}this.addAttribute("position",new n.BufferAttribute(new Float32Array(y),3))},n.EdgesGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.EdgesGeometry.prototype.constructor=n.EdgesGeometry,n.ExtrudeGeometry=function(e,t){if(typeof e>"u"){e=[];return}n.Geometry.call(this),this.type="ExtrudeGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeFaceNormals()},n.ExtrudeGeometry.prototype=Object.create(n.Geometry.prototype),n.ExtrudeGeometry.prototype.constructor=n.ExtrudeGeometry,n.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,i=0;i<r;i++){var a=e[i];this.addShape(a,t)}},n.ExtrudeGeometry.prototype.addShape=function(e,t){var r=t.amount!==void 0?t.amount:100,i=t.bevelThickness!==void 0?t.bevelThickness:6,a=t.bevelSize!==void 0?t.bevelSize:i-2,o=t.bevelSegments!==void 0?t.bevelSegments:3,s=t.bevelEnabled!==void 0?t.bevelEnabled:!0,c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,h=t.extrudePath,l,f=!1,d=t.UVGenerator!==void 0?t.UVGenerator:n.ExtrudeGeometry.WorldUVGenerator,p,m,y,g;h&&(l=h.getSpacedPoints(u),f=!0,s=!1,p=t.frames!==void 0?t.frames:new n.TubeGeometry.FrenetFrames(h,u,!1),m=new n.Vector3,y=new n.Vector3,g=new n.Vector3),s||(o=0,i=0,a=0);var x,M,w,E=this,S=this.vertices.length,U=e.extractPoints(c),C=U.shape,P=U.holes,B=!n.ShapeUtils.isClockWise(C);if(B){for(C=C.reverse(),M=0,w=P.length;M<w;M++)x=P[M],n.ShapeUtils.isClockWise(x)&&(P[M]=x.reverse());B=!1}var F=n.ShapeUtils.triangulateShape(C,P),N=C;for(M=0,w=P.length;M<w;M++)x=P[M],C=C.concat(x);function W(le,de,ge){return de||console.error("THREE.ExtrudeGeometry: vec does not exist"),de.clone().multiplyScalar(ge).add(le)}var I,k,T,O,G,j=C.length,Z,Q=F.length;function R(le,de,ge){var xe,Ee,Re=1,Me=le.x-de.x,Ae=le.y-de.y,Le=ge.x-le.x,Se=ge.y-le.y,Ge=Me*Me+Ae*Ae,Ve=Me*Se-Ae*Le;if(Math.abs(Ve)>Number.EPSILON){var ze=Math.sqrt(Ge),Oe=Math.sqrt(Le*Le+Se*Se),ke=de.x-Ae/ze,He=de.y+Me/ze,Je=ge.x-Se/Oe,$e=ge.y+Le/Oe,je=((Je-ke)*Se-($e-He)*Le)/(Me*Se-Ae*Le);xe=ke+Me*je-le.x,Ee=He+Ae*je-le.y;var We=xe*xe+Ee*Ee;if(We<=2)return new n.Vector2(xe,Ee);Re=Math.sqrt(We/2)}else{var Ne=!1;Me>Number.EPSILON?Le>Number.EPSILON&&(Ne=!0):Me<-Number.EPSILON?Le<-Number.EPSILON&&(Ne=!0):Math.sign(Ae)===Math.sign(Se)&&(Ne=!0),Ne?(xe=-Ae,Ee=Me,Re=Math.sqrt(Ge)):(xe=Me,Ee=Ae,Re=Math.sqrt(Ge/2))}return new n.Vector2(xe/Re,Ee/Re)}for(var A=[],D=0,H=N.length,Y=H-1,X=D+1;D<H;D++,Y++,X++)Y===H&&(Y=0),X===H&&(X=0),A[D]=R(N[D],N[Y],N[X]);var K=[],ie,ce=A.concat();for(M=0,w=P.length;M<w;M++){for(x=P[M],ie=[],D=0,H=x.length,Y=H-1,X=D+1;D<H;D++,Y++,X++)Y===H&&(Y=0),X===H&&(X=0),ie[D]=R(x[D],x[Y],x[X]);K.push(ie),ce=ce.concat(ie)}for(I=0;I<o;I++){for(T=I/o,O=i*(1-T),k=a*Math.sin(T*Math.PI/2),D=0,H=N.length;D<H;D++)G=W(N[D],A[D],k),pe(G.x,G.y,-O);for(M=0,w=P.length;M<w;M++)for(x=P[M],ie=K[M],D=0,H=x.length;D<H;D++)G=W(x[D],ie[D],k),pe(G.x,G.y,-O)}for(k=a,D=0;D<j;D++)G=s?W(C[D],ce[D],k):C[D],f?(y.copy(p.normals[0]).multiplyScalar(G.x),m.copy(p.binormals[0]).multiplyScalar(G.y),g.copy(l[0]).add(y).add(m),pe(g.x,g.y,g.z)):pe(G.x,G.y,0);var b;for(b=1;b<=u;b++)for(D=0;D<j;D++)G=s?W(C[D],ce[D],k):C[D],f?(y.copy(p.normals[b]).multiplyScalar(G.x),m.copy(p.binormals[b]).multiplyScalar(G.y),g.copy(l[b]).add(y).add(m),pe(g.x,g.y,g.z)):pe(G.x,G.y,r/u*b);for(I=o-1;I>=0;I--){for(T=I/o,O=i*(1-T),k=a*Math.sin(T*Math.PI/2),D=0,H=N.length;D<H;D++)G=W(N[D],A[D],k),pe(G.x,G.y,r+O);for(M=0,w=P.length;M<w;M++)for(x=P[M],ie=K[M],D=0,H=x.length;D<H;D++)G=W(x[D],ie[D],k),f?pe(G.x,G.y+l[u-1].y,l[u-1].x+O):pe(G.x,G.y,r+O)}me(),_e();function me(){if(s){var le=0,de=j*le;for(D=0;D<Q;D++)Z=F[D],J(Z[2]+de,Z[1]+de,Z[0]+de);for(le=u+o*2,de=j*le,D=0;D<Q;D++)Z=F[D],J(Z[0]+de,Z[1]+de,Z[2]+de)}else{for(D=0;D<Q;D++)Z=F[D],J(Z[2],Z[1],Z[0]);for(D=0;D<Q;D++)Z=F[D],J(Z[0]+j*u,Z[1]+j*u,Z[2]+j*u)}}function _e(){var le=0;for(he(N,le),le+=N.length,M=0,w=P.length;M<w;M++)x=P[M],he(x,le),le+=x.length}function he(le,de){var ge,xe;for(D=le.length;--D>=0;){ge=D,xe=D-1,xe<0&&(xe=le.length-1);var Ee=0,Re=u+o*2;for(Ee=0;Ee<Re;Ee++){var Me=j*Ee,Ae=j*(Ee+1),Le=de+ge+Me,Se=de+xe+Me,Ge=de+xe+Ae,Ve=de+ge+Ae;fe(Le,Se,Ge,Ve)}}}function pe(le,de,ge){E.vertices.push(new n.Vector3(le,de,ge))}function J(le,de,ge){le+=S,de+=S,ge+=S,E.faces.push(new n.Face3(le,de,ge,null,null,0));var xe=d.generateTopUV(E,le,de,ge);E.faceVertexUvs[0].push(xe)}function fe(le,de,ge,xe,Ee,Re,Me,Ae,Le){le+=S,de+=S,ge+=S,xe+=S,E.faces.push(new n.Face3(le,de,xe,null,null,1)),E.faces.push(new n.Face3(de,ge,xe,null,null,1));var Se=d.generateSideWallUV(E,le,de,ge,xe);E.faceVertexUvs[0].push([Se[0],Se[1],Se[3]]),E.faceVertexUvs[0].push([Se[1],Se[2],Se[3]])}},n.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,i){var a=e.vertices,o=a[t],s=a[r],c=a[i];return[new n.Vector2(o.x,o.y),new n.Vector2(s.x,s.y),new n.Vector2(c.x,c.y)]},generateSideWallUV:function(e,t,r,i,a){var o=e.vertices,s=o[t],c=o[r],u=o[i],h=o[a];return Math.abs(s.y-c.y)<.01?[new n.Vector2(s.x,1-s.z),new n.Vector2(c.x,1-c.z),new n.Vector2(u.x,1-u.z),new n.Vector2(h.x,1-h.z)]:[new n.Vector2(s.y,1-s.z),new n.Vector2(c.y,1-c.z),new n.Vector2(u.y,1-u.z),new n.Vector2(h.y,1-h.z)]}},n.ShapeGeometry=function(e,t){n.Geometry.call(this),this.type="ShapeGeometry",Array.isArray(e)===!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},n.ShapeGeometry.prototype=Object.create(n.Geometry.prototype),n.ShapeGeometry.prototype.constructor=n.ShapeGeometry,n.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;r<i;r++)this.addShape(e[r],t);return this},n.ShapeGeometry.prototype.addShape=function(e,t){t===void 0&&(t={});var r=t.curveSegments!==void 0?t.curveSegments:12,i=t.material,a=t.UVGenerator===void 0?n.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,o,s,c,u=this.vertices.length,h=e.extractPoints(r),l=h.shape,f=h.holes,d=!n.ShapeUtils.isClockWise(l);if(d){for(l=l.reverse(),o=0,s=f.length;o<s;o++)c=f[o],n.ShapeUtils.isClockWise(c)&&(f[o]=c.reverse());d=!1}var p=n.ShapeUtils.triangulateShape(l,f);for(o=0,s=f.length;o<s;o++)c=f[o],l=l.concat(c);var m,y=l.length,g,x=p.length;for(o=0;o<y;o++)m=l[o],this.vertices.push(new n.Vector3(m.x,m.y,0));for(o=0;o<x;o++){g=p[o];var M=g[0]+u,w=g[1]+u,E=g[2]+u;this.faces.push(new n.Face3(M,w,E,null,null,i)),this.faceVertexUvs[0].push(a.generateTopUV(this,M,w,E))}},n.LatheBufferGeometry=function(e,t,r,i){n.BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t)||12,r=r||0,i=i||Math.PI*2,i=n.Math.clamp(i,0,Math.PI*2);var a=(t+1)*e.length,o=t*e.length*2*3,s=new n.BufferAttribute(new(o>65535?Uint32Array:Uint16Array)(o),1),c=new n.BufferAttribute(new Float32Array(a*3),3),u=new n.BufferAttribute(new Float32Array(a*2),2),h=0,l=0,f;1/(e.length-1);var d=1/t,p=new n.Vector3,m=new n.Vector2,y,g;for(y=0;y<=t;y++){var x=r+y*d*i,M=Math.sin(x),w=Math.cos(x);for(g=0;g<=e.length-1;g++)p.x=e[g].x*M,p.y=e[g].y,p.z=e[g].x*w,c.setXYZ(h,p.x,p.y,p.z),m.x=y/t,m.y=g/(e.length-1),u.setXY(h,m.x,m.y),h++}for(y=0;y<t;y++)for(g=0;g<e.length-1;g++){f=g+y*e.length;var E=f,S=f+e.length,U=f+e.length+1,C=f+1;s.setX(l,E),l++,s.setX(l,S),l++,s.setX(l,C),l++,s.setX(l,S),l++,s.setX(l,U),l++,s.setX(l,C),l++}if(this.setIndex(s),this.addAttribute("position",c),this.addAttribute("uv",u),this.computeVertexNormals(),i===Math.PI*2){var P=this.attributes.normal.array,B=new n.Vector3,F=new n.Vector3,N=new n.Vector3;for(f=t*e.length*3,y=0,g=0;y<e.length;y++,g+=3)B.x=P[g+0],B.y=P[g+1],B.z=P[g+2],F.x=P[f+g+0],F.y=P[f+g+1],F.z=P[f+g+2],N.addVectors(B,F).normalize(),P[g+0]=P[f+g+0]=N.x,P[g+1]=P[f+g+1]=N.y,P[g+2]=P[f+g+2]=N.z}},n.LatheBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.LatheBufferGeometry.prototype.constructor=n.LatheBufferGeometry,n.LatheGeometry=function(e,t,r,i){n.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},this.fromBufferGeometry(new n.LatheBufferGeometry(e,t,r,i)),this.mergeVertices()},n.LatheGeometry.prototype=Object.create(n.Geometry.prototype),n.LatheGeometry.prototype.constructor=n.LatheGeometry,n.PlaneGeometry=function(e,t,r,i){n.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new n.PlaneBufferGeometry(e,t,r,i))},n.PlaneGeometry.prototype=Object.create(n.Geometry.prototype),n.PlaneGeometry.prototype.constructor=n.PlaneGeometry,n.PlaneBufferGeometry=function(e,t,r,i){n.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};for(var a=e/2,o=t/2,s=Math.floor(r)||1,c=Math.floor(i)||1,u=s+1,h=c+1,l=e/s,f=t/c,d=new Float32Array(u*h*3),p=new Float32Array(u*h*3),m=new Float32Array(u*h*2),y=0,g=0,x=0;x<h;x++)for(var M=x*f-o,w=0;w<u;w++){var E=w*l-a;d[y]=E,d[y+1]=-M,p[y+2]=1,m[g]=w/s,m[g+1]=1-x/c,y+=3,g+=2}y=0;for(var S=new(d.length/3>65535?Uint32Array:Uint16Array)(s*c*6),x=0;x<c;x++)for(var w=0;w<s;w++){var U=w+u*x,C=w+u*(x+1),P=w+1+u*(x+1),B=w+1+u*x;S[y]=U,S[y+1]=C,S[y+2]=B,S[y+3]=C,S[y+4]=P,S[y+5]=B,y+=6}this.setIndex(new n.BufferAttribute(S,1)),this.addAttribute("position",new n.BufferAttribute(d,3)),this.addAttribute("normal",new n.BufferAttribute(p,3)),this.addAttribute("uv",new n.BufferAttribute(m,2))},n.PlaneBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.PlaneBufferGeometry.prototype.constructor=n.PlaneBufferGeometry,n.RingBufferGeometry=function(e,t,r,i,a,o){n.BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:a,thetaLength:o},e=e||20,t=t||50,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,r=r!==void 0?Math.max(3,r):8,i=i!==void 0?Math.max(1,i):1;var s=(r+1)*(i+1),c=r*i*2*3,u=new n.BufferAttribute(new(c>65535?Uint32Array:Uint16Array)(c),1),h=new n.BufferAttribute(new Float32Array(s*3),3),l=new n.BufferAttribute(new Float32Array(s*3),3),f=new n.BufferAttribute(new Float32Array(s*2),2),d=0,p=0,m,y=e,g=(t-e)/i,x=new n.Vector3,M=new n.Vector2,w,E;for(w=0;w<=i;w++){for(E=0;E<=r;E++)m=a+E/r*o,x.x=y*Math.cos(m),x.y=y*Math.sin(m),h.setXYZ(d,x.x,x.y,x.z),l.setXYZ(d,0,0,1),M.x=(x.x/t+1)/2,M.y=(x.y/t+1)/2,f.setXY(d,M.x,M.y),d++;y+=g}for(w=0;w<i;w++){var S=w*(r+1);for(E=0;E<r;E++){m=E+S;var U=m,C=m+r+1,P=m+r+2,B=m+1;u.setX(p,U),p++,u.setX(p,C),p++,u.setX(p,P),p++,u.setX(p,U),p++,u.setX(p,P),p++,u.setX(p,B),p++}}this.setIndex(u),this.addAttribute("position",h),this.addAttribute("normal",l),this.addAttribute("uv",f)},n.RingBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.RingBufferGeometry.prototype.constructor=n.RingBufferGeometry,n.RingGeometry=function(e,t,r,i,a,o){n.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new n.RingBufferGeometry(e,t,r,i,a,o))},n.RingGeometry.prototype=Object.create(n.Geometry.prototype),n.RingGeometry.prototype.constructor=n.RingGeometry,n.SphereGeometry=function(e,t,r,i,a,o,s){n.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new n.SphereBufferGeometry(e,t,r,i,a,o,s))},n.SphereGeometry.prototype=Object.create(n.Geometry.prototype),n.SphereGeometry.prototype.constructor=n.SphereGeometry,n.SphereBufferGeometry=function(e,t,r,i,a,o,s){n.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:a,thetaStart:o,thetaLength:s},e=e||50,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),i=i!==void 0?i:0,a=a!==void 0?a:Math.PI*2,o=o!==void 0?o:0,s=s!==void 0?s:Math.PI;for(var c=o+s,u=(t+1)*(r+1),h=new n.BufferAttribute(new Float32Array(u*3),3),l=new n.BufferAttribute(new Float32Array(u*3),3),f=new n.BufferAttribute(new Float32Array(u*2),2),d=0,p=[],m=new n.Vector3,y=0;y<=r;y++){for(var g=[],x=y/r,M=0;M<=t;M++){var w=M/t,E=-e*Math.cos(i+w*a)*Math.sin(o+x*s),S=e*Math.cos(o+x*s),U=e*Math.sin(i+w*a)*Math.sin(o+x*s);m.set(E,S,U).normalize(),h.setXYZ(d,E,S,U),l.setXYZ(d,m.x,m.y,m.z),f.setXY(d,w,1-x),g.push(d),d++}p.push(g)}for(var C=[],y=0;y<r;y++)for(var M=0;M<t;M++){var P=p[y][M+1],B=p[y][M],F=p[y+1][M],N=p[y+1][M+1];(y!==0||o>0)&&C.push(P,B,N),(y!==r-1||c<Math.PI)&&C.push(B,F,N)}this.setIndex(new(h.count>65535?n.Uint32Attribute:n.Uint16Attribute)(C,1)),this.addAttribute("position",h),this.addAttribute("normal",l),this.addAttribute("uv",f),this.boundingSphere=new n.Sphere(new n.Vector3,e)},n.SphereBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.SphereBufferGeometry.prototype.constructor=n.SphereBufferGeometry,n.TextGeometry=function(e,t){t=t||{};var r=t.font;if(!(r instanceof n.Font))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new n.Geometry;var i=r.generateShapes(e,t.size,t.curveSegments);t.amount=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),n.ExtrudeGeometry.call(this,i,t),this.type="TextGeometry"},n.TextGeometry.prototype=Object.create(n.ExtrudeGeometry.prototype),n.TextGeometry.prototype.constructor=n.TextGeometry,n.TorusBufferGeometry=function(e,t,r,i,a){n.BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:a},e=e||100,t=t||40,r=Math.floor(r)||8,i=Math.floor(i)||6,a=a||Math.PI*2;var o=(r+1)*(i+1),s=r*i*2*3,c=new(s>65535?Uint32Array:Uint16Array)(s),u=new Float32Array(o*3),h=new Float32Array(o*3),l=new Float32Array(o*2),f=0,d=0,p=0,m=new n.Vector3,y=new n.Vector3,g=new n.Vector3,x,M;for(x=0;x<=r;x++)for(M=0;M<=i;M++){var w=M/i*a,E=x/r*Math.PI*2;y.x=(e+t*Math.cos(E))*Math.cos(w),y.y=(e+t*Math.cos(E))*Math.sin(w),y.z=t*Math.sin(E),u[f]=y.x,u[f+1]=y.y,u[f+2]=y.z,m.x=e*Math.cos(w),m.y=e*Math.sin(w),g.subVectors(y,m).normalize(),h[f]=g.x,h[f+1]=g.y,h[f+2]=g.z,l[d]=M/i,l[d+1]=x/r,f+=3,d+=2}for(x=1;x<=r;x++)for(M=1;M<=i;M++){var S=(i+1)*x+M-1,U=(i+1)*(x-1)+M-1,C=(i+1)*(x-1)+M,P=(i+1)*x+M;c[p]=S,c[p+1]=U,c[p+2]=P,c[p+3]=U,c[p+4]=C,c[p+5]=P,p+=6}this.setIndex(new n.BufferAttribute(c,1)),this.addAttribute("position",new n.BufferAttribute(u,3)),this.addAttribute("normal",new n.BufferAttribute(h,3)),this.addAttribute("uv",new n.BufferAttribute(l,2))},n.TorusBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.TorusBufferGeometry.prototype.constructor=n.TorusBufferGeometry,n.TorusGeometry=function(e,t,r,i,a){n.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:a},this.fromBufferGeometry(new n.TorusBufferGeometry(e,t,r,i,a))},n.TorusGeometry.prototype=Object.create(n.Geometry.prototype),n.TorusGeometry.prototype.constructor=n.TorusGeometry,n.TorusKnotBufferGeometry=function(e,t,r,i,a,o){n.BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:a,q:o},e=e||100,t=t||40,r=Math.floor(r)||64,i=Math.floor(i)||8,a=a||2,o=o||3;var s=(i+1)*(r+1),c=i*r*2*3,u=new n.BufferAttribute(new(c>65535?Uint32Array:Uint16Array)(c),1),h=new n.BufferAttribute(new Float32Array(s*3),3),l=new n.BufferAttribute(new Float32Array(s*3),3),f=new n.BufferAttribute(new Float32Array(s*2),2),d,p,m=0,y=0,g=new n.Vector3,x=new n.Vector3,M=new n.Vector2,w=new n.Vector3,E=new n.Vector3,S=new n.Vector3,U=new n.Vector3,C=new n.Vector3;for(d=0;d<=r;++d){var P=d/r*a*Math.PI*2;for(O(P,a,o,e,w),O(P+.01,a,o,e,E),U.subVectors(E,w),C.addVectors(E,w),S.crossVectors(U,C),C.crossVectors(S,U),S.normalize(),C.normalize(),p=0;p<=i;++p){var B=p/i*Math.PI*2,F=-t*Math.cos(B),N=t*Math.sin(B);g.x=w.x+(F*C.x+N*S.x),g.y=w.y+(F*C.y+N*S.y),g.z=w.z+(F*C.z+N*S.z),h.setXYZ(m,g.x,g.y,g.z),x.subVectors(g,w).normalize(),l.setXYZ(m,x.x,x.y,x.z),M.x=d/r,M.y=p/i,f.setXY(m,M.x,M.y),m++}}for(p=1;p<=r;p++)for(d=1;d<=i;d++){var W=(i+1)*(p-1)+(d-1),I=(i+1)*p+(d-1),k=(i+1)*p+d,T=(i+1)*(p-1)+d;u.setX(y,W),y++,u.setX(y,I),y++,u.setX(y,T),y++,u.setX(y,I),y++,u.setX(y,k),y++,u.setX(y,T),y++}this.setIndex(u),this.addAttribute("position",h),this.addAttribute("normal",l),this.addAttribute("uv",f);function O(G,j,Z,Q,R){var A=Math.cos(G),D=Math.sin(G),H=Z/j*G,Y=Math.cos(H);R.x=Q*(2+Y)*.5*A,R.y=Q*(2+Y)*D*.5,R.z=Q*Math.sin(H)*.5}},n.TorusKnotBufferGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.TorusKnotBufferGeometry.prototype.constructor=n.TorusKnotBufferGeometry,n.TorusKnotGeometry=function(e,t,r,i,a,o,s){n.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:a,q:o},s!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new n.TorusKnotBufferGeometry(e,t,r,i,a,o)),this.mergeVertices()},n.TorusKnotGeometry.prototype=Object.create(n.Geometry.prototype),n.TorusKnotGeometry.prototype.constructor=n.TorusKnotGeometry,n.TubeGeometry=function(e,t,r,i,a,o){n.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:r,radialSegments:i,closed:a,taper:o},t=t||64,r=r||1,i=i||8,a=a||!1,o=o||n.TubeGeometry.NoTaper;var s=[],c=this,u,h,l=t+1,f,d,p,m,y,g,x=new n.Vector3,M,w,E,S,U,C,P,B,F,N,W,I,k=new n.TubeGeometry.FrenetFrames(e,t,a),T=k.tangents,O=k.normals,G=k.binormals;this.tangents=T,this.normals=O,this.binormals=G;function j(Z,Q,R){return c.vertices.push(new n.Vector3(Z,Q,R))-1}for(M=0;M<l;M++)for(s[M]=[],f=M/(l-1),g=e.getPointAt(f),T[M],u=O[M],h=G[M],p=r*o(f),w=0;w<i;w++)d=w/i*2*Math.PI,m=-p*Math.cos(d),y=p*Math.sin(d),x.copy(g),x.x+=m*u.x+y*h.x,x.y+=m*u.y+y*h.y,x.z+=m*u.z+y*h.z,s[M][w]=j(x.x,x.y,x.z);for(M=0;M<t;M++)for(w=0;w<i;w++)E=a?(M+1)%t:M+1,S=(w+1)%i,U=s[M][w],C=s[E][w],P=s[E][S],B=s[M][S],F=new n.Vector2(M/t,w/i),N=new n.Vector2((M+1)/t,w/i),W=new n.Vector2((M+1)/t,(w+1)/i),I=new n.Vector2(M/t,(w+1)/i),this.faces.push(new n.Face3(U,C,B)),this.faceVertexUvs[0].push([F,N,I]),this.faces.push(new n.Face3(C,P,B)),this.faceVertexUvs[0].push([N.clone(),W,I.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},n.TubeGeometry.prototype=Object.create(n.Geometry.prototype),n.TubeGeometry.prototype.constructor=n.TubeGeometry,n.TubeGeometry.NoTaper=function(e){return 1},n.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},n.TubeGeometry.FrenetFrames=function(e,t,r){var i=new n.Vector3,a=[],o=[],s=[],c=new n.Vector3,u=new n.Matrix4,h=t+1,l,f,d,p,m,y,g;for(this.tangents=a,this.normals=o,this.binormals=s,y=0;y<h;y++)g=y/(h-1),a[y]=e.getTangentAt(g),a[y].normalize();x();function x(){o[0]=new n.Vector3,s[0]=new n.Vector3,f=Number.MAX_VALUE,d=Math.abs(a[0].x),p=Math.abs(a[0].y),m=Math.abs(a[0].z),d<=f&&(f=d,i.set(1,0,0)),p<=f&&(f=p,i.set(0,1,0)),m<=f&&i.set(0,0,1),c.crossVectors(a[0],i).normalize(),o[0].crossVectors(a[0],c),s[0].crossVectors(a[0],o[0])}for(y=1;y<h;y++)o[y]=o[y-1].clone(),s[y]=s[y-1].clone(),c.crossVectors(a[y-1],a[y]),c.length()>Number.EPSILON&&(c.normalize(),l=Math.acos(n.Math.clamp(a[y-1].dot(a[y]),-1,1)),o[y].applyMatrix4(u.makeRotationAxis(c,l))),s[y].crossVectors(a[y],o[y]);if(r)for(l=Math.acos(n.Math.clamp(o[0].dot(o[h-1]),-1,1)),l/=h-1,a[0].dot(c.crossVectors(o[0],o[h-1]))>0&&(l=-l),y=1;y<h;y++)o[y].applyMatrix4(u.makeRotationAxis(a[y],l*y)),s[y].crossVectors(a[y],o[y])},n.PolyhedronGeometry=function(e,t,r,i){n.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},r=r||1,i=i||0;for(var a=this,o=0,s=e.length;o<s;o+=3)E(new n.Vector3(e[o],e[o+1],e[o+2]));for(var c=this.vertices,u=[],o=0,h=0,s=t.length;o<s;o+=3,h++){var l=c[t[o]],f=c[t[o+1]],d=c[t[o+2]];u[h]=new n.Face3(l.index,f.index,d.index,[l.clone(),f.clone(),d.clone()],void 0,h)}for(var p=new n.Vector3,o=0,s=u.length;o<s;o++)U(u[o],i);for(var o=0,s=this.faceVertexUvs[0].length;o<s;o++){var m=this.faceVertexUvs[0][o],y=m[0].x,g=m[1].x,x=m[2].x,M=Math.max(y,g,x),w=Math.min(y,g,x);M>.9&&w<.1&&(y<.2&&(m[0].x+=1),g<.2&&(m[1].x+=1),x<.2&&(m[2].x+=1))}for(var o=0,s=this.vertices.length;o<s;o++)this.vertices[o].multiplyScalar(r);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new n.Sphere(new n.Vector3,r);function E(F){var N=F.normalize().clone();N.index=a.vertices.push(N)-1;var W=C(F)/2/Math.PI+.5,I=P(F)/Math.PI+.5;return N.uv=new n.Vector2(W,1-I),N}function S(F,N,W,I){var k=new n.Face3(F.index,N.index,W.index,[F.clone(),N.clone(),W.clone()],void 0,I);a.faces.push(k),p.copy(F).add(N).add(W).divideScalar(3);var T=C(p);a.faceVertexUvs[0].push([B(F.uv,F,T),B(N.uv,N,T),B(W.uv,W,T)])}function U(F,N){for(var W=Math.pow(2,N),I=E(a.vertices[F.a]),k=E(a.vertices[F.b]),T=E(a.vertices[F.c]),O=[],G=F.materialIndex,j=0;j<=W;j++){O[j]=[];for(var Z=E(I.clone().lerp(T,j/W)),Q=E(k.clone().lerp(T,j/W)),R=W-j,A=0;A<=R;A++)A===0&&j===W?O[j][A]=Z:O[j][A]=E(Z.clone().lerp(Q,A/R))}for(var j=0;j<W;j++)for(var A=0;A<2*(W-j)-1;A++){var D=Math.floor(A/2);A%2===0?S(O[j][D+1],O[j+1][D],O[j][D],G):S(O[j][D+1],O[j+1][D+1],O[j+1][D],G)}}function C(F){return Math.atan2(F.z,-F.x)}function P(F){return Math.atan2(-F.y,Math.sqrt(F.x*F.x+F.z*F.z))}function B(F,N,W){return W<0&&F.x===1&&(F=new n.Vector2(F.x-1,F.y)),N.x===0&&N.z===0&&(F=new n.Vector2(W/2/Math.PI+.5,F.y)),F.clone()}},n.PolyhedronGeometry.prototype=Object.create(n.Geometry.prototype),n.PolyhedronGeometry.prototype.constructor=n.PolyhedronGeometry,n.DodecahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,i=1/r,a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];n.PolyhedronGeometry.call(this,a,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}},n.DodecahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.DodecahedronGeometry.prototype.constructor=n.DodecahedronGeometry,n.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];n.PolyhedronGeometry.call(this,i,a,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},n.IcosahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.IcosahedronGeometry.prototype.constructor=n.IcosahedronGeometry,n.OctahedronGeometry=function(e,t){var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];n.PolyhedronGeometry.call(this,r,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},n.OctahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.OctahedronGeometry.prototype.constructor=n.OctahedronGeometry,n.TetrahedronGeometry=function(e,t){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];n.PolyhedronGeometry.call(this,r,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},n.TetrahedronGeometry.prototype=Object.create(n.PolyhedronGeometry.prototype),n.TetrahedronGeometry.prototype.constructor=n.TetrahedronGeometry,n.ParametricGeometry=function(e,t,r){n.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r};var i=this.vertices,a=this.faces,o=this.faceVertexUvs[0],s,c,u,h,l,f=t+1;for(s=0;s<=r;s++)for(l=s/r,c=0;c<=t;c++)h=c/t,u=e(h,l),i.push(u);var d,p,m,y,g,x,M,w;for(s=0;s<r;s++)for(c=0;c<t;c++)d=s*f+c,p=s*f+c+1,m=(s+1)*f+c+1,y=(s+1)*f+c,g=new n.Vector2(c/t,s/r),x=new n.Vector2((c+1)/t,s/r),M=new n.Vector2((c+1)/t,(s+1)/r),w=new n.Vector2(c/t,(s+1)/r),a.push(new n.Face3(d,p,y)),o.push([g,x,w]),a.push(new n.Face3(p,m,y)),o.push([x.clone(),M,w.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},n.ParametricGeometry.prototype=Object.create(n.Geometry.prototype),n.ParametricGeometry.prototype.constructor=n.ParametricGeometry,n.WireframeGeometry=function(e){n.BufferGeometry.call(this);var t=[0,0],r={};function i(W,I){return W-I}var a=["a","b","c"];if(e instanceof n.Geometry){for(var o=e.vertices,s=e.faces,c=0,u=new Uint32Array(6*s.length),h=0,l=s.length;h<l;h++)for(var f=s[h],d=0;d<3;d++){t[0]=f[a[d]],t[1]=f[a[(d+1)%3]],t.sort(i);var p=t.toString();r[p]===void 0&&(u[2*c]=t[0],u[2*c+1]=t[1],r[p]=!0,c++)}for(var m=new Float32Array(c*2*3),h=0,l=c;h<l;h++)for(var d=0;d<2;d++){var y=o[u[2*h+d]],g=6*h+3*d;m[g+0]=y.x,m[g+1]=y.y,m[g+2]=y.z}this.addAttribute("position",new n.BufferAttribute(m,3))}else if(e instanceof n.BufferGeometry)if(e.index!==null){var x=e.index.array,o=e.attributes.position,M=e.groups,c=0;M.length===0&&e.addGroup(0,x.length);for(var u=new Uint32Array(2*x.length),w=0,E=M.length;w<E;++w)for(var S=M[w],U=S.start,C=S.count,h=U,P=U+C;h<P;h+=3)for(var d=0;d<3;d++){t[0]=x[h+d],t[1]=x[h+(d+1)%3],t.sort(i);var p=t.toString();r[p]===void 0&&(u[2*c]=t[0],u[2*c+1]=t[1],r[p]=!0,c++)}for(var m=new Float32Array(c*2*3),h=0,l=c;h<l;h++)for(var d=0;d<2;d++){var g=6*h+3*d,B=u[2*h+d];m[g+0]=o.getX(B),m[g+1]=o.getY(B),m[g+2]=o.getZ(B)}this.addAttribute("position",new n.BufferAttribute(m,3))}else{for(var o=e.attributes.position.array,c=o.length/3,F=c/3,m=new Float32Array(c*2*3),h=0,l=F;h<l;h++)for(var d=0;d<3;d++){var g=18*h+6*d,N=9*h+3*d;m[g+0]=o[N],m[g+1]=o[N+1],m[g+2]=o[N+2];var B=9*h+3*((d+1)%3);m[g+3]=o[B],m[g+4]=o[B+1],m[g+5]=o[B+2]}this.addAttribute("position",new n.BufferAttribute(m,3))}},n.WireframeGeometry.prototype=Object.create(n.BufferGeometry.prototype),n.WireframeGeometry.prototype.constructor=n.WireframeGeometry,n.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),i=new n.BufferGeometry;i.addAttribute("position",new n.BufferAttribute(t,3)),i.addAttribute("color",new n.BufferAttribute(r,3));var a=new n.LineBasicMaterial({vertexColors:n.VertexColors});n.LineSegments.call(this,i,a)},n.AxisHelper.prototype=Object.create(n.LineSegments.prototype),n.AxisHelper.prototype.constructor=n.AxisHelper,n.ArrowHelper=function(){var e=new n.BufferGeometry;e.addAttribute("position",new n.Float32Attribute([0,0,0,0,1,0],3));var t=new n.CylinderBufferGeometry(0,.5,1,5,1);return t.translate(0,-.5,0),function(i,a,o,s,c,u){n.Object3D.call(this),s===void 0&&(s=16776960),o===void 0&&(o=1),c===void 0&&(c=.2*o),u===void 0&&(u=.2*c),this.position.copy(a),this.line=new n.Line(e,new n.LineBasicMaterial({color:s})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new n.Mesh(t,new n.MeshBasicMaterial({color:s})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(i),this.setLength(o,c,u)}}(),n.ArrowHelper.prototype=Object.create(n.Object3D.prototype),n.ArrowHelper.prototype.constructor=n.ArrowHelper,n.ArrowHelper.prototype.setDirection=function(){var e=new n.Vector3,t;return function(i){i.y>.99999?this.quaternion.set(0,0,0,1):i.y<-.99999?this.quaternion.set(1,0,0,0):(e.set(i.z,0,-i.x).normalize(),t=Math.acos(i.y),this.quaternion.setFromAxisAngle(e,t))}}(),n.ArrowHelper.prototype.setLength=function(e,t,r){t===void 0&&(t=.2*e),r===void 0&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},n.ArrowHelper.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},n.BoxHelper=function(e){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),i=new n.BufferGeometry;i.setIndex(new n.BufferAttribute(t,1)),i.addAttribute("position",new n.BufferAttribute(r,3)),n.LineSegments.call(this,i,new n.LineBasicMaterial({color:16776960})),e!==void 0&&this.update(e)},n.BoxHelper.prototype=Object.create(n.LineSegments.prototype),n.BoxHelper.prototype.constructor=n.BoxHelper,n.BoxHelper.prototype.update=function(){var e=new n.Box3;return function(t){if(t instanceof n.Box3?e.copy(t):e.setFromObject(t),!e.isEmpty()){var r=e.min,i=e.max,a=this.geometry.attributes.position,o=a.array;o[0]=i.x,o[1]=i.y,o[2]=i.z,o[3]=r.x,o[4]=i.y,o[5]=i.z,o[6]=r.x,o[7]=r.y,o[8]=i.z,o[9]=i.x,o[10]=r.y,o[11]=i.z,o[12]=i.x,o[13]=i.y,o[14]=r.z,o[15]=r.x,o[16]=i.y,o[17]=r.z,o[18]=r.x,o[19]=r.y,o[20]=r.z,o[21]=i.x,o[22]=r.y,o[23]=r.z,a.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),n.BoundingBoxHelper=function(e,t){var r=t!==void 0?t:8947848;this.object=e,this.box=new n.Box3,n.Mesh.call(this,new n.BoxGeometry(1,1,1),new n.MeshBasicMaterial({color:r,wireframe:!0}))},n.BoundingBoxHelper.prototype=Object.create(n.Mesh.prototype),n.BoundingBoxHelper.prototype.constructor=n.BoundingBoxHelper,n.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},n.CameraHelper=function(e){var t=new n.Geometry,r=new n.LineBasicMaterial({color:16777215,vertexColors:n.FaceColors}),i={},a=16755200,o=16711680,s=43775,c=16777215,u=3355443;h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",o),h("p","n2",o),h("p","n3",o),h("p","n4",o),h("u1","u2",s),h("u2","u3",s),h("u3","u1",s),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u);function h(f,d,p){l(f,p),l(d,p)}function l(f,d){t.vertices.push(new n.Vector3),t.colors.push(new n.Color(d)),i[f]===void 0&&(i[f]=[]),i[f].push(t.vertices.length-1)}n.LineSegments.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=i,this.update()},n.CameraHelper.prototype=Object.create(n.LineSegments.prototype),n.CameraHelper.prototype.constructor=n.CameraHelper,n.CameraHelper.prototype.update=function(){var e,t,r=new n.Vector3,i=new n.Camera;function a(o,s,c,u){r.set(s,c,u).unproject(i);var h=t[o];if(h!==void 0)for(var l=0,f=h.length;l<f;l++)e.vertices[h[l]].copy(r)}return function(){e=this.geometry,t=this.pointMap;var o=1,s=1;i.projectionMatrix.copy(this.camera.projectionMatrix),a("c",0,0,-1),a("t",0,0,1),a("n1",-o,-s,-1),a("n2",o,-s,-1),a("n3",-o,s,-1),a("n4",o,s,-1),a("f1",-o,-s,1),a("f2",o,-s,1),a("f3",-o,s,1),a("f4",o,s,1),a("u1",o*.7,s*1.1,-1),a("u2",-o*.7,s*1.1,-1),a("u3",0,s*2,-1),a("cf1",-o,0,1),a("cf2",o,0,1),a("cf3",0,-s,1),a("cf4",0,s,1),a("cn1",-o,0,-1),a("cn2",o,0,-1),a("cn3",0,-s,-1),a("cn4",0,s,-1),e.verticesNeedUpdate=!0}}(),n.DirectionalLightHelper=function(e,t){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t===void 0&&(t=1);var r=new n.BufferGeometry;r.addAttribute("position",new n.Float32Attribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new n.LineBasicMaterial({fog:!1});this.add(new n.Line(r,i)),r=new n.BufferGeometry,r.addAttribute("position",new n.Float32Attribute([0,0,0,0,0,1],3)),this.add(new n.Line(r,i)),this.update()},n.DirectionalLightHelper.prototype=Object.create(n.Object3D.prototype),n.DirectionalLightHelper.prototype.constructor=n.DirectionalLightHelper,n.DirectionalLightHelper.prototype.dispose=function(){var e=this.children[0],t=this.children[1];e.geometry.dispose(),e.material.dispose(),t.geometry.dispose(),t.material.dispose()},n.DirectionalLightHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e);var i=this.children[0],a=this.children[1];i.lookAt(r),i.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),a.lookAt(r),a.scale.z=r.length()}}(),n.EdgesHelper=function(e,t,r){var i=t!==void 0?t:16777215;n.LineSegments.call(this,new n.EdgesGeometry(e.geometry,r),new n.LineBasicMaterial({color:i})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},n.EdgesHelper.prototype=Object.create(n.LineSegments.prototype),n.EdgesHelper.prototype.constructor=n.EdgesHelper,n.FaceNormalsHelper=function(e,t,r,i){this.object=e,this.size=t!==void 0?t:1;var a=r!==void 0?r:16776960,o=i!==void 0?i:1,s=0,c=this.object.geometry;c instanceof n.Geometry?s=c.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var u=new n.BufferGeometry,h=new n.Float32Attribute(s*2*3,3);u.addAttribute("position",h),n.LineSegments.call(this,u,new n.LineBasicMaterial({color:a,linewidth:o})),this.matrixAutoUpdate=!1,this.update()},n.FaceNormalsHelper.prototype=Object.create(n.LineSegments.prototype),n.FaceNormalsHelper.prototype.constructor=n.FaceNormalsHelper,n.FaceNormalsHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Matrix3;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var a=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry,c=s.vertices,u=s.faces,h=0,l=0,f=u.length;l<f;l++){var d=u[l],p=d.normal;e.copy(c[d.a]).add(c[d.b]).add(c[d.c]).divideScalar(3).applyMatrix4(a),t.copy(p).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),o.setXYZ(h,e.x,e.y,e.z),h=h+1,o.setXYZ(h,t.x,t.y,t.z),h=h+1}return o.needsUpdate=!0,this}}(),n.GridHelper=function(e,t,r,i){r=new n.Color(r!==void 0?r:4473924),i=new n.Color(i!==void 0?i:8947848);for(var a=[],o=[],s=-e,c=0;s<=e;s+=t){a.push(-e,0,s,e,0,s),a.push(s,0,-e,s,0,e);var u=s===0?r:i;u.toArray(o,c),c+=3,u.toArray(o,c),c+=3,u.toArray(o,c),c+=3,u.toArray(o,c),c+=3}var h=new n.BufferGeometry;h.addAttribute("position",new n.Float32Attribute(a,3)),h.addAttribute("color",new n.Float32Attribute(o,3));var l=new n.LineBasicMaterial({vertexColors:n.VertexColors});n.LineSegments.call(this,h,l)},n.GridHelper.prototype=Object.create(n.LineSegments.prototype),n.GridHelper.prototype.constructor=n.GridHelper,n.GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},n.HemisphereLightHelper=function(e,t){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new n.Color,new n.Color];var r=new n.SphereGeometry(t,4,2);r.rotateX(-Math.PI/2);for(var i=0,a=8;i<a;i++)r.faces[i].color=this.colors[i<4?0:1];var o=new n.MeshBasicMaterial({vertexColors:n.FaceColors,wireframe:!0});this.lightSphere=new n.Mesh(r,o),this.add(this.lightSphere),this.update()},n.HemisphereLightHelper.prototype=Object.create(n.Object3D.prototype),n.HemisphereLightHelper.prototype.constructor=n.HemisphereLightHelper,n.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},n.HemisphereLightHelper.prototype.update=function(){var e=new n.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),n.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new n.SphereBufferGeometry(t,4,2),i=new n.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),n.Mesh.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},n.PointLightHelper.prototype=Object.create(n.Mesh.prototype),n.PointLightHelper.prototype.constructor=n.PointLightHelper,n.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},n.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},n.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new n.Geometry,r=0;r<this.bones.length;r++){var i=this.bones[r];i.parent instanceof n.Bone&&(t.vertices.push(new n.Vector3),t.vertices.push(new n.Vector3),t.colors.push(new n.Color(0,0,1)),t.colors.push(new n.Color(0,1,0)))}t.dynamic=!0;var a=new n.LineBasicMaterial({vertexColors:n.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});n.LineSegments.call(this,t,a),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},n.SkeletonHelper.prototype=Object.create(n.LineSegments.prototype),n.SkeletonHelper.prototype.constructor=n.SkeletonHelper,n.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof n.Bone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,this.getBoneList(e.children[r]));return t},n.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=new n.Matrix4().getInverse(this.root.matrixWorld),r=new n.Matrix4,i=0,a=0;a<this.bones.length;a++){var o=this.bones[a];o.parent instanceof n.Bone&&(r.multiplyMatrices(t,o.matrixWorld),e.vertices[i].setFromMatrixPosition(r),r.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[i+1].setFromMatrixPosition(r),i+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},n.SpotLightHelper=function(e){n.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;for(var t=new n.BufferGeometry,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,a=1,o=32;i<o;i++,a++){var s=i/o*Math.PI*2,c=a/o*Math.PI*2;r.push(Math.cos(s),Math.sin(s),1,Math.cos(c),Math.sin(c),1)}t.addAttribute("position",new n.Float32Attribute(r,3));var u=new n.LineBasicMaterial({fog:!1});this.cone=new n.LineSegments(t,u),this.add(this.cone),this.update()},n.SpotLightHelper.prototype=Object.create(n.Object3D.prototype),n.SpotLightHelper.prototype.constructor=n.SpotLightHelper,n.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},n.SpotLightHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3;return function(){var r=this.light.distance?this.light.distance:1e3,i=r*Math.tan(this.light.angle);this.cone.scale.set(i,i,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),n.VertexNormalsHelper=function(e,t,r,i){this.object=e,this.size=t!==void 0?t:1;var a=r!==void 0?r:16711680,o=i!==void 0?i:1,s=0,c=this.object.geometry;c instanceof n.Geometry?s=c.faces.length*3:c instanceof n.BufferGeometry&&(s=c.attributes.normal.count);var u=new n.BufferGeometry,h=new n.Float32Attribute(s*2*3,3);u.addAttribute("position",h),n.LineSegments.call(this,u,new n.LineBasicMaterial({color:a,linewidth:o})),this.matrixAutoUpdate=!1,this.update()},n.VertexNormalsHelper.prototype=Object.create(n.LineSegments.prototype),n.VertexNormalsHelper.prototype.constructor=n.VertexNormalsHelper,n.VertexNormalsHelper.prototype.update=function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Matrix3;return function(){var a=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var o=this.object.matrixWorld,s=this.geometry.attributes.position,c=this.object.geometry;if(c instanceof n.Geometry)for(var u=c.vertices,h=c.faces,l=0,f=0,d=h.length;f<d;f++)for(var p=h[f],m=0,y=p.vertexNormals.length;m<y;m++){var g=u[p[a[m]]],x=p.vertexNormals[m];e.copy(g).applyMatrix4(o),t.copy(x).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),s.setXYZ(l,e.x,e.y,e.z),l=l+1,s.setXYZ(l,t.x,t.y,t.z),l=l+1}else if(c instanceof n.BufferGeometry)for(var M=c.attributes.position,w=c.attributes.normal,l=0,m=0,y=M.count;m<y;m++)e.set(M.getX(m),M.getY(m),M.getZ(m)).applyMatrix4(o),t.set(w.getX(m),w.getY(m),w.getZ(m)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),s.setXYZ(l,e.x,e.y,e.z),l=l+1,s.setXYZ(l,t.x,t.y,t.z),l=l+1;return s.needsUpdate=!0,this}}(),n.WireframeHelper=function(e,t){var r=t!==void 0?t:16777215;n.LineSegments.call(this,new n.WireframeGeometry(e.geometry),new n.LineBasicMaterial({color:r})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},n.WireframeHelper.prototype=Object.create(n.LineSegments.prototype),n.WireframeHelper.prototype.constructor=n.WireframeHelper,n.ImmediateRenderObject=function(e){n.Object3D.call(this),this.material=e,this.render=function(t){}},n.ImmediateRenderObject.prototype=Object.create(n.Object3D.prototype),n.ImmediateRenderObject.prototype.constructor=n.ImmediateRenderObject,n.MorphBlendMesh=function(e,t){n.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,i="__default",a=0,o=r-1,s=r/1;this.createAnimation(i,a,o,s),this.setAnimationWeight(i,1)},n.MorphBlendMesh.prototype=Object.create(n.Mesh.prototype),n.MorphBlendMesh.prototype.constructor=n.MorphBlendMesh,n.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){var a={start:t,end:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=a,this.animationsList.push(a)},n.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t=/([a-z]+)_?(\d+)/i,r,i={},a=this.geometry,o=0,s=a.morphTargets.length;o<s;o++){var c=a.morphTargets[o],u=c.name.match(t);if(u&&u.length>1){var h=u[1];i[h]||(i[h]={start:1/0,end:-1/0});var l=i[h];o<l.start&&(l.start=o),o>l.end&&(l.end=o),r||(r=h)}}for(var h in i){var l=i[h];this.createAnimation(h,l.start,l.end,e)}this.firstAnimation=r},n.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},n.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},n.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},n.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},n.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},n.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},n.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},n.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},n.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},n.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},n.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var i=this.animationsList[t];if(i.active){var a=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var o=i.start+n.Math.clamp(Math.floor(i.time/a),0,i.length-1),s=i.weight;o!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*s,this.morphTargetInfluences[o]=0,i.lastFrame=i.currentFrame,i.currentFrame=o);var c=i.time%a/a;i.directionBackwards&&(c=1-c),i.currentFrame!==i.lastFrame?(this.morphTargetInfluences[i.currentFrame]=c*s,this.morphTargetInfluences[i.lastFrame]=(1-c)*s):this.morphTargetInfluences[i.currentFrame]=s}}},q.exports&&(se=q.exports=n),se.THREE=n})(rt,rt.exports);var be=rt.exports;let Xe;const it=40;let Be;new be.Raycaster(new be.Vector3,new be.Vector3,0,it);function at(q,se){return Math.sqrt((q.position.x-se.position.x)*(q.position.x-se.position.x)+(q.position.y-se.position.y)*(q.position.y-se.position.y)+(q.position.z-se.position.z)*(q.position.z-se.position.z))}function Jt(q){let e=Be.geometry.parameters.width/2,t=Be.geometry.parameters.height/2,r=Be.geometry.parameters.depth/2;q.position.x<Be.position.x-e-8&&(q.velocity.x+=.21),q.position.x>Be.position.x+e+8&&(q.velocity.x-=.21),q.position.y<Be.position.y-t-8&&(q.velocity.y+=.21),q.position.y>Be.position.y+t+8&&(q.velocity.y-=.21),q.position.z<Be.position.z-r-8&&(q.velocity.z+=.21),q.position.z>Be.position.z+r+8&&(q.velocity.z-=.21)}function $t(q){let n=0,e=0,t=0,r=0;for(let i of Xe)at(q,i)<it&&(n+=i.position.x,e+=i.position.y,t+=i.position.z,r+=1);r&&(n=n/r,e=e/r,t=t/r,q.velocity.x+=(n-q.position.x)*7e-4,q.velocity.y+=(e-q.position.y)*7e-4,q.velocity.z+=(t-q.position.z)*7e-4)}function en(q){let e=0,t=0,r=0;for(let i of Xe)i!==q&&at(q,i)<10&&(e+=q.position.x-i.position.x,t+=q.position.y-i.position.y,r+=q.position.z-i.position.z);q.velocity.x+=e*.06,q.velocity.y+=t*.06,q.velocity.z+=r*.06}function tn(q){let n=0,e=0,t=0,r=0;for(let i of Xe)at(q,i)<it&&(n+=i.velocity.x,e+=i.velocity.y,t+=i.velocity.z,r+=1);r&&(n=n/r,e=e/r,t=t/r,q.velocity.x+=(n-q.velocity.x)*.05,q.velocity.y+=(e-q.velocity.y)*.05,q.velocity.z+=(t-q.velocity.z)*.05)}function nn(q){const e=Math.sqrt(q.velocity.x*q.velocity.x+q.velocity.y*q.velocity.y+q.velocity.z*q.velocity.z);e>6&&(q.velocity.x=q.velocity.x/e*6,q.velocity.y=q.velocity.y/e*6,q.velocity.z=q.velocity.z/e*6),e<3&&(q.velocity.x=q.velocity.x/e*3,q.velocity.y=q.velocity.y/e*3,q.velocity.z=q.velocity.z/e*3)}function rn(q,se){Be==null&&(Be=q.children.filter(n=>n.name=="Containment Box")[0],q.children.filter(n=>n.name=="Avoidance Box")[0]),Xe=se,Be.geometry.computeBoundingBox();for(let n of Xe)$t(n),en(n),tn(n),nn(n),Jt(n)}let Ie,xt,De,Ke,Fe;async function an(q,se){xt=document.querySelector("canvas.webgl"),document.querySelector(".container"),new be.LoadingManager;const n=document.getElementById("loading-screen");n.classList.add("fade-out"),n.addEventListener("transitionend",un),De=new be.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4),De.position.z=250,Ke=new be.Frustum,Ke.setFromMatrix(new be.Matrix4().multiplyMatrices(De.projectionMatrix,De.matrixWorldInverse)),Fe=new be.Scene,Fe.background=new be.Color(2171169),new be.Clock,new be.Raycaster,Ie=new be.WebGLRenderer({canvas:xt,alpha:!0,antialias:!0}),Ie.setPixelRatio(window.devicePixelRatio),Ie.setSize(window.innerWidth,window.innerHeight),Ie.setClearAlpha(0);const e=new be.HemisphereLight(16772785,526368,2),t=new be.SpotLight(16752732,2);t.position.set(-200,200,200),t.castShadow=!0,Fe.add(e),Fe.add(t),Fe.number_of_spheres=250;const r=new be.BoxGeometry(500,200,200),i=new be.Mesh(r,new be.MeshBasicMaterial);i.visible=!1,i.position.z=50,i.name="Containment Box",Fe.add(i);const a=new be.SphereGeometry(1,32,16);for(let o=0;o<Fe.number_of_spheres;o++)sn(a);window.addEventListener("resize",hn),window.addEventListener("mousemove",ln)}async function _t(){requestAnimationFrame(_t),cn(!0),on()}function on(){Ie.render(Fe,De);const q=Ie.domElement;De.aspect=q.clientWidth/q.clientHeight,De.updateProjectionMatrix(),q.clientWidth<700?Fe.toDisplay=!1:Fe.toDisplay=!0}function sn(q){const se={color:8657098},n=new be.Mesh(q,new be.MeshBasicMaterial(se));return n.scale.set(1,1,1),n.position.x=Math.random()*300-150,n.position.y=Math.random()*300-150,n.position.z=Math.random()*300-150,n.original_scale={x:n.scale.x,y:n.scale.y,z:n.scale.z},n.name="Sphere",n.velocity=new be.Vector3(2*(Math.random()-.5),2*(Math.random()-.5),2*(Math.random()-.5)),n.ballsHeld=[],Fe.add(n),n}function cn(q){Ke.setFromMatrix(new be.Matrix4().multiplyMatrices(De.projectionMatrix,De.matrixWorldInverse)),q&&rn(Fe,Fe.children.filter(se=>se.name=="Sphere"&&se.visible)),Fe.children.forEach(se=>{se.name=="Sphere"&&se.visible&&(se.position.x=se.position.x+se.velocity.x,se.position.y=se.position.y+se.velocity.y,(se.position.z>-400||q)&&(se.position.z=se.position.z+se.velocity.z),Ke.containsPoint(se.position)||(se.velocity.x=se.velocity.x*-1,se.velocity.y=se.velocity.y*-1))})}function un(q){q.target.remove()}function hn(){De.aspect=window.innerWidth/window.innerHeight,De.updateProjectionMatrix(),Ie.setSize(window.innerWidth,window.innerHeight),Ie.setPixelRatio(Math.min(window.devicePixelRatio,2))}function ln(q){q.clientX/window.innerWidth-.5,q.clientY/window.innerHeight-.5}an().then(()=>_t());const fn=new IntersectionObserver(q=>{q.forEach(se=>{if(se.isIntersecting){let n=se.target;if(window.getComputedStyle(n.parentElement).display==="grid"){let t=window.getComputedStyle(n),r=t.getPropertyValue("grid-column-start"),i=t.getPropertyValue("grid-row-start");r==="span 2"&&se.target.classList.add("animate-left"),i==="span 2"&&se.target.classList.add("animate-right"),console.log(r,i,r==="span 2",i==="span 2")}se.target.classList.add("show")}})}),dn=new IntersectionObserver(q=>{q.forEach(se=>{se.isIntersecting&&se.target.classList.add("animate-left")})});function Mt(){window.matchMedia("(min-width: 1400px)").matches?(document.querySelectorAll(".project-card:nth-child(n)").forEach(q=>{q.classList.add("animate-left")}),document.querySelectorAll(".project-card:nth-child(3n+2)").forEach(q=>{q.classList.remove("animate-left"),q.classList.add("animate-right")})):window.matchMedia("(max-width:1400px) and (min-width: 800px)").matches?document.querySelectorAll(".project-card:nth-child(3n+1)").forEach(q=>{q.classList.add("animate-left")}):window.matchMedia("(max-width:800px)").matches&&(document.querySelectorAll(".project-card:nth-child(odd)").forEach(q=>{q.classList.add("animate-left")}),document.querySelectorAll(".project-card:nth-child(even)").forEach(q=>{q.classList.add("animate-right")}))}window.onload=function(){Mt()};window.onresize=function(){Mt()};const pn=document.querySelectorAll(".hidden"),mn=document.querySelectorAll(".project-card:nth-child(3n+1)");pn.forEach(q=>fn.observe(q));mn.forEach(q=>dn.observe(q));
